(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{222:function(t,e,n){"use strict";n.r(e);var s=n(3),a=Object(s.a)({},(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"vm-executing-javascript"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vm-executing-javascript"}},[t._v("#")]),t._v(" VM (Executing JavaScript)")]),t._v(" "),n("blockquote",[n("p",[t._v("Stability: 2 - Stable")])]),t._v(" "),n("p",[t._v("The "),n("code",[t._v("vm")]),t._v(" module provides APIs for compiling and running code within V8 Virtual\nMachine contexts. "),n("strong",[t._v("The "),n("code",[t._v("vm")]),t._v(" module is not a security mechanism. Do\nnot use it to run untrusted code")]),t._v('. The term "sandbox" is used throughout these\ndocs simply to refer to a separate context, and does not confer any security\nguarantees.')]),t._v(" "),n("p",[t._v("JavaScript code can be compiled and run immediately or\ncompiled, saved, and run later.")]),t._v(" "),n("p",[t._v("A common use case is to run the code in a sandboxed environment.\nThe sandboxed code uses a different V8 Context, meaning that\nit has a different global object than the rest of the code.")]),t._v(" "),n("p",[t._v("One can provide the context by "),n("a",{attrs:{href:"#vm_what_does_it_mean_to_contextify_an_object"}},[t._v('"contextifying"')]),t._v(" a sandbox\nobject. The sandboxed code treats any property in the sandbox like a\nglobal variable. Any changes to global variables caused by the sandboxed\ncode are reflected in the sandbox object.")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" vm "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vm'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" x "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" sandbox "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nvm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createContext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sandbox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Contextify the sandbox.")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" code "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'x += 40; var y = 17;'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// `x` and `y` are global variables in the sandboxed environment.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Initially, x has the value 2 because that is the value of sandbox.x.")]),t._v("\nvm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("runInContext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("code"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sandbox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sandbox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 42")]),t._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sandbox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 17")]),t._v("\n\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1; y is not defined.")]),t._v("\n")])])]),n("h2",{attrs:{id:"class-vm-script"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#class-vm-script"}},[t._v("#")]),t._v(" Class: vm.Script")]),t._v(" "),n("p",[t._v("Instances of the "),n("code",[t._v("vm.Script")]),t._v(' class contain precompiled scripts that can be\nexecuted in specific sandboxes (or "contexts").')]),t._v(" "),n("h3",{attrs:{id:"constructor-new-vm-script-code-options"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#constructor-new-vm-script-code-options"}},[t._v("#")]),t._v(" Constructor: new vm.Script(code[, options])")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("code")]),t._v(" {string} The JavaScript code to compile.")]),t._v(" "),n("li",[n("code",[t._v("options")]),t._v(" {Object|string}\n"),n("ul",[n("li",[n("code",[t._v("filename")]),t._v(" {string} Specifies the filename used in stack traces produced\nby this script. "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("'evalmachine.<anonymous>'")]),t._v(".")]),t._v(" "),n("li",[n("code",[t._v("lineOffset")]),t._v(" {number} Specifies the line number offset that is displayed\nin stack traces produced by this script. "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("0")]),t._v(".")]),t._v(" "),n("li",[n("code",[t._v("columnOffset")]),t._v(" {number} Specifies the column number offset that is displayed\nin stack traces produced by this script. "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("0")]),t._v(".")]),t._v(" "),n("li",[n("code",[t._v("cachedData")]),t._v(" {Buffer|TypedArray|DataView} Provides an optional "),n("code",[t._v("Buffer")]),t._v(" or\n"),n("code",[t._v("TypedArray")]),t._v(", or "),n("code",[t._v("DataView")]),t._v(" with V8's code cache data for the supplied\nsource. When supplied, the "),n("code",[t._v("cachedDataRejected")]),t._v(" value will be set to\neither "),n("code",[t._v("true")]),t._v(" or "),n("code",[t._v("false")]),t._v(" depending on acceptance of the data by V8.")]),t._v(" "),n("li",[n("code",[t._v("produceCachedData")]),t._v(" {boolean} When "),n("code",[t._v("true")]),t._v(" and no "),n("code",[t._v("cachedData")]),t._v(" is present, V8\nwill attempt to produce code cache data for "),n("code",[t._v("code")]),t._v(". Upon success, a\n"),n("code",[t._v("Buffer")]),t._v(" with V8's code cache data will be produced and stored in the\n"),n("code",[t._v("cachedData")]),t._v(" property of the returned "),n("code",[t._v("vm.Script")]),t._v(" instance.\nThe "),n("code",[t._v("cachedDataProduced")]),t._v(" value will be set to either "),n("code",[t._v("true")]),t._v(" or "),n("code",[t._v("false")]),t._v("\ndepending on whether code cache data is produced successfully.\nThis option is "),n("strong",[t._v("deprecated")]),t._v(" in favor of "),n("code",[t._v("script.createCachedData()")]),t._v(".\n"),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("false")]),t._v(".")]),t._v(" "),n("li",[n("code",[t._v("importModuleDynamically")]),t._v(" {Function} Called during evaluation of this module\nwhen "),n("code",[t._v("import()")]),t._v(" is called. If this option is not specified, calls to\n"),n("code",[t._v("import()")]),t._v(" will reject with "),n("router-link",{attrs:{to:"/node/errors.html#ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING"}},[n("code",[t._v("ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING")])]),t._v(".\nThis option is part of the experimental API for the "),n("code",[t._v("--experimental-modules")]),t._v("\nflag, and should not be considered stable.\n"),n("ul",[n("li",[n("code",[t._v("specifier")]),t._v(" {string} specifier passed to "),n("code",[t._v("import()")])]),t._v(" "),n("li",[n("code",[t._v("module")]),t._v(" {vm.Module}")]),t._v(" "),n("li",[t._v("Returns: {Module Namespace Object|vm.Module} Returning a "),n("code",[t._v("vm.Module")]),t._v(" is\nrecommended in order to take advantage of error tracking, and to avoid\nissues with namespaces that contain "),n("code",[t._v("then")]),t._v(" function exports.")])])],1)])])]),t._v(" "),n("p",[t._v("If "),n("code",[t._v("options")]),t._v(" is a string, then it specifies the filename.")]),t._v(" "),n("p",[t._v("Creating a new "),n("code",[t._v("vm.Script")]),t._v(" object compiles "),n("code",[t._v("code")]),t._v(" but does not run it. The\ncompiled "),n("code",[t._v("vm.Script")]),t._v(" can be run later multiple times. The "),n("code",[t._v("code")]),t._v(" is not bound to\nany global object; rather, it is bound before each run, just for that run.")]),t._v(" "),n("h3",{attrs:{id:"script-createcacheddata"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#script-createcacheddata"}},[t._v("#")]),t._v(" script.createCachedData()")]),t._v(" "),n("ul",[n("li",[t._v("Returns: {Buffer}")])]),t._v(" "),n("p",[t._v("Creates a code cache that can be used with the Script constructor's\n"),n("code",[t._v("cachedData")]),t._v(" option. Returns a Buffer. This method may be called at any\ntime and any number of times.")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" script "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("\nfunction add(a, b) {\n  return a + b;\n}\n\nconst x = add(1, 2);\n")]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" cacheWithoutX "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" script"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createCachedData")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nscript"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("runInThisContext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" cacheWithX "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" script"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createCachedData")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("h3",{attrs:{id:"script-runincontext-contextifiedsandbox-options"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#script-runincontext-contextifiedsandbox-options"}},[t._v("#")]),t._v(" script.runInContext(contextifiedSandbox[, options])")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("contextifiedSandbox")]),t._v(" {Object} A "),n("a",{attrs:{href:"#vm_what_does_it_mean_to_contextify_an_object"}},[t._v("contextified")]),t._v(" object as returned by the\n"),n("code",[t._v("vm.createContext()")]),t._v(" method.")]),t._v(" "),n("li",[n("code",[t._v("options")]),t._v(" {Object}\n"),n("ul",[n("li",[n("code",[t._v("displayErrors")]),t._v(" {boolean} When "),n("code",[t._v("true")]),t._v(", if an "),n("router-link",{attrs:{to:"/node/errors.html#errors_class_error"}},[n("code",[t._v("Error")])]),t._v(" occurs\nwhile compiling the "),n("code",[t._v("code")]),t._v(", the line of code causing the error is attached\nto the stack trace. "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("true")]),t._v(".")],1),t._v(" "),n("li",[n("code",[t._v("timeout")]),t._v(" {integer} Specifies the number of milliseconds to execute "),n("code",[t._v("code")]),t._v("\nbefore terminating execution. If execution is terminated, an "),n("router-link",{attrs:{to:"/node/errors.html#errors_class_error"}},[n("code",[t._v("Error")])]),t._v("\nwill be thrown. This value must be a strictly positive integer.")],1),t._v(" "),n("li",[n("code",[t._v("breakOnSigint")]),t._v(" {boolean} If "),n("code",[t._v("true")]),t._v(", the execution will be terminated when\n"),n("code",[t._v("SIGINT")]),t._v(" (Ctrl+C) is received. Existing handlers for the\nevent that have been attached via "),n("code",[t._v("process.on('SIGINT')")]),t._v(" will be disabled\nduring script execution, but will continue to work after that. If execution\nis terminated, an "),n("router-link",{attrs:{to:"/node/errors.html#errors_class_error"}},[n("code",[t._v("Error")])]),t._v(" will be thrown. "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("false")]),t._v(".")],1)])]),t._v(" "),n("li",[t._v("Returns: {any} the result of the very last statement executed in the script.")])]),t._v(" "),n("p",[t._v("Runs the compiled code contained by the "),n("code",[t._v("vm.Script")]),t._v(" object within the given\n"),n("code",[t._v("contextifiedSandbox")]),t._v(" and returns the result. Running code does not have access\nto local scope.")]),t._v(" "),n("p",[t._v("The following example compiles code that increments a global variable, sets\nthe value of another global variable, then execute the code multiple times.\nThe globals are contained in the "),n("code",[t._v("sandbox")]),t._v(" object.")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" util "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'util'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" vm "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vm'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" sandbox "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  animal"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cat'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  count"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" script "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'count += 1; name = \"kitty\";'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" context "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createContext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sandbox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  script"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("runInContext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("util"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("inspect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sandbox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// { animal: 'cat', count: 12, name: 'kitty' }")]),t._v("\n")])])]),n("p",[t._v("Using the "),n("code",[t._v("timeout")]),t._v(" or "),n("code",[t._v("breakOnSigint")]),t._v(" options will result in new event loops\nand corresponding threads being started, which have a non-zero performance\noverhead.")]),t._v(" "),n("h3",{attrs:{id:"script-runinnewcontext-sandbox-options"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#script-runinnewcontext-sandbox-options"}},[t._v("#")]),t._v(" script.runInNewContext([sandbox[, options]])")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("sandbox")]),t._v(" {Object} An object that will be "),n("a",{attrs:{href:"#vm_what_does_it_mean_to_contextify_an_object"}},[t._v("contextified")]),t._v(". If "),n("code",[t._v("undefined")]),t._v(", a\nnew object will be created.")]),t._v(" "),n("li",[n("code",[t._v("options")]),t._v(" {Object}\n"),n("ul",[n("li",[n("code",[t._v("displayErrors")]),t._v(" {boolean} When "),n("code",[t._v("true")]),t._v(", if an "),n("router-link",{attrs:{to:"/node/errors.html#errors_class_error"}},[n("code",[t._v("Error")])]),t._v(" occurs\nwhile compiling the "),n("code",[t._v("code")]),t._v(", the line of code causing the error is attached\nto the stack trace. "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("true")]),t._v(".")],1),t._v(" "),n("li",[n("code",[t._v("timeout")]),t._v(" {integer} Specifies the number of milliseconds to execute "),n("code",[t._v("code")]),t._v("\nbefore terminating execution. If execution is terminated, an "),n("router-link",{attrs:{to:"/node/errors.html#errors_class_error"}},[n("code",[t._v("Error")])]),t._v("\nwill be thrown. This value must be a strictly positive integer.")],1),t._v(" "),n("li",[n("code",[t._v("breakOnSigint")]),t._v(" {boolean} If "),n("code",[t._v("true")]),t._v(", the execution will be terminated when\n"),n("code",[t._v("SIGINT")]),t._v(" (Ctrl+C) is received. Existing handlers for the\nevent that have been attached via "),n("code",[t._v("process.on('SIGINT')")]),t._v(" will be disabled\nduring script execution, but will continue to work after that. If execution\nis terminated, an "),n("router-link",{attrs:{to:"/node/errors.html#errors_class_error"}},[n("code",[t._v("Error")])]),t._v(" will be thrown. "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("false")]),t._v(".")],1),t._v(" "),n("li",[n("code",[t._v("contextName")]),t._v(" {string} Human-readable name of the newly created context.\n"),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("'VM Context i'")]),t._v(", where "),n("code",[t._v("i")]),t._v(" is an ascending numerical index of\nthe created context.")]),t._v(" "),n("li",[n("code",[t._v("contextOrigin")]),t._v(" {string} "),n("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Glossary/Origin",target:"_blank",rel:"noopener noreferrer"}},[t._v("Origin"),n("OutboundLink")],1),t._v(" corresponding to the newly\ncreated context for display purposes. The origin should be formatted like a\nURL, but with only the scheme, host, and port (if necessary), like the\nvalue of the "),n("router-link",{attrs:{to:"/node/url.html#url_url_origin"}},[n("code",[t._v("url.origin")])]),t._v(" property of a "),n("router-link",{attrs:{to:"/node/url.html#url_class_url"}},[n("code",[t._v("URL")])]),t._v(" object. Most notably,\nthis string should omit the trailing slash, as that denotes a path.\n"),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("''")]),t._v(".")],1),t._v(" "),n("li",[n("code",[t._v("contextCodeGeneration")]),t._v(" {Object}\n"),n("ul",[n("li",[n("code",[t._v("strings")]),t._v(" {boolean} If set to false any calls to "),n("code",[t._v("eval")]),t._v(" or function\nconstructors ("),n("code",[t._v("Function")]),t._v(", "),n("code",[t._v("GeneratorFunction")]),t._v(", etc) will throw an\n"),n("code",[t._v("EvalError")]),t._v(". "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("true")]),t._v(".")]),t._v(" "),n("li",[n("code",[t._v("wasm")]),t._v(" {boolean} If set to false any attempt to compile a WebAssembly\nmodule will throw a "),n("code",[t._v("WebAssembly.CompileError")]),t._v(". "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("true")]),t._v(".")])])])])]),t._v(" "),n("li",[t._v("Returns: {any} the result of the very last statement executed in the script.")])]),t._v(" "),n("p",[t._v("First contextifies the given "),n("code",[t._v("sandbox")]),t._v(", runs the compiled code contained by\nthe "),n("code",[t._v("vm.Script")]),t._v(" object within the created sandbox, and returns the result.\nRunning code does not have access to local scope.")]),t._v(" "),n("p",[t._v("The following example compiles code that sets a global variable, then executes\nthe code multiple times in different contexts. The globals are set on and\ncontained within each individual "),n("code",[t._v("sandbox")]),t._v(".")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" util "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'util'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" vm "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vm'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" script "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'globalVar = \"set\"'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" sandboxes "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nsandboxes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("forEach")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("sandbox")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  script"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("runInNewContext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sandbox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("util"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("inspect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sandboxes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// [{ globalVar: 'set' }, { globalVar: 'set' }, { globalVar: 'set' }]")]),t._v("\n")])])]),n("h3",{attrs:{id:"script-runinthiscontext-options"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#script-runinthiscontext-options"}},[t._v("#")]),t._v(" script.runInThisContext([options])")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("options")]),t._v(" {Object}\n"),n("ul",[n("li",[n("code",[t._v("displayErrors")]),t._v(" {boolean} When "),n("code",[t._v("true")]),t._v(", if an "),n("router-link",{attrs:{to:"/node/errors.html#errors_class_error"}},[n("code",[t._v("Error")])]),t._v(" occurs\nwhile compiling the "),n("code",[t._v("code")]),t._v(", the line of code causing the error is attached\nto the stack trace. "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("true")]),t._v(".")],1),t._v(" "),n("li",[n("code",[t._v("timeout")]),t._v(" {integer} Specifies the number of milliseconds to execute "),n("code",[t._v("code")]),t._v("\nbefore terminating execution. If execution is terminated, an "),n("router-link",{attrs:{to:"/node/errors.html#errors_class_error"}},[n("code",[t._v("Error")])]),t._v("\nwill be thrown. This value must be a strictly positive integer.")],1),t._v(" "),n("li",[n("code",[t._v("breakOnSigint")]),t._v(" {boolean} If "),n("code",[t._v("true")]),t._v(", the execution will be terminated when\n"),n("code",[t._v("SIGINT")]),t._v(" (Ctrl+C) is received. Existing handlers for the\nevent that have been attached via "),n("code",[t._v("process.on('SIGINT')")]),t._v(" will be disabled\nduring script execution, but will continue to work after that. If execution\nis terminated, an "),n("router-link",{attrs:{to:"/node/errors.html#errors_class_error"}},[n("code",[t._v("Error")])]),t._v(" will be thrown. "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("false")]),t._v(".")],1)])]),t._v(" "),n("li",[t._v("Returns: {any} the result of the very last statement executed in the script.")])]),t._v(" "),n("p",[t._v("Runs the compiled code contained by the "),n("code",[t._v("vm.Script")]),t._v(" within the context of the\ncurrent "),n("code",[t._v("global")]),t._v(" object. Running code does not have access to local scope, but\n"),n("em",[t._v("does")]),t._v(" have access to the current "),n("code",[t._v("global")]),t._v(" object.")]),t._v(" "),n("p",[t._v("The following example compiles code that increments a "),n("code",[t._v("global")]),t._v(" variable then\nexecutes that code multiple times:")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" vm "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vm'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nglobal"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("globalVar "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" script "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'globalVar += 1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" filename"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'myfile.vm'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  script"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("runInThisContext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("globalVar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1000")]),t._v("\n")])])]),n("h2",{attrs:{id:"class-vm-module"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#class-vm-module"}},[t._v("#")]),t._v(" Class: vm.Module")]),t._v(" "),n("blockquote",[n("p",[t._v("Stability: 1 - Experimental")])]),t._v(" "),n("p",[n("em",[t._v("This feature is only available with the "),n("code",[t._v("--experimental-vm-modules")]),t._v(" command\nflag enabled.")])]),t._v(" "),n("p",[t._v("The "),n("code",[t._v("vm.Module")]),t._v(" class provides a low-level interface for using\nECMAScript modules in VM contexts. It is the counterpart of the "),n("code",[t._v("vm.Script")]),t._v("\nclass that closely mirrors "),n("a",{attrs:{href:"https://www.ecma-international.org/ecma-262/#sec-abstract-module-records",target:"_blank",rel:"noopener noreferrer"}},[t._v("Module Record"),n("OutboundLink")],1),t._v("s as defined in the ECMAScript\nspecification.")]),t._v(" "),n("p",[t._v("Unlike "),n("code",[t._v("vm.Script")]),t._v(" however, every "),n("code",[t._v("vm.Module")]),t._v(" object is bound to a context from\nits creation. Operations on "),n("code",[t._v("vm.Module")]),t._v(" objects are intrinsically asynchronous,\nin contrast with the synchronous nature of "),n("code",[t._v("vm.Script")]),t._v(" objects. With the help\nof async functions, however, manipulating "),n("code",[t._v("vm.Module")]),t._v(" objects is fairly\nstraightforward.")]),t._v(" "),n("p",[t._v("Using a "),n("code",[t._v("vm.Module")]),t._v(" object requires three distinct steps: creation/parsing,\nlinking, and evaluation. These three steps are illustrated in the following\nexample.")]),t._v(" "),n("p",[t._v("This implementation lies at a lower level than the "),n("router-link",{attrs:{to:"/node/esm.html#esm_ecmascript_modules"}},[t._v("ECMAScript Module\nloader")]),t._v(". There is also currently no way to interact with the Loader, though\nsupport is planned.")],1),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" vm "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vm'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" contextifiedSandbox "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createContext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secret"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("42")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Step 1")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Create a Module by constructing a new `vm.SourceTextModule` object. This")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// parses the provided source text, throwing a `SyntaxError` if anything goes")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// wrong. By default, a Module is created in the top context. But here, we")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// specify `contextifiedSandbox` as the context this Module belongs to.")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// Here, we attempt to obtain the default export from the module "foo", and')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// put it into local binding "secret".')]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" bar "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SourceTextModule")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("\n    import s from 'foo';\n    s;\n  ")]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" contextifiedSandbox "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Step 2")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// "Link" the imported dependencies of this Module to it.')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// The provided linking callback (the "linker") accepts two arguments: the')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// parent module (`bar` in this case) and the string that is the specifier of")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// the imported module. The callback is expected to return a Module that")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// corresponds to the provided specifier, with certain requirements documented")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// in `module.link()`.")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// If linking has not started for the returned Module, the same linker")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// callback will be called on the returned Module.")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Even top-level Modules without dependencies must be explicitly linked. The")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// callback provided would never be called, however.")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// The link() method returns a Promise that will be resolved when all the")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Promises returned by the linker resolve.")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Note: This is a contrived example in that the linker function creates a new")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// "foo" module every time it is called. In a full-fledged module system, a')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// cache would probably be used to avoid duplicated modules.")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("linker")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("specifier"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" referencingModule")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("specifier "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'foo'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SourceTextModule")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('\n        // The "secret" variable refers to the global variable we added to\n        // "contextifiedSandbox" when creating the context.\n        export default secret;\n      ')]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" referencingModule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("context "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Using `contextifiedSandbox` instead of `referencingModule.context`")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// here would work as well.")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("Unable to resolve dependency: ")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("specifier"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" bar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("link")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("linker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Step 3")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Evaluate the Module. The evaluate() method returns a Promise with a single")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// property "result" that contains the result of the very last statement')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// executed in the Module. In the case of `bar`, it is `s;`, which refers to")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// the default export of the `foo` module, the `secret` we set in the")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// beginning to 42.")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" result "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" bar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("evaluate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Prints 42.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("h3",{attrs:{id:"module-dependencyspecifiers"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#module-dependencyspecifiers"}},[t._v("#")]),t._v(" module.dependencySpecifiers")]),t._v(" "),n("ul",[n("li",[t._v("{string[]}")])]),t._v(" "),n("p",[t._v("The specifiers of all dependencies of this module. The returned array is frozen\nto disallow any changes to it.")]),t._v(" "),n("p",[t._v("Corresponds to the "),n("code",[t._v("[[RequestedModules]]")]),t._v(" field of "),n("a",{attrs:{href:"https://tc39.es/ecma262/#sec-cyclic-module-records",target:"_blank",rel:"noopener noreferrer"}},[t._v("Cyclic Module Record"),n("OutboundLink")],1),t._v("s in\nthe ECMAScript specification.")]),t._v(" "),n("h3",{attrs:{id:"module-error"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#module-error"}},[t._v("#")]),t._v(" module.error")]),t._v(" "),n("ul",[n("li",[t._v("{any}")])]),t._v(" "),n("p",[t._v("If the "),n("code",[t._v("module.status")]),t._v(" is "),n("code",[t._v("'errored'")]),t._v(", this property contains the exception\nthrown by the module during evaluation. If the status is anything else,\naccessing this property will result in a thrown exception.")]),t._v(" "),n("p",[t._v("The value "),n("code",[t._v("undefined")]),t._v(" cannot be used for cases where there is not a thrown\nexception due to possible ambiguity with "),n("code",[t._v("throw undefined;")]),t._v(".")]),t._v(" "),n("p",[t._v("Corresponds to the "),n("code",[t._v("[[EvaluationError]]")]),t._v(" field of "),n("a",{attrs:{href:"https://tc39.es/ecma262/#sec-cyclic-module-records",target:"_blank",rel:"noopener noreferrer"}},[t._v("Cyclic Module Record"),n("OutboundLink")],1),t._v("s\nin the ECMAScript specification.")]),t._v(" "),n("h3",{attrs:{id:"module-evaluate-options"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#module-evaluate-options"}},[t._v("#")]),t._v(" module.evaluate([options])")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("options")]),t._v(" {Object}\n"),n("ul",[n("li",[n("code",[t._v("timeout")]),t._v(" {integer} Specifies the number of milliseconds to evaluate\nbefore terminating execution. If execution is interrupted, an "),n("router-link",{attrs:{to:"/node/errors.html#errors_class_error"}},[n("code",[t._v("Error")])]),t._v("\nwill be thrown. This value must be a strictly positive integer.")],1),t._v(" "),n("li",[n("code",[t._v("breakOnSigint")]),t._v(" {boolean} If "),n("code",[t._v("true")]),t._v(", the execution will be terminated when\n"),n("code",[t._v("SIGINT")]),t._v(" (Ctrl+C) is received. Existing handlers for the event that have\nbeen attached via "),n("code",[t._v("process.on('SIGINT')")]),t._v(" will be disabled during script\nexecution, but will continue to work after that. If execution is\ninterrupted, an "),n("router-link",{attrs:{to:"/node/errors.html#errors_class_error"}},[n("code",[t._v("Error")])]),t._v(" will be thrown. "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("false")]),t._v(".")],1)])]),t._v(" "),n("li",[t._v("Returns: {Promise}")])]),t._v(" "),n("p",[t._v("Evaluate the module.")]),t._v(" "),n("p",[t._v("This must be called after the module has been linked; otherwise it will\nthrow an error. It could be called also when the module has already been\nevaluated, in which case it will do one of the following two things:")]),t._v(" "),n("ul",[n("li",[t._v("return "),n("code",[t._v("undefined")]),t._v(" if the initial evaluation ended in success ("),n("code",[t._v("module.status")]),t._v("\nis "),n("code",[t._v("'evaluated'")]),t._v(")")]),t._v(" "),n("li",[t._v("rethrow the same exception the initial evaluation threw if the initial\nevaluation ended in an error ("),n("code",[t._v("module.status")]),t._v(" is "),n("code",[t._v("'errored'")]),t._v(")")])]),t._v(" "),n("p",[t._v("This method cannot be called while the module is being evaluated\n("),n("code",[t._v("module.status")]),t._v(" is "),n("code",[t._v("'evaluating'")]),t._v(") to prevent infinite recursion.")]),t._v(" "),n("p",[t._v("Corresponds to the "),n("a",{attrs:{href:"https://tc39.es/ecma262/#sec-moduleevaluation",target:"_blank",rel:"noopener noreferrer"}},[t._v("Evaluate() concrete method"),n("OutboundLink")],1),t._v(" field of "),n("a",{attrs:{href:"https://tc39.es/ecma262/#sec-cyclic-module-records",target:"_blank",rel:"noopener noreferrer"}},[t._v("Cyclic Module\nRecord"),n("OutboundLink")],1),t._v("s in the ECMAScript specification.")]),t._v(" "),n("h3",{attrs:{id:"module-link-linker"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#module-link-linker"}},[t._v("#")]),t._v(" module.link(linker)")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("linker")]),t._v(" {Function}\n"),n("ul",[n("li",[n("p",[n("code",[t._v("specifier")]),t._v(" {string} The specifier of the requested module:\n")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" foo "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'foo'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//              ^^^^^ the module specifier")]),t._v("\n")])])])]),t._v(" "),n("li",[n("p",[n("code",[t._v("referencingModule")]),t._v(" {vm.Module} The "),n("code",[t._v("Module")]),t._v(" object "),n("code",[t._v("link()")]),t._v(" is called on.")])]),t._v(" "),n("li",[n("p",[t._v("Returns: {vm.Module|Promise}")])])])]),t._v(" "),n("li",[t._v("Returns: {Promise}")])]),t._v(" "),n("p",[t._v("Link module dependencies. This method must be called before evaluation, and\ncan only be called once per module.")]),t._v(" "),n("p",[t._v("The function is expected to return a "),n("code",[t._v("Module")]),t._v(" object or a "),n("code",[t._v("Promise")]),t._v(" that\neventually resolves to a "),n("code",[t._v("Module")]),t._v(" object. The returned "),n("code",[t._v("Module")]),t._v(" must satisfy the\nfollowing two invariants:")]),t._v(" "),n("ul",[n("li",[t._v("It must belong to the same context as the parent "),n("code",[t._v("Module")]),t._v(".")]),t._v(" "),n("li",[t._v("Its "),n("code",[t._v("status")]),t._v(" must not be "),n("code",[t._v("'errored'")]),t._v(".")])]),t._v(" "),n("p",[t._v("If the returned "),n("code",[t._v("Module")]),t._v("'s "),n("code",[t._v("status")]),t._v(" is "),n("code",[t._v("'unlinked'")]),t._v(", this method will be\nrecursively called on the returned "),n("code",[t._v("Module")]),t._v(" with the same provided "),n("code",[t._v("linker")]),t._v("\nfunction.")]),t._v(" "),n("p",[n("code",[t._v("link()")]),t._v(" returns a "),n("code",[t._v("Promise")]),t._v(" that will either get resolved when all linking\ninstances resolve to a valid "),n("code",[t._v("Module")]),t._v(", or rejected if the linker function either\nthrows an exception or returns an invalid "),n("code",[t._v("Module")]),t._v(".")]),t._v(" "),n("p",[t._v("The linker function roughly corresponds to the implementation-defined\n"),n("a",{attrs:{href:"https://tc39.es/ecma262/#sec-hostresolveimportedmodule",target:"_blank",rel:"noopener noreferrer"}},[t._v("HostResolveImportedModule"),n("OutboundLink")],1),t._v(" abstract operation in the ECMAScript\nspecification, with a few key differences:")]),t._v(" "),n("ul",[n("li",[t._v("The linker function is allowed to be asynchronous while\n"),n("a",{attrs:{href:"https://tc39.es/ecma262/#sec-hostresolveimportedmodule",target:"_blank",rel:"noopener noreferrer"}},[t._v("HostResolveImportedModule"),n("OutboundLink")],1),t._v(" is synchronous.")])]),t._v(" "),n("p",[t._v("The actual "),n("a",{attrs:{href:"https://tc39.es/ecma262/#sec-hostresolveimportedmodule",target:"_blank",rel:"noopener noreferrer"}},[t._v("HostResolveImportedModule"),n("OutboundLink")],1),t._v(" implementation used during module\nlinking is one that returns the modules linked during linking. Since at\nthat point all modules would have been fully linked already, the\n"),n("a",{attrs:{href:"https://tc39.es/ecma262/#sec-hostresolveimportedmodule",target:"_blank",rel:"noopener noreferrer"}},[t._v("HostResolveImportedModule"),n("OutboundLink")],1),t._v(" implementation is fully synchronous per\nspecification.")]),t._v(" "),n("p",[t._v("Corresponds to the "),n("a",{attrs:{href:"https://tc39.es/ecma262/#sec-moduledeclarationlinking",target:"_blank",rel:"noopener noreferrer"}},[t._v("Link() concrete method"),n("OutboundLink")],1),t._v(" field of "),n("a",{attrs:{href:"https://tc39.es/ecma262/#sec-cyclic-module-records",target:"_blank",rel:"noopener noreferrer"}},[t._v("Cyclic Module\nRecord"),n("OutboundLink")],1),t._v("s in the ECMAScript specification.")]),t._v(" "),n("h3",{attrs:{id:"module-namespace"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#module-namespace"}},[t._v("#")]),t._v(" module.namespace")]),t._v(" "),n("ul",[n("li",[t._v("{Object}")])]),t._v(" "),n("p",[t._v("The namespace object of the module. This is only available after linking\n("),n("code",[t._v("module.link()")]),t._v(") has completed.")]),t._v(" "),n("p",[t._v("Corresponds to the "),n("a",{attrs:{href:"https://tc39.es/ecma262/#sec-getmodulenamespace",target:"_blank",rel:"noopener noreferrer"}},[t._v("GetModuleNamespace"),n("OutboundLink")],1),t._v(" abstract operation in the ECMAScript\nspecification.")]),t._v(" "),n("h3",{attrs:{id:"module-status"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#module-status"}},[t._v("#")]),t._v(" module.status")]),t._v(" "),n("ul",[n("li",[t._v("{string}")])]),t._v(" "),n("p",[t._v("The current status of the module. Will be one of:")]),t._v(" "),n("ul",[n("li",[n("p",[n("code",[t._v("'unlinked'")]),t._v(": "),n("code",[t._v("module.link()")]),t._v(" has not yet been called.")])]),t._v(" "),n("li",[n("p",[n("code",[t._v("'linking'")]),t._v(": "),n("code",[t._v("module.link()")]),t._v(" has been called, but not all Promises returned\nby the linker function have been resolved yet.")])]),t._v(" "),n("li",[n("p",[n("code",[t._v("'linked'")]),t._v(": The module has been linked successfully, and all of its\ndependencies are linked, but "),n("code",[t._v("module.evaluate()")]),t._v(" has not yet been called.")])]),t._v(" "),n("li",[n("p",[n("code",[t._v("'evaluating'")]),t._v(": The module is being evaluated through a "),n("code",[t._v("module.evaluate()")]),t._v(" on\nitself or a parent module.")])]),t._v(" "),n("li",[n("p",[n("code",[t._v("'evaluated'")]),t._v(": The module has been successfully evaluated.")])]),t._v(" "),n("li",[n("p",[n("code",[t._v("'errored'")]),t._v(": The module has been evaluated, but an exception was thrown.")])])]),t._v(" "),n("p",[t._v("Other than "),n("code",[t._v("'errored'")]),t._v(", this status string corresponds to the specification's\n"),n("a",{attrs:{href:"https://tc39.es/ecma262/#sec-cyclic-module-records",target:"_blank",rel:"noopener noreferrer"}},[t._v("Cyclic Module Record"),n("OutboundLink")],1),t._v("'s "),n("code",[t._v("[[Status]]")]),t._v(" field. "),n("code",[t._v("'errored'")]),t._v(" corresponds to\n"),n("code",[t._v("'evaluated'")]),t._v(" in the specification, but with "),n("code",[t._v("[[EvaluationError]]")]),t._v(" set to a\nvalue that is not "),n("code",[t._v("undefined")]),t._v(".")]),t._v(" "),n("h3",{attrs:{id:"module-identifier"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#module-identifier"}},[t._v("#")]),t._v(" module.identifier")]),t._v(" "),n("ul",[n("li",[t._v("{string}")])]),t._v(" "),n("p",[t._v("The identifier of the current module, as set in the constructor.")]),t._v(" "),n("h2",{attrs:{id:"class-vm-sourcetextmodule"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#class-vm-sourcetextmodule"}},[t._v("#")]),t._v(" Class: vm.SourceTextModule")]),t._v(" "),n("blockquote",[n("p",[t._v("Stability: 1 - Experimental")])]),t._v(" "),n("p",[n("em",[t._v("This feature is only available with the "),n("code",[t._v("--experimental-vm-modules")]),t._v(" command\nflag enabled.")])]),t._v(" "),n("ul",[n("li",[t._v("Extends: {vm.Module}")])]),t._v(" "),n("p",[t._v("The "),n("code",[t._v("vm.SourceTextModule")]),t._v(" class provides the "),n("a",{attrs:{href:"https://tc39.es/ecma262/#sec-source-text-module-records",target:"_blank",rel:"noopener noreferrer"}},[t._v("Source Text Module Record"),n("OutboundLink")],1),t._v(" as\ndefined in the ECMAScript specification.")]),t._v(" "),n("h3",{attrs:{id:"constructor-new-vm-sourcetextmodule-code-options"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#constructor-new-vm-sourcetextmodule-code-options"}},[t._v("#")]),t._v(" Constructor: new vm.SourceTextModule(code[, options])")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("code")]),t._v(" {string} JavaScript Module code to parse")]),t._v(" "),n("li",[n("code",[t._v("options")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("identifier")]),t._v(" {string} String used in stack traces.\n"),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("'vm:module(i)'")]),t._v(" where "),n("code",[t._v("i")]),t._v(" is a context-specific ascending\nindex.")]),t._v(" "),n("li",[n("code",[t._v("context")]),t._v(" {Object} The "),n("a",{attrs:{href:"#vm_what_does_it_mean_to_contextify_an_object"}},[t._v("contextified")]),t._v(" object as returned by the\n"),n("code",[t._v("vm.createContext()")]),t._v(" method, to compile and evaluate this "),n("code",[t._v("Module")]),t._v(" in.")]),t._v(" "),n("li",[n("code",[t._v("lineOffset")]),t._v(" {integer} Specifies the line number offset that is displayed\nin stack traces produced by this "),n("code",[t._v("Module")]),t._v(". "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("0")]),t._v(".")]),t._v(" "),n("li",[n("code",[t._v("columnOffset")]),t._v(" {integer} Specifies the column number offset that is\ndisplayed in stack traces produced by this "),n("code",[t._v("Module")]),t._v(". "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("0")]),t._v(".")]),t._v(" "),n("li",[n("code",[t._v("initializeImportMeta")]),t._v(" {Function} Called during evaluation of this "),n("code",[t._v("Module")]),t._v("\nto initialize the "),n("code",[t._v("import.meta")]),t._v(".\n"),n("ul",[n("li",[n("code",[t._v("meta")]),t._v(" {import.meta}")]),t._v(" "),n("li",[n("code",[t._v("module")]),t._v(" {vm.SourceTextModule}")])])]),t._v(" "),n("li",[n("code",[t._v("importModuleDynamically")]),t._v(" {Function} Called during evaluation of this module\nwhen "),n("code",[t._v("import()")]),t._v(" is called. If this option is not specified, calls to\n"),n("code",[t._v("import()")]),t._v(" will reject with "),n("router-link",{attrs:{to:"/node/errors.html#ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING"}},[n("code",[t._v("ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING")])]),t._v(".\n"),n("ul",[n("li",[n("code",[t._v("specifier")]),t._v(" {string} specifier passed to "),n("code",[t._v("import()")])]),t._v(" "),n("li",[n("code",[t._v("module")]),t._v(" {vm.Module}")]),t._v(" "),n("li",[t._v("Returns: {Module Namespace Object|vm.Module} Returning a "),n("code",[t._v("vm.Module")]),t._v(" is\nrecommended in order to take advantage of error tracking, and to avoid\nissues with namespaces that contain "),n("code",[t._v("then")]),t._v(" function exports.")])])],1)])])]),t._v(" "),n("p",[t._v("Creates a new "),n("code",[t._v("SourceTextModule")]),t._v(" instance.")]),t._v(" "),n("p",[t._v("Properties assigned to the "),n("code",[t._v("import.meta")]),t._v(" object that are objects may\nallow the module to access information outside the specified "),n("code",[t._v("context")]),t._v(". Use\n"),n("code",[t._v("vm.runInContext()")]),t._v(" to create objects in a specific context.")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" vm "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vm'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" contextifiedSandbox "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createContext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secret"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("42")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" module "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SourceTextModule")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Object.getPrototypeOf(import.meta.prop).secret = secret;'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("initializeImportMeta")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("meta")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Note: this object is created in the top context. As such,")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Object.getPrototypeOf(import.meta.prop) points to the")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Object.prototype in the top context rather than that in")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// the sandbox.")]),t._v("\n        meta"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prop "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Since module has no dependencies, the linker function will never be called.")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" module"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("link")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" module"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("evaluate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Now, Object.prototype.secret will be equal to 42.")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// To fix this problem, replace")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//     meta.prop = {};")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// above with")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//     meta.prop = vm.runInContext('{}', contextifiedSandbox);")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("h2",{attrs:{id:"class-vm-syntheticmodule"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#class-vm-syntheticmodule"}},[t._v("#")]),t._v(" Class: vm.SyntheticModule")]),t._v(" "),n("blockquote",[n("p",[t._v("Stability: 1 - Experimental")])]),t._v(" "),n("p",[n("em",[t._v("This feature is only available with the "),n("code",[t._v("--experimental-vm-modules")]),t._v(" command\nflag enabled.")])]),t._v(" "),n("ul",[n("li",[t._v("Extends: {vm.Module}")])]),t._v(" "),n("p",[t._v("The "),n("code",[t._v("vm.SyntheticModule")]),t._v(" class provides the "),n("a",{attrs:{href:"https://heycam.github.io/webidl/#synthetic-module-records",target:"_blank",rel:"noopener noreferrer"}},[t._v("Synthetic Module Record"),n("OutboundLink")],1),t._v(" as\ndefined in the WebIDL specification. The purpose of synthetic modules is to\nprovide a generic interface for exposing non-JavaScript sources to ECMAScript\nmodule graphs.")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" vm "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vm'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" source "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{ \"a\": 1 }'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" module "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SyntheticModule")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'default'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" obj "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("parse")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("source"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setExport")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'default'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" obj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Use `module` in linking...")]),t._v("\n")])])]),n("h3",{attrs:{id:"constructor-new-vm-syntheticmodule-exportnames-evaluatecallback-options"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#constructor-new-vm-syntheticmodule-exportnames-evaluatecallback-options"}},[t._v("#")]),t._v(" Constructor: new vm.SyntheticModule(exportNames, evaluateCallback[, options])")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("exportNames")]),t._v(" {string[]} Array of names that will be exported from the module.")]),t._v(" "),n("li",[n("code",[t._v("evaluateCallback")]),t._v(" {Function} Called when the module is evaluated.")]),t._v(" "),n("li",[n("code",[t._v("options")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("identifier")]),t._v(" {string} String used in stack traces.\n"),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("'vm:module(i)'")]),t._v(" where "),n("code",[t._v("i")]),t._v(" is a context-specific ascending\nindex.")]),t._v(" "),n("li",[n("code",[t._v("context")]),t._v(" {Object} The "),n("a",{attrs:{href:"#vm_what_does_it_mean_to_contextify_an_object"}},[t._v("contextified")]),t._v(" object as returned by the\n"),n("code",[t._v("vm.createContext()")]),t._v(" method, to compile and evaluate this "),n("code",[t._v("Module")]),t._v(" in.")])])])]),t._v(" "),n("p",[t._v("Creates a new "),n("code",[t._v("SyntheticModule")]),t._v(" instance.")]),t._v(" "),n("p",[t._v("Objects assigned to the exports of this instance may allow importers of\nthe module to access information outside the specified "),n("code",[t._v("context")]),t._v(". Use\n"),n("code",[t._v("vm.runInContext()")]),t._v(" to create objects in a specific context.")]),t._v(" "),n("h3",{attrs:{id:"syntheticmodule-setexport-name-value"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#syntheticmodule-setexport-name-value"}},[t._v("#")]),t._v(" syntheticModule.setExport(name, value)")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("name")]),t._v(" {string} Name of the export to set.")]),t._v(" "),n("li",[n("code",[t._v("value")]),t._v(" {any} The value to set the export to.")])]),t._v(" "),n("p",[t._v("This method is used after the module is linked to set the values of exports. If\nit is called before the module is linked, an "),n("router-link",{attrs:{to:"/node/errors.html#ERR_VM_MODULE_STATUS"}},[n("code",[t._v("ERR_VM_MODULE_STATUS")])]),t._v(" error\nwill be thrown.")],1),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" vm "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vm'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" m "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SyntheticModule")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'x'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    m"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setExport")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'x'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" m"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("link")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" m"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("evaluate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  assert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("strictEqual")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("m"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("namespace"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("h2",{attrs:{id:"vm-compilefunction-code-params-options"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vm-compilefunction-code-params-options"}},[t._v("#")]),t._v(" vm.compileFunction(code[, params[, options]])")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("code")]),t._v(" {string} The body of the function to compile.")]),t._v(" "),n("li",[n("code",[t._v("params")]),t._v(" {string[]} An array of strings containing all parameters for the\nfunction.")]),t._v(" "),n("li",[n("code",[t._v("options")]),t._v(" {Object}\n"),n("ul",[n("li",[n("code",[t._v("filename")]),t._v(" {string} Specifies the filename used in stack traces produced\nby this script. "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("''")]),t._v(".")]),t._v(" "),n("li",[n("code",[t._v("lineOffset")]),t._v(" {number} Specifies the line number offset that is displayed\nin stack traces produced by this script. "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("0")]),t._v(".")]),t._v(" "),n("li",[n("code",[t._v("columnOffset")]),t._v(" {number} Specifies the column number offset that is displayed\nin stack traces produced by this script. "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("0")]),t._v(".")]),t._v(" "),n("li",[n("code",[t._v("cachedData")]),t._v(" {Buffer|TypedArray|DataView} Provides an optional "),n("code",[t._v("Buffer")]),t._v(" or\n"),n("code",[t._v("TypedArray")]),t._v(", or "),n("code",[t._v("DataView")]),t._v(" with V8's code cache data for the supplied\nsource.")]),t._v(" "),n("li",[n("code",[t._v("produceCachedData")]),t._v(" {boolean} Specifies whether to produce new cache data.\n"),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("false")]),t._v(".")]),t._v(" "),n("li",[n("code",[t._v("parsingContext")]),t._v(" {Object} The "),n("a",{attrs:{href:"#vm_what_does_it_mean_to_contextify_an_object"}},[t._v("contextified")]),t._v(" sandbox in which the said\nfunction should be compiled in.")]),t._v(" "),n("li",[n("code",[t._v("contextExtensions")]),t._v(" {Object[]} An array containing a collection of context\nextensions (objects wrapping the current scope) to be applied while\ncompiling. "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("[]")]),t._v(".")])])]),t._v(" "),n("li",[t._v("Returns: {Function}")])]),t._v(" "),n("p",[t._v("Compiles the given code into the provided context/sandbox (if no context is\nsupplied, the current context is used), and returns it wrapped inside a\nfunction with the given "),n("code",[t._v("params")]),t._v(".")]),t._v(" "),n("h2",{attrs:{id:"vm-createcontext-sandbox-options"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vm-createcontext-sandbox-options"}},[t._v("#")]),t._v(" vm.createContext([sandbox[, options]])")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("sandbox")]),t._v(" {Object}")]),t._v(" "),n("li",[n("code",[t._v("options")]),t._v(" {Object}\n"),n("ul",[n("li",[n("code",[t._v("name")]),t._v(" {string} Human-readable name of the newly created context.\n"),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("'VM Context i'")]),t._v(", where "),n("code",[t._v("i")]),t._v(" is an ascending numerical index of\nthe created context.")]),t._v(" "),n("li",[n("code",[t._v("origin")]),t._v(" {string} "),n("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Glossary/Origin",target:"_blank",rel:"noopener noreferrer"}},[t._v("Origin"),n("OutboundLink")],1),t._v(" corresponding to the newly created\ncontext for display purposes. The origin should be formatted like a URL,\nbut with only the scheme, host, and port (if necessary), like the value of\nthe "),n("router-link",{attrs:{to:"/node/url.html#url_url_origin"}},[n("code",[t._v("url.origin")])]),t._v(" property of a "),n("router-link",{attrs:{to:"/node/url.html#url_class_url"}},[n("code",[t._v("URL")])]),t._v(" object. Most notably, this\nstring should omit the trailing slash, as that denotes a path.\n"),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("''")]),t._v(".")],1),t._v(" "),n("li",[n("code",[t._v("codeGeneration")]),t._v(" {Object}\n"),n("ul",[n("li",[n("code",[t._v("strings")]),t._v(" {boolean} If set to false any calls to "),n("code",[t._v("eval")]),t._v(" or function\nconstructors ("),n("code",[t._v("Function")]),t._v(", "),n("code",[t._v("GeneratorFunction")]),t._v(", etc) will throw an\n"),n("code",[t._v("EvalError")]),t._v(". "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("true")]),t._v(".")]),t._v(" "),n("li",[n("code",[t._v("wasm")]),t._v(" {boolean} If set to false any attempt to compile a WebAssembly\nmodule will throw a "),n("code",[t._v("WebAssembly.CompileError")]),t._v(". "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("true")]),t._v(".")])])])])]),t._v(" "),n("li",[t._v("Returns: {Object} contextified sandbox.")])]),t._v(" "),n("p",[t._v("If given a "),n("code",[t._v("sandbox")]),t._v(" object, the "),n("code",[t._v("vm.createContext()")]),t._v(" method will "),n("a",{attrs:{href:"#vm_what_does_it_mean_to_contextify_an_object"}},[t._v("prepare\nthat sandbox")]),t._v(" so that it can be used in calls to\n"),n("a",{attrs:{href:"#vm_vm_runincontext_code_contextifiedsandbox_options"}},[n("code",[t._v("vm.runInContext()")])]),t._v(" or "),n("a",{attrs:{href:"#vm_script_runincontext_contextifiedsandbox_options"}},[n("code",[t._v("script.runInContext()")])]),t._v(". Inside such scripts,\nthe "),n("code",[t._v("sandbox")]),t._v(" object will be the global object, retaining all of its existing\nproperties but also having the built-in objects and functions any standard\n"),n("a",{attrs:{href:"https://es5.github.io/#x15.1",target:"_blank",rel:"noopener noreferrer"}},[t._v("global object"),n("OutboundLink")],1),t._v(" has. Outside of scripts run by the vm module, global variables\nwill remain unchanged.")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" util "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'util'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" vm "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vm'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nglobal"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("globalVar "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" sandbox "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" globalVar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nvm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createContext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sandbox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nvm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("runInContext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'globalVar *= 2;'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sandbox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("util"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("inspect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sandbox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// { globalVar: 2 }")]),t._v("\n\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("util"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("inspect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("globalVar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 3")]),t._v("\n")])])]),n("p",[t._v("If "),n("code",[t._v("sandbox")]),t._v(" is omitted (or passed explicitly as "),n("code",[t._v("undefined")]),t._v("), a new, empty\n"),n("a",{attrs:{href:"#vm_what_does_it_mean_to_contextify_an_object"}},[t._v("contextified")]),t._v(" sandbox object will be returned.")]),t._v(" "),n("p",[t._v("The "),n("code",[t._v("vm.createContext()")]),t._v(" method is primarily useful for creating a single\nsandbox that can be used to run multiple scripts. For instance, if emulating a\nweb browser, the method can be used to create a single sandbox representing a\nwindow's global object, then run all "),n("code",[t._v("<script>")]),t._v(" tags together within the context\nof that sandbox.")]),t._v(" "),n("p",[t._v("The provided "),n("code",[t._v("name")]),t._v(" and "),n("code",[t._v("origin")]),t._v(" of the context are made visible through the\nInspector API.")]),t._v(" "),n("h2",{attrs:{id:"vm-iscontext-sandbox"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vm-iscontext-sandbox"}},[t._v("#")]),t._v(" vm.isContext(sandbox)")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("sandbox")]),t._v(" {Object}")]),t._v(" "),n("li",[t._v("Returns: {boolean}")])]),t._v(" "),n("p",[t._v("Returns "),n("code",[t._v("true")]),t._v(" if the given "),n("code",[t._v("sandbox")]),t._v(" object has been "),n("a",{attrs:{href:"#vm_what_does_it_mean_to_contextify_an_object"}},[t._v("contextified")]),t._v(" using\n"),n("a",{attrs:{href:"#vm_vm_createcontext_sandbox_options"}},[n("code",[t._v("vm.createContext()")])]),t._v(".")]),t._v(" "),n("h2",{attrs:{id:"vm-runincontext-code-contextifiedsandbox-options"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vm-runincontext-code-contextifiedsandbox-options"}},[t._v("#")]),t._v(" vm.runInContext(code, contextifiedSandbox[, options])")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("code")]),t._v(" {string} The JavaScript code to compile and run.")]),t._v(" "),n("li",[n("code",[t._v("contextifiedSandbox")]),t._v(" {Object} The "),n("a",{attrs:{href:"#vm_what_does_it_mean_to_contextify_an_object"}},[t._v("contextified")]),t._v(" object that will be used\nas the "),n("code",[t._v("global")]),t._v(" when the "),n("code",[t._v("code")]),t._v(" is compiled and run.")]),t._v(" "),n("li",[n("code",[t._v("options")]),t._v(" {Object|string}\n"),n("ul",[n("li",[n("code",[t._v("filename")]),t._v(" {string} Specifies the filename used in stack traces produced\nby this script. "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("'evalmachine.<anonymous>'")]),t._v(".")]),t._v(" "),n("li",[n("code",[t._v("lineOffset")]),t._v(" {number} Specifies the line number offset that is displayed\nin stack traces produced by this script. "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("0")]),t._v(".")]),t._v(" "),n("li",[n("code",[t._v("columnOffset")]),t._v(" {number} Specifies the column number offset that is displayed\nin stack traces produced by this script. "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("0")]),t._v(".")]),t._v(" "),n("li",[n("code",[t._v("displayErrors")]),t._v(" {boolean} When "),n("code",[t._v("true")]),t._v(", if an "),n("router-link",{attrs:{to:"/node/errors.html#errors_class_error"}},[n("code",[t._v("Error")])]),t._v(" occurs\nwhile compiling the "),n("code",[t._v("code")]),t._v(", the line of code causing the error is attached\nto the stack trace. "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("true")]),t._v(".")],1),t._v(" "),n("li",[n("code",[t._v("timeout")]),t._v(" {integer} Specifies the number of milliseconds to execute "),n("code",[t._v("code")]),t._v("\nbefore terminating execution. If execution is terminated, an "),n("router-link",{attrs:{to:"/node/errors.html#errors_class_error"}},[n("code",[t._v("Error")])]),t._v("\nwill be thrown. This value must be a strictly positive integer.")],1),t._v(" "),n("li",[n("code",[t._v("breakOnSigint")]),t._v(" {boolean} If "),n("code",[t._v("true")]),t._v(", the execution will be terminated when\n"),n("code",[t._v("SIGINT")]),t._v(" (Ctrl+C) is received. Existing handlers for the\nevent that have been attached via "),n("code",[t._v("process.on('SIGINT')")]),t._v(" will be disabled\nduring script execution, but will continue to work after that. If execution\nis terminated, an "),n("router-link",{attrs:{to:"/node/errors.html#errors_class_error"}},[n("code",[t._v("Error")])]),t._v(" will be thrown. "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("false")]),t._v(".")],1),t._v(" "),n("li",[n("code",[t._v("cachedData")]),t._v(" {Buffer|TypedArray|DataView} Provides an optional "),n("code",[t._v("Buffer")]),t._v(" or\n"),n("code",[t._v("TypedArray")]),t._v(", or "),n("code",[t._v("DataView")]),t._v(" with V8's code cache data for the supplied\nsource. When supplied, the "),n("code",[t._v("cachedDataRejected")]),t._v(" value will be set to\neither "),n("code",[t._v("true")]),t._v(" or "),n("code",[t._v("false")]),t._v(" depending on acceptance of the data by V8.")]),t._v(" "),n("li",[n("code",[t._v("produceCachedData")]),t._v(" {boolean} When "),n("code",[t._v("true")]),t._v(" and no "),n("code",[t._v("cachedData")]),t._v(" is present, V8\nwill attempt to produce code cache data for "),n("code",[t._v("code")]),t._v(". Upon success, a\n"),n("code",[t._v("Buffer")]),t._v(" with V8's code cache data will be produced and stored in the\n"),n("code",[t._v("cachedData")]),t._v(" property of the returned "),n("code",[t._v("vm.Script")]),t._v(" instance.\nThe "),n("code",[t._v("cachedDataProduced")]),t._v(" value will be set to either "),n("code",[t._v("true")]),t._v(" or "),n("code",[t._v("false")]),t._v("\ndepending on whether code cache data is produced successfully.\nThis option is "),n("strong",[t._v("deprecated")]),t._v(" in favor of "),n("code",[t._v("script.createCachedData()")]),t._v(".\n"),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("false")]),t._v(".")]),t._v(" "),n("li",[n("code",[t._v("importModuleDynamically")]),t._v(" {Function} Called during evaluation of this module\nwhen "),n("code",[t._v("import()")]),t._v(" is called. If this option is not specified, calls to\n"),n("code",[t._v("import()")]),t._v(" will reject with "),n("router-link",{attrs:{to:"/node/errors.html#ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING"}},[n("code",[t._v("ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING")])]),t._v(".\nThis option is part of the experimental API for the "),n("code",[t._v("--experimental-modules")]),t._v("\nflag, and should not be considered stable.\n"),n("ul",[n("li",[n("code",[t._v("specifier")]),t._v(" {string} specifier passed to "),n("code",[t._v("import()")])]),t._v(" "),n("li",[n("code",[t._v("module")]),t._v(" {vm.Module}")]),t._v(" "),n("li",[t._v("Returns: {Module Namespace Object|vm.Module} Returning a "),n("code",[t._v("vm.Module")]),t._v(" is\nrecommended in order to take advantage of error tracking, and to avoid\nissues with namespaces that contain "),n("code",[t._v("then")]),t._v(" function exports.")])])],1)])]),t._v(" "),n("li",[t._v("Returns: {any} the result of the very last statement executed in the script.")])]),t._v(" "),n("p",[t._v("The "),n("code",[t._v("vm.runInContext()")]),t._v(" method compiles "),n("code",[t._v("code")]),t._v(", runs it within the context of\nthe "),n("code",[t._v("contextifiedSandbox")]),t._v(", then returns the result. Running code does not have\naccess to the local scope. The "),n("code",[t._v("contextifiedSandbox")]),t._v(" object "),n("em",[t._v("must")]),t._v(" have been\npreviously "),n("a",{attrs:{href:"#vm_what_does_it_mean_to_contextify_an_object"}},[t._v("contextified")]),t._v(" using the "),n("a",{attrs:{href:"#vm_vm_createcontext_sandbox_options"}},[n("code",[t._v("vm.createContext()")])]),t._v(" method.")]),t._v(" "),n("p",[t._v("If "),n("code",[t._v("options")]),t._v(" is a string, then it specifies the filename.")]),t._v(" "),n("p",[t._v("The following example compiles and executes different scripts using a single\n"),n("a",{attrs:{href:"#vm_what_does_it_mean_to_contextify_an_object"}},[t._v("contextified")]),t._v(" object:")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" util "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'util'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" vm "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vm'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" sandbox "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" globalVar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nvm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createContext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sandbox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("runInContext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'globalVar *= 2;'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sandbox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("util"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("inspect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sandbox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// { globalVar: 1024 }")]),t._v("\n")])])]),n("h2",{attrs:{id:"vm-runinnewcontext-code-sandbox-options"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vm-runinnewcontext-code-sandbox-options"}},[t._v("#")]),t._v(" vm.runInNewContext(code[, sandbox[, options]])")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("code")]),t._v(" {string} The JavaScript code to compile and run.")]),t._v(" "),n("li",[n("code",[t._v("sandbox")]),t._v(" {Object} An object that will be "),n("a",{attrs:{href:"#vm_what_does_it_mean_to_contextify_an_object"}},[t._v("contextified")]),t._v(". If "),n("code",[t._v("undefined")]),t._v(", a\nnew object will be created.")]),t._v(" "),n("li",[n("code",[t._v("options")]),t._v(" {Object|string}\n"),n("ul",[n("li",[n("code",[t._v("filename")]),t._v(" {string} Specifies the filename used in stack traces produced\nby this script. "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("'evalmachine.<anonymous>'")]),t._v(".")]),t._v(" "),n("li",[n("code",[t._v("lineOffset")]),t._v(" {number} Specifies the line number offset that is displayed\nin stack traces produced by this script. "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("0")]),t._v(".")]),t._v(" "),n("li",[n("code",[t._v("columnOffset")]),t._v(" {number} Specifies the column number offset that is displayed\nin stack traces produced by this script. "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("0")]),t._v(".")]),t._v(" "),n("li",[n("code",[t._v("displayErrors")]),t._v(" {boolean} When "),n("code",[t._v("true")]),t._v(", if an "),n("router-link",{attrs:{to:"/node/errors.html#errors_class_error"}},[n("code",[t._v("Error")])]),t._v(" occurs\nwhile compiling the "),n("code",[t._v("code")]),t._v(", the line of code causing the error is attached\nto the stack trace. "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("true")]),t._v(".")],1),t._v(" "),n("li",[n("code",[t._v("timeout")]),t._v(" {integer} Specifies the number of milliseconds to execute "),n("code",[t._v("code")]),t._v("\nbefore terminating execution. If execution is terminated, an "),n("router-link",{attrs:{to:"/node/errors.html#errors_class_error"}},[n("code",[t._v("Error")])]),t._v("\nwill be thrown. This value must be a strictly positive integer.")],1),t._v(" "),n("li",[n("code",[t._v("breakOnSigint")]),t._v(" {boolean} If "),n("code",[t._v("true")]),t._v(", the execution will be terminated when\n"),n("code",[t._v("SIGINT")]),t._v(" (Ctrl+C) is received. Existing handlers for the\nevent that have been attached via "),n("code",[t._v("process.on('SIGINT')")]),t._v(" will be disabled\nduring script execution, but will continue to work after that. If execution\nis terminated, an "),n("router-link",{attrs:{to:"/node/errors.html#errors_class_error"}},[n("code",[t._v("Error")])]),t._v(" will be thrown. "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("false")]),t._v(".")],1),t._v(" "),n("li",[n("code",[t._v("contextName")]),t._v(" {string} Human-readable name of the newly created context.\n"),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("'VM Context i'")]),t._v(", where "),n("code",[t._v("i")]),t._v(" is an ascending numerical index of\nthe created context.")]),t._v(" "),n("li",[n("code",[t._v("contextOrigin")]),t._v(" {string} "),n("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Glossary/Origin",target:"_blank",rel:"noopener noreferrer"}},[t._v("Origin"),n("OutboundLink")],1),t._v(" corresponding to the newly\ncreated context for display purposes. The origin should be formatted like a\nURL, but with only the scheme, host, and port (if necessary), like the\nvalue of the "),n("router-link",{attrs:{to:"/node/url.html#url_url_origin"}},[n("code",[t._v("url.origin")])]),t._v(" property of a "),n("router-link",{attrs:{to:"/node/url.html#url_class_url"}},[n("code",[t._v("URL")])]),t._v(" object. Most notably,\nthis string should omit the trailing slash, as that denotes a path.\n"),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("''")]),t._v(".")],1),t._v(" "),n("li",[n("code",[t._v("contextCodeGeneration")]),t._v(" {Object}\n"),n("ul",[n("li",[n("code",[t._v("strings")]),t._v(" {boolean} If set to false any calls to "),n("code",[t._v("eval")]),t._v(" or function\nconstructors ("),n("code",[t._v("Function")]),t._v(", "),n("code",[t._v("GeneratorFunction")]),t._v(", etc) will throw an\n"),n("code",[t._v("EvalError")]),t._v(". "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("true")]),t._v(".")]),t._v(" "),n("li",[n("code",[t._v("wasm")]),t._v(" {boolean} If set to false any attempt to compile a WebAssembly\nmodule will throw a "),n("code",[t._v("WebAssembly.CompileError")]),t._v(". "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("true")]),t._v(".")])])]),t._v(" "),n("li",[n("code",[t._v("cachedData")]),t._v(" {Buffer|TypedArray|DataView} Provides an optional "),n("code",[t._v("Buffer")]),t._v(" or\n"),n("code",[t._v("TypedArray")]),t._v(", or "),n("code",[t._v("DataView")]),t._v(" with V8's code cache data for the supplied\nsource. When supplied, the "),n("code",[t._v("cachedDataRejected")]),t._v(" value will be set to\neither "),n("code",[t._v("true")]),t._v(" or "),n("code",[t._v("false")]),t._v(" depending on acceptance of the data by V8.")]),t._v(" "),n("li",[n("code",[t._v("produceCachedData")]),t._v(" {boolean} When "),n("code",[t._v("true")]),t._v(" and no "),n("code",[t._v("cachedData")]),t._v(" is present, V8\nwill attempt to produce code cache data for "),n("code",[t._v("code")]),t._v(". Upon success, a\n"),n("code",[t._v("Buffer")]),t._v(" with V8's code cache data will be produced and stored in the\n"),n("code",[t._v("cachedData")]),t._v(" property of the returned "),n("code",[t._v("vm.Script")]),t._v(" instance.\nThe "),n("code",[t._v("cachedDataProduced")]),t._v(" value will be set to either "),n("code",[t._v("true")]),t._v(" or "),n("code",[t._v("false")]),t._v("\ndepending on whether code cache data is produced successfully.\nThis option is "),n("strong",[t._v("deprecated")]),t._v(" in favor of "),n("code",[t._v("script.createCachedData()")]),t._v(".\n"),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("false")]),t._v(".")]),t._v(" "),n("li",[n("code",[t._v("importModuleDynamically")]),t._v(" {Function} Called during evaluation of this module\nwhen "),n("code",[t._v("import()")]),t._v(" is called. If this option is not specified, calls to\n"),n("code",[t._v("import()")]),t._v(" will reject with "),n("router-link",{attrs:{to:"/node/errors.html#ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING"}},[n("code",[t._v("ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING")])]),t._v(".\nThis option is part of the experimental API for the "),n("code",[t._v("--experimental-modules")]),t._v("\nflag, and should not be considered stable.\n"),n("ul",[n("li",[n("code",[t._v("specifier")]),t._v(" {string} specifier passed to "),n("code",[t._v("import()")])]),t._v(" "),n("li",[n("code",[t._v("module")]),t._v(" {vm.Module}")]),t._v(" "),n("li",[t._v("Returns: {Module Namespace Object|vm.Module} Returning a "),n("code",[t._v("vm.Module")]),t._v(" is\nrecommended in order to take advantage of error tracking, and to avoid\nissues with namespaces that contain "),n("code",[t._v("then")]),t._v(" function exports.")])])],1)])]),t._v(" "),n("li",[t._v("Returns: {any} the result of the very last statement executed in the script.")])]),t._v(" "),n("p",[t._v("The "),n("code",[t._v("vm.runInNewContext()")]),t._v(" first contextifies the given "),n("code",[t._v("sandbox")]),t._v(" object (or\ncreates a new "),n("code",[t._v("sandbox")]),t._v(" if passed as "),n("code",[t._v("undefined")]),t._v("), compiles the "),n("code",[t._v("code")]),t._v(", runs it\nwithin the context of the created context, then returns the result. Running code\ndoes not have access to the local scope.")]),t._v(" "),n("p",[t._v("If "),n("code",[t._v("options")]),t._v(" is a string, then it specifies the filename.")]),t._v(" "),n("p",[t._v("The following example compiles and executes code that increments a global\nvariable and sets a new one. These globals are contained in the "),n("code",[t._v("sandbox")]),t._v(".")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" util "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'util'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" vm "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vm'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" sandbox "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  animal"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cat'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  count"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nvm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("runInNewContext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'count += 1; name = \"kitty\"'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sandbox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("util"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("inspect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sandbox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// { animal: 'cat', count: 3, name: 'kitty' }")]),t._v("\n")])])]),n("h2",{attrs:{id:"vm-runinthiscontext-code-options"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vm-runinthiscontext-code-options"}},[t._v("#")]),t._v(" vm.runInThisContext(code[, options])")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("code")]),t._v(" {string} The JavaScript code to compile and run.")]),t._v(" "),n("li",[n("code",[t._v("options")]),t._v(" {Object|string}\n"),n("ul",[n("li",[n("code",[t._v("filename")]),t._v(" {string} Specifies the filename used in stack traces produced\nby this script. "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("'evalmachine.<anonymous>'")]),t._v(".")]),t._v(" "),n("li",[n("code",[t._v("lineOffset")]),t._v(" {number} Specifies the line number offset that is displayed\nin stack traces produced by this script. "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("0")]),t._v(".")]),t._v(" "),n("li",[n("code",[t._v("columnOffset")]),t._v(" {number} Specifies the column number offset that is displayed\nin stack traces produced by this script. "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("0")]),t._v(".")]),t._v(" "),n("li",[n("code",[t._v("displayErrors")]),t._v(" {boolean} When "),n("code",[t._v("true")]),t._v(", if an "),n("router-link",{attrs:{to:"/node/errors.html#errors_class_error"}},[n("code",[t._v("Error")])]),t._v(" occurs\nwhile compiling the "),n("code",[t._v("code")]),t._v(", the line of code causing the error is attached\nto the stack trace. "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("true")]),t._v(".")],1),t._v(" "),n("li",[n("code",[t._v("timeout")]),t._v(" {integer} Specifies the number of milliseconds to execute "),n("code",[t._v("code")]),t._v("\nbefore terminating execution. If execution is terminated, an "),n("router-link",{attrs:{to:"/node/errors.html#errors_class_error"}},[n("code",[t._v("Error")])]),t._v("\nwill be thrown. This value must be a strictly positive integer.")],1),t._v(" "),n("li",[n("code",[t._v("breakOnSigint")]),t._v(" {boolean} If "),n("code",[t._v("true")]),t._v(", the execution will be terminated when\n"),n("code",[t._v("SIGINT")]),t._v(" (Ctrl+C) is received. Existing handlers for the\nevent that have been attached via "),n("code",[t._v("process.on('SIGINT')")]),t._v(" will be disabled\nduring script execution, but will continue to work after that. If execution\nis terminated, an "),n("router-link",{attrs:{to:"/node/errors.html#errors_class_error"}},[n("code",[t._v("Error")])]),t._v(" will be thrown. "),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("false")]),t._v(".")],1),t._v(" "),n("li",[n("code",[t._v("cachedData")]),t._v(" {Buffer|TypedArray|DataView} Provides an optional "),n("code",[t._v("Buffer")]),t._v(" or\n"),n("code",[t._v("TypedArray")]),t._v(", or "),n("code",[t._v("DataView")]),t._v(" with V8's code cache data for the supplied\nsource. When supplied, the "),n("code",[t._v("cachedDataRejected")]),t._v(" value will be set to\neither "),n("code",[t._v("true")]),t._v(" or "),n("code",[t._v("false")]),t._v(" depending on acceptance of the data by V8.")]),t._v(" "),n("li",[n("code",[t._v("produceCachedData")]),t._v(" {boolean} When "),n("code",[t._v("true")]),t._v(" and no "),n("code",[t._v("cachedData")]),t._v(" is present, V8\nwill attempt to produce code cache data for "),n("code",[t._v("code")]),t._v(". Upon success, a\n"),n("code",[t._v("Buffer")]),t._v(" with V8's code cache data will be produced and stored in the\n"),n("code",[t._v("cachedData")]),t._v(" property of the returned "),n("code",[t._v("vm.Script")]),t._v(" instance.\nThe "),n("code",[t._v("cachedDataProduced")]),t._v(" value will be set to either "),n("code",[t._v("true")]),t._v(" or "),n("code",[t._v("false")]),t._v("\ndepending on whether code cache data is produced successfully.\nThis option is "),n("strong",[t._v("deprecated")]),t._v(" in favor of "),n("code",[t._v("script.createCachedData()")]),t._v(".\n"),n("strong",[t._v("Default:")]),t._v(" "),n("code",[t._v("false")]),t._v(".")]),t._v(" "),n("li",[n("code",[t._v("importModuleDynamically")]),t._v(" {Function} Called during evaluation of this module\nwhen "),n("code",[t._v("import()")]),t._v(" is called. If this option is not specified, calls to\n"),n("code",[t._v("import()")]),t._v(" will reject with "),n("router-link",{attrs:{to:"/node/errors.html#ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING"}},[n("code",[t._v("ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING")])]),t._v(".\nThis option is part of the experimental API for the "),n("code",[t._v("--experimental-modules")]),t._v("\nflag, and should not be considered stable.\n"),n("ul",[n("li",[n("code",[t._v("specifier")]),t._v(" {string} specifier passed to "),n("code",[t._v("import()")])]),t._v(" "),n("li",[n("code",[t._v("module")]),t._v(" {vm.Module}")]),t._v(" "),n("li",[t._v("Returns: {Module Namespace Object|vm.Module} Returning a "),n("code",[t._v("vm.Module")]),t._v(" is\nrecommended in order to take advantage of error tracking, and to avoid\nissues with namespaces that contain "),n("code",[t._v("then")]),t._v(" function exports.")])])],1)])]),t._v(" "),n("li",[t._v("Returns: {any} the result of the very last statement executed in the script.")])]),t._v(" "),n("p",[n("code",[t._v("vm.runInThisContext()")]),t._v(" compiles "),n("code",[t._v("code")]),t._v(", runs it within the context of the\ncurrent "),n("code",[t._v("global")]),t._v(" and returns the result. Running code does not have access to\nlocal scope, but does have access to the current "),n("code",[t._v("global")]),t._v(" object.")]),t._v(" "),n("p",[t._v("If "),n("code",[t._v("options")]),t._v(" is a string, then it specifies the filename.")]),t._v(" "),n("p",[t._v("The following example illustrates using both "),n("code",[t._v("vm.runInThisContext()")]),t._v(" and\nthe JavaScript "),n("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/eval",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("eval()")]),n("OutboundLink")],1),t._v(" function to run the same code:")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" vm "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vm'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" localVar "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'initial value'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" vmResult "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" vm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("runInThisContext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'localVar = \"vm\";'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vmResult:'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vmResult"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'localVar:'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" localVar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" evalResult "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("eval")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'localVar = \"eval\";'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'evalResult:'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" evalResult"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'localVar:'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" localVar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// vmResult: 'vm', localVar: 'initial value'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// evalResult: 'eval', localVar: 'eval'")]),t._v("\n")])])]),n("p",[t._v("Because "),n("code",[t._v("vm.runInThisContext()")]),t._v(" does not have access to the local scope,\n"),n("code",[t._v("localVar")]),t._v(" is unchanged. In contrast, "),n("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/eval",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("eval()")]),n("OutboundLink")],1),t._v(" "),n("em",[t._v("does")]),t._v(" have access to the\nlocal scope, so the value "),n("code",[t._v("localVar")]),t._v(" is changed. In this way\n"),n("code",[t._v("vm.runInThisContext()")]),t._v(" is much like an "),n("a",{attrs:{href:"https://es5.github.io/#x10.4.2",target:"_blank",rel:"noopener noreferrer"}},[t._v("indirect "),n("code",[t._v("eval()")]),t._v(" call"),n("OutboundLink")],1),t._v(", e.g.\n"),n("code",[t._v("(0,eval)('code')")]),t._v(".")]),t._v(" "),n("h2",{attrs:{id:"example-running-an-http-server-within-a-vm"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#example-running-an-http-server-within-a-vm"}},[t._v("#")]),t._v(" Example: Running an HTTP Server within a VM")]),t._v(" "),n("p",[t._v("When using either "),n("a",{attrs:{href:"#vm_script_runinthiscontext_options"}},[n("code",[t._v("script.runInThisContext()")])]),t._v(" or\n"),n("a",{attrs:{href:"#vm_vm_runinthiscontext_code_options"}},[n("code",[t._v("vm.runInThisContext()")])]),t._v(", the code is executed within the current V8 global\ncontext. The code passed to this VM context will have its own isolated scope.")]),t._v(" "),n("p",[t._v("In order to run a simple web server using the "),n("code",[t._v("http")]),t._v(" module the code passed to\nthe context must either call "),n("code",[t._v("require('http')")]),t._v(" on its own, or have a reference\nto the "),n("code",[t._v("http")]),t._v(" module passed to it. For instance:")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'use strict'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" vm "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vm'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" code "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("\n((require) => {\n  const http = require('http');\n\n  http.createServer((request, response) => {\n    response.writeHead(200, { 'Content-Type': 'text/plain' });\n    response.end('Hello World\\\\n');\n  }).listen(8124);\n\n  console.log('Server running at http://127.0.0.1:8124/');\n})")]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nvm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("runInThisContext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("code"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("require"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("The "),n("code",[t._v("require()")]),t._v(" in the above case shares the state with the context it is\npassed from. This may introduce risks when untrusted code is executed, e.g.\naltering objects in the context in unwanted ways.")]),t._v(" "),n("h2",{attrs:{id:"what-does-it-mean-to-contextify-an-object"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#what-does-it-mean-to-contextify-an-object"}},[t._v("#")]),t._v(' What does it mean to "contextify" an object?')]),t._v(" "),n("p",[t._v('All JavaScript executed within Node.js runs within the scope of a "context".\nAccording to the '),n("a",{attrs:{href:"https://v8.dev/docs/embed#contexts",target:"_blank",rel:"noopener noreferrer"}},[t._v("V8 Embedder's Guide"),n("OutboundLink")],1),t._v(":")]),t._v(" "),n("blockquote",[n("p",[t._v("In V8, a context is an execution environment that allows separate, unrelated,\nJavaScript applications to run in a single instance of V8. You must explicitly\nspecify the context in which you want any JavaScript code to be run.")])]),t._v(" "),n("p",[t._v("When the method "),n("code",[t._v("vm.createContext()")]),t._v(" is called, the "),n("code",[t._v("sandbox")]),t._v(" object that is\npassed in (or a newly created object if "),n("code",[t._v("sandbox")]),t._v(" is "),n("code",[t._v("undefined")]),t._v(") is associated\ninternally with a new instance of a V8 Context. This V8 Context provides the\n"),n("code",[t._v("code")]),t._v(" run using the "),n("code",[t._v("vm")]),t._v(" module's methods with an isolated global environment\nwithin which it can operate. The process of creating the V8 Context and\nassociating it with the "),n("code",[t._v("sandbox")]),t._v(' object is what this document refers to as\n"contextifying" the '),n("code",[t._v("sandbox")]),t._v(".")]),t._v(" "),n("h2",{attrs:{id:"timeout-limitations-when-using-process-nexttick-promises-and-queuemicrotask"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#timeout-limitations-when-using-process-nexttick-promises-and-queuemicrotask"}},[t._v("#")]),t._v(" Timeout limitations when using process.nextTick(), Promises, and queueMicrotask()")]),t._v(" "),n("p",[t._v("Because of the internal mechanics of how the "),n("code",[t._v("process.nextTick()")]),t._v(' queue and\nthe microtask queue that underlies Promises are implemented within V8 and\nNode.js, it is possible for code running within a context to "escape" the\n'),n("code",[t._v("timeout")]),t._v(" set using "),n("code",[t._v("vm.runInContext()")]),t._v(", "),n("code",[t._v("vm.runInNewContext()")]),t._v(", and\n"),n("code",[t._v("vm.runInThisContext()")]),t._v(".")]),t._v(" "),n("p",[t._v("For example, the following code executed by "),n("code",[t._v("vm.runInNewContext()")]),t._v(" with a\ntimeout of 5 milliseconds schedules an infinite loop to run after a promise\nresolves. The scheduled loop is never interrupted by the timeout:")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" vm "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vm'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("loop")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Date"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nvm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("runInNewContext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Promise.resolve().then(loop);'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" loop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" console "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" timeout"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("This issue also occurs when the "),n("code",[t._v("loop()")]),t._v(" call is scheduled using\nthe "),n("code",[t._v("process.nextTick()")]),t._v(" and "),n("code",[t._v("queueMicrotask()")]),t._v(" functions.")]),t._v(" "),n("p",[t._v("This issue occurs because all contexts share the same microtask and nextTick\nqueues.")])])}),[],!1,null,null,null);e.default=a.exports}}]);