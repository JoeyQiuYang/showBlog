(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{240:function(e,t,a){"use strict";a.r(t);var n=a(3),s=Object(n.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"n-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#n-api"}},[e._v("#")]),e._v(" N-API")]),e._v(" "),a("blockquote",[a("p",[e._v("Stability: 2 - Stable")])]),e._v(" "),a("p",[e._v("N-API (pronounced N as in the letter, followed by API)\nis an API for building native Addons. It is independent from\nthe underlying JavaScript runtime (for example, V8) and is maintained as part of\nNode.js itself. This API will be Application Binary Interface (ABI) stable\nacross versions of Node.js. It is intended to insulate Addons from\nchanges in the underlying JavaScript engine and allow modules\ncompiled for one major version to run on later major versions of Node.js without\nrecompilation. The "),a("a",{attrs:{href:"https://nodejs.org/en/docs/guides/abi-stability/",target:"_blank",rel:"noopener noreferrer"}},[e._v("ABI Stability"),a("OutboundLink")],1),e._v(" guide provides a more in-depth explanation.")]),e._v(" "),a("p",[e._v("Addons are built/packaged with the same approach/tools outlined in the section\ntitled "),a("router-link",{attrs:{to:"/node/addons.html"}},[e._v("C++ Addons")]),e._v(". The only difference is the set of APIs that are used by\nthe native code. Instead of using the V8 or "),a("a",{attrs:{href:"https://github.com/nodejs/nan",target:"_blank",rel:"noopener noreferrer"}},[e._v("Native Abstractions for Node.js"),a("OutboundLink")],1),e._v("\nAPIs, the functions available in the N-API are used.")],1),e._v(" "),a("p",[e._v("APIs exposed by N-API are generally used to create and manipulate\nJavaScript values. Concepts and operations generally map to ideas specified\nin the ECMA-262 Language Specification. The APIs have the following\nproperties:")]),e._v(" "),a("ul",[a("li",[e._v("All N-API calls return a status code of type "),a("code",[e._v("napi_status")]),e._v(". This\nstatus indicates whether the API call succeeded or failed.")]),e._v(" "),a("li",[e._v("The API's return value is passed via an out parameter.")]),e._v(" "),a("li",[e._v("All JavaScript values are abstracted behind an opaque type named\n"),a("code",[e._v("napi_value")]),e._v(".")]),e._v(" "),a("li",[e._v("In case of an error status code, additional information can be obtained\nusing "),a("code",[e._v("napi_get_last_error_info")]),e._v(". More information can be found in the error\nhandling section "),a("a",{attrs:{href:"#n_api_error_handling"}},[e._v("Error Handling")]),e._v(".")])]),e._v(" "),a("p",[e._v("The N-API is a C API that ensures ABI stability across Node.js versions\nand different compiler levels. A C++ API can be easier to use.\nTo support using C++, the project maintains a\nC++ wrapper module called "),a("a",{attrs:{href:"https://github.com/nodejs/node-addon-api",target:"_blank",rel:"noopener noreferrer"}},[e._v("node-addon-api"),a("OutboundLink")],1),e._v(".\nThis wrapper provides an inlineable C++ API. Binaries built\nwith "),a("code",[e._v("node-addon-api")]),e._v(" will depend on the symbols for the N-API C-based\nfunctions exported by Node.js. "),a("code",[e._v("node-addon-api")]),e._v(" is a more\nefficient way to write code that calls N-API. Take, for example, the\nfollowing "),a("code",[e._v("node-addon-api")]),e._v(" code. The first section shows the\n"),a("code",[e._v("node-addon-api")]),e._v(" code and the second section shows what actually gets\nused in the addon.")]),e._v(" "),a("div",{staticClass:"language-C++ extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('Object obj = Object::New(env);\nobj["foo"] = String::New(env, "bar");\n')])])]),a("div",{staticClass:"language-C++ extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('napi_status status;\nnapi_value object, string;\nstatus = napi_create_object(env, &object);\nif (status != napi_ok) {\n  napi_throw_error(env, ...);\n  return;\n}\n\nstatus = napi_create_string_utf8(env, "bar", NAPI_AUTO_LENGTH, &string);\nif (status != napi_ok) {\n  napi_throw_error(env, ...);\n  return;\n}\n\nstatus = napi_set_named_property(env, object, "foo", string);\nif (status != napi_ok) {\n  napi_throw_error(env, ...);\n  return;\n}\n')])])]),a("p",[e._v("The end result is that the addon only uses the exported C APIs. As a result,\nit still gets the benefits of the ABI stability provided by the C API.")]),e._v(" "),a("p",[e._v("When using "),a("code",[e._v("node-addon-api")]),e._v(" instead of the C APIs, start with the API "),a("a",{attrs:{href:"https://github.com/nodejs/node-addon-api#api-documentation",target:"_blank",rel:"noopener noreferrer"}},[e._v("docs"),a("OutboundLink")],1),e._v("\nfor "),a("code",[e._v("node-addon-api")]),e._v(".")]),e._v(" "),a("h2",{attrs:{id:"implications-of-abi-stability"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#implications-of-abi-stability"}},[e._v("#")]),e._v(" Implications of ABI Stability")]),e._v(" "),a("p",[e._v("Although N-API provides an ABI stability guarantee, other parts of Node.js do\nnot, and any external libraries used from the addon may not. In particular,\nnone of the following APIs provide an ABI stability guarantee across major\nversions:")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("the Node.js C++ APIs available via any of")]),e._v(" "),a("div",{staticClass:"language-C++ extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("#include <node.h>\n#include <node_buffer.h>\n#include <node_version.h>\n#include <node_object_wrap.h>\n")])])])]),e._v(" "),a("li",[a("p",[e._v("the libuv APIs which are also included with Node.js and available via")]),e._v(" "),a("div",{staticClass:"language-C++ extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("#include <uv.h>\n")])])])]),e._v(" "),a("li",[a("p",[e._v("the V8 API available via")]),e._v(" "),a("div",{staticClass:"language-C++ extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("#include <v8.h>\n")])])])])]),e._v(" "),a("p",[e._v("Thus, for an addon to remain ABI-compatible across Node.js major versions, it\nmust make use exclusively of N-API by restricting itself to using")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token macro property"}},[e._v("#"),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[e._v("include")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("<node_api.h>")])]),e._v("\n")])])]),a("p",[e._v("and by checking, for all external libraries that it uses, that the external\nlibrary makes ABI stability guarantees similar to N-API.")]),e._v(" "),a("h2",{attrs:{id:"building"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#building"}},[e._v("#")]),e._v(" Building")]),e._v(" "),a("p",[e._v("Unlike modules written in JavaScript, developing and deploying Node.js\nnative addons using N-API requires an additional set of tools. Besides the\nbasic tools required to develop for Node.js, the native addon developer\nrequires a toolchain that can compile C and C++ code into a binary. In\naddition, depending upon how the native addon is deployed, the "),a("em",[e._v("user")]),e._v(" of\nthe native addon will also need to have a C/C++ toolchain installed.")]),e._v(" "),a("p",[e._v("For Linux developers, the necessary C/C++ toolchain packages are readily\navailable. "),a("a",{attrs:{href:"https://gcc.gnu.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("GCC"),a("OutboundLink")],1),e._v(" is widely used in the Node.js community to build and\ntest across a variety of plarforms. For many developers, the "),a("a",{attrs:{href:"https://llvm.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("LLVM"),a("OutboundLink")],1),e._v("\ncompiler infrastructure is also a good choice.")]),e._v(" "),a("p",[e._v("For Mac developers, "),a("a",{attrs:{href:"https://developer.apple.com/xcode/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Xcode"),a("OutboundLink")],1),e._v(" offers all the required compiler tools.\nHowever, it is not necessary to install the entire Xcode IDE. The following\ncommand installs the necessary toolchain:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("xcode-select --install\n")])])]),a("p",[e._v("For Windows developers, "),a("a",{attrs:{href:"https://visualstudio.microsoft.com",target:"_blank",rel:"noopener noreferrer"}},[e._v("Visual Studio"),a("OutboundLink")],1),e._v(" offers all the required compiler\ntools. However, it is not necessary to install the entire Visual Studio\nIDE. The following command installs the necessary toolchain:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("npm")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" --global --production windows-build-tools\n")])])]),a("p",[e._v("The sections below describe the additional tools available for developing\nand deploying Node.js native addons.")]),e._v(" "),a("h3",{attrs:{id:"build-tools"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#build-tools"}},[e._v("#")]),e._v(" Build tools")]),e._v(" "),a("p",[e._v("Both the tools listed here require that "),a("em",[e._v("users")]),e._v(" of the native\naddon have a C/C++ toolchain installed in order to successfully install\nthe native addon.")]),e._v(" "),a("h4",{attrs:{id:"node-gyp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node-gyp"}},[e._v("#")]),e._v(" node-gyp")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/nodejs/node-gyp",target:"_blank",rel:"noopener noreferrer"}},[e._v("node-gyp"),a("OutboundLink")],1),e._v(" is a build system based on Google's "),a("a",{attrs:{href:"https://gyp.gsrc.io",target:"_blank",rel:"noopener noreferrer"}},[e._v("GYP"),a("OutboundLink")],1),e._v(" tool and comes\nbundled with npm. GYP, and therefore node-gyp, requires that Python be\ninstalled.")]),e._v(" "),a("p",[e._v("Historically, node-gyp has been the tool of choice for building native\naddons. It has widespread adoption and documentation. However, some\ndevelopers have run into limitations in node-gyp.")]),e._v(" "),a("h4",{attrs:{id:"cmake-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cmake-js"}},[e._v("#")]),e._v(" CMake.js")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/cmake-js/cmake-js",target:"_blank",rel:"noopener noreferrer"}},[e._v("CMake.js"),a("OutboundLink")],1),e._v(" is an alternative build system based on "),a("a",{attrs:{href:"https://cmake.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("CMake"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("p",[e._v("CMake.js is a good choice for projects that already use CMake or for\ndevelopers affected by limitations in node-gyp.")]),e._v(" "),a("h3",{attrs:{id:"uploading-precompiled-binaries"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#uploading-precompiled-binaries"}},[e._v("#")]),e._v(" Uploading precompiled binaries")]),e._v(" "),a("p",[e._v("The three tools listed here permit native addon developers and maintainers\nto create and upload binaries to public or private servers. These tools are\ntypically integrated with CI/CD build systems like "),a("a",{attrs:{href:"https://travis-ci.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("Travis CI"),a("OutboundLink")],1),e._v(" and\n"),a("a",{attrs:{href:"https://www.appveyor.com",target:"_blank",rel:"noopener noreferrer"}},[e._v("AppVeyor"),a("OutboundLink")],1),e._v(" to build and upload binaries for a variety of platforms and\narchitectures. These binaries are then available for download by users who\ndo not need to have a C/C++ toolchain installed.")]),e._v(" "),a("h4",{attrs:{id:"node-pre-gyp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node-pre-gyp"}},[e._v("#")]),e._v(" node-pre-gyp")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/mapbox/node-pre-gyp",target:"_blank",rel:"noopener noreferrer"}},[e._v("node-pre-gyp"),a("OutboundLink")],1),e._v(" is a tool based on node-gyp that adds the ability to\nupload binaries to a server of the developer's choice. node-pre-gyp has\nparticularly good support for uploading binaries to Amazon S3.")]),e._v(" "),a("h4",{attrs:{id:"prebuild"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prebuild"}},[e._v("#")]),e._v(" prebuild")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/prebuild/prebuild",target:"_blank",rel:"noopener noreferrer"}},[e._v("prebuild"),a("OutboundLink")],1),e._v(" is a tool that supports builds using either node-gyp or\nCMake.js. Unlike node-pre-gyp which supports a variety of servers, prebuild\nuploads binaries only to "),a("a",{attrs:{href:"https://help.github.com/en/github/administering-a-repository/about-releases",target:"_blank",rel:"noopener noreferrer"}},[e._v("GitHub releases"),a("OutboundLink")],1),e._v(". prebuild is a good choice for\nGitHub projects using CMake.js.")]),e._v(" "),a("h4",{attrs:{id:"prebuildify"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prebuildify"}},[e._v("#")]),e._v(" prebuildify")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/prebuild/prebuildify",target:"_blank",rel:"noopener noreferrer"}},[e._v("prebuildify"),a("OutboundLink")],1),e._v(" is tool based on node-gyp. The advantage of prebuildify is\nthat the built binaries are bundled with the native module when it's\nuploaded to npm. The binaries are downloaded from npm and are immediately\navailable to the module user when the native module is installed.")]),e._v(" "),a("h2",{attrs:{id:"usage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#usage"}},[e._v("#")]),e._v(" Usage")]),e._v(" "),a("p",[e._v("In order to use the N-API functions, include the file "),a("a",{attrs:{href:"https://github.com/nodejs/node/blob/master/src/node_api.h",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("node_api.h")]),a("OutboundLink")],1),e._v(" which is\nlocated in the src directory in the node development tree:")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token macro property"}},[e._v("#"),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[e._v("include")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("<node_api.h>")])]),e._v("\n")])])]),a("p",[e._v("This will opt into the default "),a("code",[e._v("NAPI_VERSION")]),e._v(" for the given release of Node.js.\nIn order to ensure compatibility with specific versions of N-API, the version\ncan be specified explicitly when including the header:")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token macro property"}},[e._v("#"),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[e._v("define")]),e._v(" NAPI_VERSION 3")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[e._v("#"),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[e._v("include")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("<node_api.h>")])]),e._v("\n")])])]),a("p",[e._v("This restricts the N-API surface to just the functionality that was available in\nthe specified (and earlier) versions.")]),e._v(" "),a("p",[e._v("Some of the N-API surface is considered experimental and requires explicit\nopt-in to access those APIs:")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token macro property"}},[e._v("#"),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[e._v("define")]),e._v(" NAPI_EXPERIMENTAL")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[e._v("#"),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[e._v("include")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("<node_api.h>")])]),e._v("\n")])])]),a("p",[e._v("In this case the entire API surface, including any experimental APIs, will be\navailable to the module code.")]),e._v(" "),a("h2",{attrs:{id:"n-api-version-matrix"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#n-api-version-matrix"}},[e._v("#")]),e._v(" N-API Version Matrix")]),e._v(" "),a("p",[e._v("N-API versions are additive and versioned independently from Node.js.\nVersion 4 is an extension to version 3 in that it has all of the APIs\nfrom version 3 with some additions. This means that it is not necessary\nto recompile for new versions of Node.js which are\nlisted as supporting a later version.")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th"),e._v(" "),a("th",[e._v("1")]),e._v(" "),a("th",[e._v("2")]),e._v(" "),a("th",[e._v("3")]),e._v(" "),a("th",[e._v("4")]),e._v(" "),a("th",[e._v("5")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("v6.x")]),e._v(" "),a("td"),e._v(" "),a("td"),e._v(" "),a("td",[e._v("v6.14.2*")]),e._v(" "),a("td"),e._v(" "),a("td")]),e._v(" "),a("tr",[a("td",[e._v("v8.x")]),e._v(" "),a("td",[e._v("v8.0.0*")]),e._v(" "),a("td",[e._v("v8.10.0*")]),e._v(" "),a("td",[e._v("v8.11.2")]),e._v(" "),a("td",[e._v("v8.16.0")]),e._v(" "),a("td")]),e._v(" "),a("tr",[a("td",[e._v("v9.x")]),e._v(" "),a("td",[e._v("v9.0.0*")]),e._v(" "),a("td",[e._v("v9.3.0*")]),e._v(" "),a("td",[e._v("v9.11.0*")]),e._v(" "),a("td"),e._v(" "),a("td")]),e._v(" "),a("tr",[a("td",[e._v("v10.x")]),e._v(" "),a("td"),e._v(" "),a("td"),e._v(" "),a("td",[e._v("v10.0.0")]),e._v(" "),a("td",[e._v("v10.16.0")]),e._v(" "),a("td",[e._v("v10.17.0")])]),e._v(" "),a("tr",[a("td",[e._v("v11.x")]),e._v(" "),a("td"),e._v(" "),a("td"),e._v(" "),a("td",[e._v("v11.0.0")]),e._v(" "),a("td",[e._v("v11.8.0")]),e._v(" "),a("td")]),e._v(" "),a("tr",[a("td",[e._v("v12.x")]),e._v(" "),a("td"),e._v(" "),a("td"),e._v(" "),a("td"),e._v(" "),a("td",[e._v("v12.0.0")]),e._v(" "),a("td",[e._v("v12.11.0")])]),e._v(" "),a("tr",[a("td",[e._v("v13.x")]),e._v(" "),a("td"),e._v(" "),a("td"),e._v(" "),a("td"),e._v(" "),a("td"),e._v(" "),a("td",[e._v("v13.0.0")])])])]),e._v(" "),a("p",[e._v("* Indicates that the N-API version was released as experimental")]),e._v(" "),a("p",[e._v("The N-APIs associated strictly with accessing ECMAScript features from native\ncode can be found separately in "),a("code",[e._v("js_native_api.h")]),e._v(" and "),a("code",[e._v("js_native_api_types.h")]),e._v(".\nThe APIs defined in these headers are included in "),a("code",[e._v("node_api.h")]),e._v(" and\n"),a("code",[e._v("node_api_types.h")]),e._v(". The headers are structured in this way in order to allow\nimplementations of N-API outside of Node.js. For those implementations the\nNode.js specific APIs may not be applicable.")]),e._v(" "),a("p",[e._v("The Node.js-specific parts of an addon can be separated from the code that\nexposes the actual functionality to the JavaScript environment so that the\nlatter may be used with multiple implementations of N-API. In the example below,\n"),a("code",[e._v("addon.c")]),e._v(" and "),a("code",[e._v("addon.h")]),e._v(" refer only to "),a("code",[e._v("js_native_api.h")]),e._v(". This ensures that\n"),a("code",[e._v("addon.c")]),e._v(" can be reused to compile against either the Node.js implementation of\nN-API or any implementation of N-API outside of Node.js.")]),e._v(" "),a("p",[a("code",[e._v("addon_node.c")]),e._v(" is a separate file that contains the Node.js specific entry point\nto the addon and which instantiates the addon by calling into "),a("code",[e._v("addon.c")]),e._v(" when the\naddon is loaded into a Node.js environment.")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// addon.h")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[e._v("#"),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[e._v("ifndef")]),e._v(" _ADDON_H_")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[e._v("#"),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[e._v("define")]),e._v(" _ADDON_H_")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[e._v("#"),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[e._v("include")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("<js_native_api.h>")])]),e._v("\nnapi_value "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("create_addon")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[e._v("#"),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[e._v("endif")]),e._v("  ")]),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// _ADDON_H_")]),e._v("\n")])])]),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// addon.c")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[e._v("#"),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[e._v("include")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"addon.h"')])]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[e._v("#"),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[e._v("define")]),e._v(' NAPI_CALL(env, call)                                      \\\n  do {                                                            \\\n    napi_status status = (call);                                  \\\n    if (status != napi_ok) {                                      \\\n      const napi_extended_error_info* error_info = NULL;          \\\n      napi_get_last_error_info((env), &error_info);               \\\n      bool is_pending;                                            \\\n      napi_is_exception_pending((env), &is_pending);              \\\n      if (!is_pending) {                                          \\\n        const char* message = (error_info->error_message == NULL) \\\n            ? "empty error message"                               \\\n            : error_info->error_message;                          \\\n        napi_throw_error((env), NULL, message);                   \\\n        return NULL;                                              \\\n      }                                                           \\\n    }                                                             \\\n  } while(0)')]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("static")]),e._v(" napi_value\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("DoSomethingUseful")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_callback_info info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Do something useful.")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\nnapi_value "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("create_addon")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  napi_value result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("NAPI_CALL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n  napi_value exported_function"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("NAPI_CALL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                      "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"doSomethingUseful"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                      NAPI_AUTO_LENGTH"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                      DoSomethingUseful"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                      "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                      "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("exported_function"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("NAPI_CALL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_set_named_property")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                         result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                         "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"doSomethingUseful"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                         exported_function"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// addon_node.c")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[e._v("#"),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[e._v("include")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("<node_api.h>")])]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[e._v("#"),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[e._v("include")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"addon.h"')])]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("NAPI_MODULE_INIT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// This function body is expected to return a `napi_value`.")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// The variables `napi_env env` and `napi_value exports` may be used within")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// the body, as they are provided by the definition of `NAPI_MODULE_INIT()`.")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("create_addon")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),a("h2",{attrs:{id:"environment-life-cycle-apis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#environment-life-cycle-apis"}},[e._v("#")]),e._v(" Environment Life Cycle APIs")]),e._v(" "),a("blockquote",[a("p",[e._v("Stability: 1 - Experimental")])]),e._v(" "),a("p",[a("a",{attrs:{href:"https://tc39.es/ecma262/#sec-agents",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 8.7"),a("OutboundLink")],1),e._v(" of the "),a("a",{attrs:{href:"https://tc39.github.io/ecma262/",target:"_blank",rel:"noopener noreferrer"}},[e._v("ECMAScript Language Specification"),a("OutboundLink")],1),e._v(' defines the concept\nof an "Agent" as a self-contained environment in which JavaScript code runs.\nMultiple such Agents may be started and terminated either concurrently or in\nsequence by the process.')]),e._v(" "),a("p",[e._v("A Node.js environment corresponds to an ECMAScript Agent. In the main process,\nan environment is created at startup, and additional environments can be created\non separate threads to serve as "),a("a",{attrs:{href:"https://nodejs.org/api/worker_threads.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("worker threads"),a("OutboundLink")],1),e._v(". When Node.js is embedded in\nanother application, the main thread of the application may also construct and\ndestroy a Node.js environment multiple times during the life cycle of the\napplication process such that each Node.js environment created by the\napplication may, in turn, during its life cycle create and destroy additional\nenvironments as worker threads.")]),e._v(" "),a("p",[e._v("From the perspective of a native addon this means that the bindings it provides\nmay be called multiple times, from multiple contexts, and even concurrently from\nmultiple threads.")]),e._v(" "),a("p",[e._v("Native addons may need to allocate global state of which they make use during\ntheir entire life cycle such that the state must be unique to each instance of\nthe addon.")]),e._v(" "),a("p",[e._v("To this env, N-API provides a way to allocate data such that its life cycle is\ntied to the life cycle of the Agent.")]),e._v(" "),a("h3",{attrs:{id:"napi-set-instance-data"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-set-instance-data"}},[e._v("#")]),e._v(" napi_set_instance_data")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_set_instance_data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                   napi_finalize finalize_cb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" finalize_hint"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the N-API call is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] data")]),e._v(": The data item to make available to bindings of this instance.")]),e._v(" "),a("li",[a("code",[e._v("[in] finalize_cb")]),e._v(": The function to call when the environment is being torn\ndown. The function receives "),a("code",[e._v("data")]),e._v(" so that it might free it.")]),e._v(" "),a("li",[a("code",[e._v("[in] finalize_hint")]),e._v(": Optional hint to pass to the finalize callback\nduring collection.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API associates "),a("code",[e._v("data")]),e._v(" with the currently running Agent. "),a("code",[e._v("data")]),e._v(" can later\nbe retrieved using "),a("code",[e._v("napi_get_instance_data()")]),e._v(". Any existing data associated with\nthe currently running Agent which was set by means of a previous call to\n"),a("code",[e._v("napi_set_instance_data()")]),e._v(" will be overwritten. If a "),a("code",[e._v("finalize_cb")]),e._v(" was provided\nby the previous call, it will not be called.")]),e._v(" "),a("h3",{attrs:{id:"napi-get-instance-data"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-instance-data"}},[e._v("#")]),e._v(" napi_get_instance_data")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_instance_data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the N-API call is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[out] data")]),e._v(": The data item that was previously associated with the currently\nrunning Agent by a call to "),a("code",[e._v("napi_set_instance_data()")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API retrieves data that was previously associated with the currently\nrunning Agent via "),a("code",[e._v("napi_set_instance_data()")]),e._v(". If no data is set, the call will\nsucceed and "),a("code",[e._v("data")]),e._v(" will be set to "),a("code",[e._v("NULL")]),e._v(".")]),e._v(" "),a("h2",{attrs:{id:"basic-n-api-data-types"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#basic-n-api-data-types"}},[e._v("#")]),e._v(" Basic N-API Data Types")]),e._v(" "),a("p",[e._v("N-API exposes the following fundamental datatypes as abstractions that are\nconsumed by the various APIs. These APIs should be treated as opaque,\nintrospectable only with other N-API calls.")]),e._v(" "),a("h3",{attrs:{id:"napi-status"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-status"}},[e._v("#")]),e._v(" napi_status")]),e._v(" "),a("p",[e._v("Integral status code indicating the success or failure of a N-API call.\nCurrently, the following status codes are supported.")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("typedef")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("enum")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_invalid_arg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_object_expected"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_string_expected"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_name_expected"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_function_expected"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_number_expected"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_boolean_expected"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_array_expected"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_generic_failure"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_pending_exception"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_cancelled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_escape_called_twice"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_handle_scope_mismatch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_callback_scope_mismatch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_queue_full"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_closing"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_bigint_expected"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_date_expected"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_arraybuffer_expected"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_detachable_arraybuffer_expected"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" napi_status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("If additional information is required upon an API returning a failed status,\nit can be obtained by calling "),a("code",[e._v("napi_get_last_error_info")]),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"napi-extended-error-info"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-extended-error-info"}},[e._v("#")]),e._v(" napi_extended_error_info")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("typedef")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("struct")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("char")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" error_message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" engine_reserved"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  uint32_t engine_error_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  napi_status error_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" napi_extended_error_info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("error_message")]),e._v(": UTF8-encoded string containing a VM-neutral description of\nthe error.")]),e._v(" "),a("li",[a("code",[e._v("engine_reserved")]),e._v(": Reserved for VM-specific error details. This is currently\nnot implemented for any VM.")]),e._v(" "),a("li",[a("code",[e._v("engine_error_code")]),e._v(": VM-specific error code. This is currently\nnot implemented for any VM.")]),e._v(" "),a("li",[a("code",[e._v("error_code")]),e._v(": The N-API status code that originated with the last error.")])]),e._v(" "),a("p",[e._v("See the "),a("a",{attrs:{href:"#n_api_error_handling"}},[e._v("Error Handling")]),e._v(" section for additional information.")]),e._v(" "),a("h3",{attrs:{id:"napi-env"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-env"}},[e._v("#")]),e._v(" napi_env")]),e._v(" "),a("p",[a("code",[e._v("napi_env")]),e._v(" is used to represent a context that the underlying N-API\nimplementation can use to persist VM-specific state. This structure is passed\nto native functions when they're invoked, and it must be passed back when\nmaking N-API calls. Specifically, the same "),a("code",[e._v("napi_env")]),e._v(" that was passed in when\nthe initial native function was called must be passed to any subsequent\nnested N-API calls. Caching the "),a("code",[e._v("napi_env")]),e._v(" for the purpose of general reuse is\nnot allowed.")]),e._v(" "),a("h3",{attrs:{id:"napi-value"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-value"}},[e._v("#")]),e._v(" napi_value")]),e._v(" "),a("p",[e._v("This is an opaque pointer that is used to represent a JavaScript value.")]),e._v(" "),a("h3",{attrs:{id:"napi-threadsafe-function"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-threadsafe-function"}},[e._v("#")]),e._v(" napi_threadsafe_function")]),e._v(" "),a("p",[e._v("This is an opaque pointer that represents a JavaScript function which can be\ncalled asynchronously from multiple threads via\n"),a("code",[e._v("napi_call_threadsafe_function()")]),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"napi-threadsafe-function-release-mode"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-threadsafe-function-release-mode"}},[e._v("#")]),e._v(" napi_threadsafe_function_release_mode")]),e._v(" "),a("p",[e._v("A value to be given to "),a("code",[e._v("napi_release_threadsafe_function()")]),e._v(" to indicate whether\nthe thread-safe function is to be closed immediately ("),a("code",[e._v("napi_tsfn_abort")]),e._v(") or\nmerely released ("),a("code",[e._v("napi_tsfn_release")]),e._v(") and thus available for subsequent use via\n"),a("code",[e._v("napi_acquire_threadsafe_function()")]),e._v(" and "),a("code",[e._v("napi_call_threadsafe_function()")]),e._v(".")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("typedef")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("enum")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  napi_tsfn_release"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_tsfn_abort\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" napi_threadsafe_function_release_mode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("h3",{attrs:{id:"napi-threadsafe-function-call-mode"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-threadsafe-function-call-mode"}},[e._v("#")]),e._v(" napi_threadsafe_function_call_mode")]),e._v(" "),a("p",[e._v("A value to be given to "),a("code",[e._v("napi_call_threadsafe_function()")]),e._v(" to indicate whether\nthe call should block whenever the queue associated with the thread-safe\nfunction is full.")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("typedef")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("enum")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  napi_tsfn_nonblocking"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_tsfn_blocking\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" napi_threadsafe_function_call_mode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("h3",{attrs:{id:"n-api-memory-management-types"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#n-api-memory-management-types"}},[e._v("#")]),e._v(" N-API Memory Management types")]),e._v(" "),a("h4",{attrs:{id:"napi-handle-scope"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-handle-scope"}},[e._v("#")]),e._v(" napi_handle_scope")]),e._v(" "),a("p",[e._v("This is an abstraction used to control and modify the lifetime of objects\ncreated within a particular scope. In general, N-API values are created within\nthe context of a handle scope. When a native method is called from\nJavaScript, a default handle scope will exist. If the user does not explicitly\ncreate a new handle scope, N-API values will be created in the default handle\nscope. For any invocations of code outside the execution of a native method\n(for instance, during a libuv callback invocation), the module is required to\ncreate a scope before invoking any functions that can result in the creation\nof JavaScript values.")]),e._v(" "),a("p",[e._v("Handle scopes are created using "),a("a",{attrs:{href:"#n_api_napi_open_handle_scope"}},[a("code",[e._v("napi_open_handle_scope")])]),e._v(" and are destroyed\nusing "),a("a",{attrs:{href:"#n_api_napi_close_handle_scope"}},[a("code",[e._v("napi_close_handle_scope")])]),e._v(". Closing the scope can indicate to the GC\nthat all "),a("code",[e._v("napi_value")]),e._v("s created during the lifetime of the handle scope are no\nlonger referenced from the current stack frame.")]),e._v(" "),a("p",[e._v("For more details, review the "),a("a",{attrs:{href:"#n_api_object_lifetime_management"}},[e._v("Object Lifetime Management")]),e._v(".")]),e._v(" "),a("h4",{attrs:{id:"napi-escapable-handle-scope"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-escapable-handle-scope"}},[e._v("#")]),e._v(" napi_escapable_handle_scope")]),e._v(" "),a("p",[e._v("Escapable handle scopes are a special type of handle scope to return values\ncreated within a particular handle scope to a parent scope.")]),e._v(" "),a("h4",{attrs:{id:"napi-ref"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-ref"}},[e._v("#")]),e._v(" napi_ref")]),e._v(" "),a("p",[e._v("This is the abstraction to use to reference a "),a("code",[e._v("napi_value")]),e._v(". This allows for\nusers to manage the lifetimes of JavaScript values, including defining their\nminimum lifetimes explicitly.")]),e._v(" "),a("p",[e._v("For more details, review the "),a("a",{attrs:{href:"#n_api_object_lifetime_management"}},[e._v("Object Lifetime Management")]),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"n-api-callback-types"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#n-api-callback-types"}},[e._v("#")]),e._v(" N-API Callback types")]),e._v(" "),a("h4",{attrs:{id:"napi-callback-info"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-callback-info"}},[e._v("#")]),e._v(" napi_callback_info")]),e._v(" "),a("p",[e._v("Opaque datatype that is passed to a callback function. It can be used for\ngetting additional information about the context in which the callback was\ninvoked.")]),e._v(" "),a("h4",{attrs:{id:"napi-callback"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-callback"}},[e._v("#")]),e._v(" napi_callback")]),e._v(" "),a("p",[e._v("Function pointer type for user-provided native functions which are to be\nexposed to JavaScript via N-API. Callback functions should satisfy the\nfollowing signature:")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("typedef")]),e._v(" napi_value "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v("napi_callback"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_callback_info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("h4",{attrs:{id:"napi-finalize"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-finalize"}},[e._v("#")]),e._v(" napi_finalize")]),e._v(" "),a("p",[e._v("Function pointer type for add-on provided functions that allow the user to be\nnotified when externally-owned data is ready to be cleaned up because the\nobject with which it was associated with, has been garbage-collected. The user\nmust provide a function satisfying the following signature which would get\ncalled upon the object's collection. Currently, "),a("code",[e._v("napi_finalize")]),e._v(" can be used for\nfinding out when objects that have external data are collected.")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("typedef")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v("napi_finalize"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" finalize_data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" finalize_hint"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("h4",{attrs:{id:"napi-async-execute-callback"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-async-execute-callback"}},[e._v("#")]),e._v(" napi_async_execute_callback")]),e._v(" "),a("p",[e._v("Function pointer used with functions that support asynchronous\noperations. Callback functions must satisfy the following signature:")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("typedef")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v("napi_async_execute_callback"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("Implementations of this function must avoid making N-API calls\nthat execute JavaScript or interact with\nJavaScript objects.  N-API\ncalls should be in the "),a("code",[e._v("napi_async_complete_callback")]),e._v(" instead.\nDo not use the "),a("code",[e._v("napi_env")]),e._v(" parameter as it will likely\nresult in execution of JavaScript.")]),e._v(" "),a("h4",{attrs:{id:"napi-async-complete-callback"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-async-complete-callback"}},[e._v("#")]),e._v(" napi_async_complete_callback")]),e._v(" "),a("p",[e._v("Function pointer used with functions that support asynchronous\noperations. Callback functions must satisfy the following signature:")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("typedef")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v("napi_async_complete_callback"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                             napi_status status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                             "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("h4",{attrs:{id:"napi-threadsafe-function-call-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-threadsafe-function-call-js"}},[e._v("#")]),e._v(" napi_threadsafe_function_call_js")]),e._v(" "),a("p",[e._v("Function pointer used with asynchronous thread-safe function calls. The callback\nwill be called on the main thread. Its purpose is to use a data item arriving\nvia the queue from one of the secondary threads to construct the parameters\nnecessary for a call into JavaScript, usually via "),a("code",[e._v("napi_call_function")]),e._v(", and then\nmake the call into JavaScript.")]),e._v(" "),a("p",[e._v("The data arriving from the secondary thread via the queue is given in the "),a("code",[e._v("data")]),e._v("\nparameter and the JavaScript function to call is given in the "),a("code",[e._v("js_callback")]),e._v("\nparameter.")]),e._v(" "),a("p",[e._v("N-API sets up the environment prior to calling this callback, so it is\nsufficient to call the JavaScript function via "),a("code",[e._v("napi_call_function")]),e._v(" rather than\nvia "),a("code",[e._v("napi_make_callback")]),e._v(".")]),e._v(" "),a("p",[e._v("Callback functions must satisfy the following signature:")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("typedef")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v("napi_threadsafe_function_call_js"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                                 napi_value js_callback"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                                 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                                 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment to use for API calls, or "),a("code",[e._v("NULL")]),e._v(" if the thread-safe\nfunction is being torn down and "),a("code",[e._v("data")]),e._v(" may need to be freed.")]),e._v(" "),a("li",[a("code",[e._v("[in] js_callback")]),e._v(": The JavaScript function to call, or "),a("code",[e._v("NULL")]),e._v(" if the\nthread-safe function is being torn down and "),a("code",[e._v("data")]),e._v(" may need to be freed. It may\nalso be "),a("code",[e._v("NULL")]),e._v(" if the thread-safe function was created without "),a("code",[e._v("js_callback")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[in] context")]),e._v(": The optional data with which the thread-safe function was\ncreated.")]),e._v(" "),a("li",[a("code",[e._v("[in] data")]),e._v(": Data created by the secondary thread. It is the responsibility of\nthe callback to convert this native data to JavaScript values (with N-API\nfunctions) that can be passed as parameters when "),a("code",[e._v("js_callback")]),e._v(" is invoked. This\npointer is managed entirely by the threads and this callback. Thus this callback\nshould free the data.")])]),e._v(" "),a("h2",{attrs:{id:"error-handling"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#error-handling"}},[e._v("#")]),e._v(" Error Handling")]),e._v(" "),a("p",[e._v("N-API uses both return values and JavaScript exceptions for error handling.\nThe following sections explain the approach for each case.")]),e._v(" "),a("h3",{attrs:{id:"return-values"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#return-values"}},[e._v("#")]),e._v(" Return values")]),e._v(" "),a("p",[e._v("All of the N-API functions share the same error handling pattern. The\nreturn type of all API functions is "),a("code",[e._v("napi_status")]),e._v(".")]),e._v(" "),a("p",[e._v("The return value will be "),a("code",[e._v("napi_ok")]),e._v(" if the request was successful and\nno uncaught JavaScript exception was thrown. If an error occurred AND\nan exception was thrown, the "),a("code",[e._v("napi_status")]),e._v(" value for the error\nwill be returned. If an exception was thrown, and no error occurred,\n"),a("code",[e._v("napi_pending_exception")]),e._v(" will be returned.")]),e._v(" "),a("p",[e._v("In cases where a return value other than "),a("code",[e._v("napi_ok")]),e._v(" or\n"),a("code",[e._v("napi_pending_exception")]),e._v(" is returned, "),a("a",{attrs:{href:"#n_api_napi_is_exception_pending"}},[a("code",[e._v("napi_is_exception_pending")])]),e._v("\nmust be called to check if an exception is pending.\nSee the section on exceptions for more details.")]),e._v(" "),a("p",[e._v("The full set of possible "),a("code",[e._v("napi_status")]),e._v(" values is defined\nin "),a("code",[e._v("napi_api_types.h")]),e._v(".")]),e._v(" "),a("p",[e._v("The "),a("code",[e._v("napi_status")]),e._v(" return value provides a VM-independent representation of\nthe error which occurred. In some cases it is useful to be able to get\nmore detailed information, including a string representing the error as well as\nVM (engine)-specific information.")]),e._v(" "),a("p",[e._v("In order to retrieve this information "),a("a",{attrs:{href:"#n_api_napi_get_last_error_info"}},[a("code",[e._v("napi_get_last_error_info")])]),e._v("\nis provided which returns a "),a("code",[e._v("napi_extended_error_info")]),e._v(" structure.\nThe format of the "),a("code",[e._v("napi_extended_error_info")]),e._v(" structure is as follows:")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("typedef")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("struct")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("napi_extended_error_info")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("char")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" error_message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" engine_reserved"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  uint32_t engine_error_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  napi_status error_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("error_message")]),e._v(": Textual representation of the error that occurred.")]),e._v(" "),a("li",[a("code",[e._v("engine_reserved")]),e._v(": Opaque handle reserved for engine use only.")]),e._v(" "),a("li",[a("code",[e._v("engine_error_code")]),e._v(": VM specific error code.")]),e._v(" "),a("li",[a("code",[e._v("error_code")]),e._v(": n-api status code for the last error.")])]),e._v(" "),a("p",[a("a",{attrs:{href:"#n_api_napi_get_last_error_info"}},[a("code",[e._v("napi_get_last_error_info")])]),e._v(" returns the information for the last\nN-API call that was made.")]),e._v(" "),a("p",[e._v("Do not rely on the content or format of any of the extended information as it\nis not subject to SemVer and may change at any time. It is intended only for\nlogging purposes.")]),e._v(" "),a("h4",{attrs:{id:"napi-get-last-error-info"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-last-error-info"}},[e._v("#")]),e._v(" napi_get_last_error_info")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_last_error_info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                         "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" napi_extended_error_info"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": The "),a("code",[e._v("napi_extended_error_info")]),e._v(" structure with more\ninformation about the error.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API retrieves a "),a("code",[e._v("napi_extended_error_info")]),e._v(" structure with information\nabout the last error that occurred.")]),e._v(" "),a("p",[e._v("The content of the "),a("code",[e._v("napi_extended_error_info")]),e._v(" returned is only valid up until\nan n-api function is called on the same "),a("code",[e._v("env")]),e._v(".")]),e._v(" "),a("p",[e._v("Do not rely on the content or format of any of the extended information as it\nis not subject to SemVer and may change at any time. It is intended only for\nlogging purposes.")]),e._v(" "),a("p",[e._v("This API can be called even if there is a pending JavaScript exception.")]),e._v(" "),a("h3",{attrs:{id:"exceptions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#exceptions"}},[e._v("#")]),e._v(" Exceptions")]),e._v(" "),a("p",[e._v("Any N-API function call may result in a pending JavaScript exception. This is\nobviously the case for any function that may cause the execution of\nJavaScript, but N-API specifies that an exception may be pending\non return from any of the API functions.")]),e._v(" "),a("p",[e._v("If the "),a("code",[e._v("napi_status")]),e._v(" returned by a function is "),a("code",[e._v("napi_ok")]),e._v(" then no\nexception is pending and no additional action is required. If the\n"),a("code",[e._v("napi_status")]),e._v(" returned is anything other than "),a("code",[e._v("napi_ok")]),e._v(" or\n"),a("code",[e._v("napi_pending_exception")]),e._v(", in order to try to recover and continue\ninstead of simply returning immediately, "),a("a",{attrs:{href:"#n_api_napi_is_exception_pending"}},[a("code",[e._v("napi_is_exception_pending")])]),e._v("\nmust be called in order to determine if an exception is pending or not.")]),e._v(" "),a("p",[e._v("In many cases when an N-API function is called and an exception is\nalready pending, the function will return immediately with a\n"),a("code",[e._v("napi_status")]),e._v(" of "),a("code",[e._v("napi_pending_exception")]),e._v(". However, this is not the case\nfor all functions. N-API allows a subset of the functions to be\ncalled to allow for some minimal cleanup before returning to JavaScript.\nIn that case, "),a("code",[e._v("napi_status")]),e._v(" will reflect the status for the function. It\nwill not reflect previous pending exceptions. To avoid confusion, check\nthe error status after every function call.")]),e._v(" "),a("p",[e._v("When an exception is pending one of two approaches can be employed.")]),e._v(" "),a("p",[e._v("The first approach is to do any appropriate cleanup and then return so that\nexecution will return to JavaScript. As part of the transition back to\nJavaScript, the exception will be thrown at the point in the JavaScript\ncode where the native method was invoked. The behavior of most N-API calls\nis unspecified while an exception is pending, and many will simply return\n"),a("code",[e._v("napi_pending_exception")]),e._v(", so do as little as possible and then return to\nJavaScript where the exception can be handled.")]),e._v(" "),a("p",[e._v("The second approach is to try to handle the exception. There will be cases\nwhere the native code can catch the exception, take the appropriate action,\nand then continue. This is only recommended in specific cases\nwhere it is known that the exception can be safely handled. In these\ncases "),a("a",{attrs:{href:"#n_api_napi_get_and_clear_last_exception"}},[a("code",[e._v("napi_get_and_clear_last_exception")])]),e._v(" can be used to get and\nclear the exception. On success, result will contain the handle to\nthe last JavaScript "),a("code",[e._v("Object")]),e._v(" thrown. If it is determined, after\nretrieving the exception, the exception cannot be handled after all\nit can be re-thrown it with "),a("a",{attrs:{href:"#n_api_napi_throw"}},[a("code",[e._v("napi_throw")])]),e._v(" where error is the\nJavaScript "),a("code",[e._v("Error")]),e._v(" object to be thrown.")]),e._v(" "),a("p",[e._v("The following utility functions are also available in case native code\nneeds to throw an exception or determine if a "),a("code",[e._v("napi_value")]),e._v(" is an instance\nof a JavaScript "),a("code",[e._v("Error")]),e._v(" object: "),a("a",{attrs:{href:"#n_api_napi_throw_error"}},[a("code",[e._v("napi_throw_error")])]),e._v(",\n"),a("a",{attrs:{href:"#n_api_napi_throw_type_error"}},[a("code",[e._v("napi_throw_type_error")])]),e._v(", "),a("a",{attrs:{href:"#n_api_napi_throw_range_error"}},[a("code",[e._v("napi_throw_range_error")])]),e._v(" and\n"),a("a",{attrs:{href:"#n_api_napi_is_error"}},[a("code",[e._v("napi_is_error")])]),e._v(".")]),e._v(" "),a("p",[e._v("The following utility functions are also available in case native\ncode needs to create an "),a("code",[e._v("Error")]),e._v(" object: "),a("a",{attrs:{href:"#n_api_napi_create_error"}},[a("code",[e._v("napi_create_error")])]),e._v(",\n"),a("a",{attrs:{href:"#n_api_napi_create_type_error"}},[a("code",[e._v("napi_create_type_error")])]),e._v(", and "),a("a",{attrs:{href:"#n_api_napi_create_range_error"}},[a("code",[e._v("napi_create_range_error")])]),e._v(",\nwhere result is the "),a("code",[e._v("napi_value")]),e._v(" that refers to the newly created\nJavaScript "),a("code",[e._v("Error")]),e._v(" object.")]),e._v(" "),a("p",[e._v("The Node.js project is adding error codes to all of the errors\ngenerated internally. The goal is for applications to use these\nerror codes for all error checking. The associated error messages\nwill remain, but will only be meant to be used for logging and\ndisplay with the expectation that the message can change without\nSemVer applying. In order to support this model with N-API, both\nin internal functionality and for module specific functionality\n(as its good practice), the "),a("code",[e._v("throw_")]),e._v(" and "),a("code",[e._v("create_")]),e._v(" functions\ntake an optional code parameter which is the string for the code\nto be added to the error object. If the optional parameter is NULL\nthen no code will be associated with the error. If a code is provided,\nthe name associated with the error is also updated to be:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("originalName [code]\n")])])]),a("p",[e._v("where "),a("code",[e._v("originalName")]),e._v(" is the original name associated with the error\nand "),a("code",[e._v("code")]),e._v(" is the code that was provided. For example, if the code\nis "),a("code",[e._v("'ERR_ERROR_1'")]),e._v(" and a "),a("code",[e._v("TypeError")]),e._v(" is being created the name will be:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("TypeError [ERR_ERROR_1]\n")])])]),a("h4",{attrs:{id:"napi-throw"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-throw"}},[e._v("#")]),e._v(" napi_throw")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("NAPI_EXTERN napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_throw")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_value error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] error")]),e._v(": The JavaScript value to be thrown.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API throws the JavaScript value provided.")]),e._v(" "),a("h4",{attrs:{id:"napi-throw-error"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-throw-error"}},[e._v("#")]),e._v(" napi_throw_error")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("NAPI_EXTERN napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_throw_error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                         "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("char")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                         "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("char")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] code")]),e._v(": Optional error code to be set on the error.")]),e._v(" "),a("li",[a("code",[e._v("[in] msg")]),e._v(": C string representing the text to be associated with\nthe error.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API throws a JavaScript "),a("code",[e._v("Error")]),e._v(" with the text provided.")]),e._v(" "),a("h4",{attrs:{id:"napi-throw-type-error"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-throw-type-error"}},[e._v("#")]),e._v(" napi_throw_type_error")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("NAPI_EXTERN napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_throw_type_error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("char")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("char")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] code")]),e._v(": Optional error code to be set on the error.")]),e._v(" "),a("li",[a("code",[e._v("[in] msg")]),e._v(": C string representing the text to be associated with\nthe error.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API throws a JavaScript "),a("code",[e._v("TypeError")]),e._v(" with the text provided.")]),e._v(" "),a("h4",{attrs:{id:"napi-throw-range-error"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-throw-range-error"}},[e._v("#")]),e._v(" napi_throw_range_error")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("NAPI_EXTERN napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_throw_range_error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                               "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("char")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                               "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("char")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] code")]),e._v(": Optional error code to be set on the error.")]),e._v(" "),a("li",[a("code",[e._v("[in] msg")]),e._v(": C string representing the text to be associated with\nthe error.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API throws a JavaScript "),a("code",[e._v("RangeError")]),e._v(" with the text provided.")]),e._v(" "),a("h4",{attrs:{id:"napi-is-error"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-is-error"}},[e._v("#")]),e._v(" napi_is_error")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("NAPI_EXTERN napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_is_error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                      napi_value value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                      bool"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": The "),a("code",[e._v("napi_value")]),e._v(" to be checked.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": Boolean value that is set to true if "),a("code",[e._v("napi_value")]),e._v(" represents\nan error, false otherwise.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API queries a "),a("code",[e._v("napi_value")]),e._v(" to check if it represents an error object.")]),e._v(" "),a("h4",{attrs:{id:"napi-create-error"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-create-error"}},[e._v("#")]),e._v(" napi_create_error")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("NAPI_EXTERN napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                          napi_value code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                          napi_value msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                          napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] code")]),e._v(": Optional "),a("code",[e._v("napi_value")]),e._v(" with the string for the error code to\nbe associated with the error.")]),e._v(" "),a("li",[a("code",[e._v("[in] msg")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" that references a JavaScript "),a("code",[e._v("String")]),e._v(" to be\nused as the message for the "),a("code",[e._v("Error")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing the error created.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API returns a JavaScript "),a("code",[e._v("Error")]),e._v(" with the text provided.")]),e._v(" "),a("h4",{attrs:{id:"napi-create-type-error"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-create-type-error"}},[e._v("#")]),e._v(" napi_create_type_error")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("NAPI_EXTERN napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_type_error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                               napi_value code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                               napi_value msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                               napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] code")]),e._v(": Optional "),a("code",[e._v("napi_value")]),e._v(" with the string for the error code to\nbe associated with the error.")]),e._v(" "),a("li",[a("code",[e._v("[in] msg")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" that references a JavaScript "),a("code",[e._v("String")]),e._v(" to be\nused as the message for the "),a("code",[e._v("Error")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing the error created.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API returns a JavaScript "),a("code",[e._v("TypeError")]),e._v(" with the text provided.")]),e._v(" "),a("h4",{attrs:{id:"napi-create-range-error"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-create-range-error"}},[e._v("#")]),e._v(" napi_create_range_error")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("NAPI_EXTERN napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_range_error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                                napi_value code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                                napi_value msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                                napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] code")]),e._v(": Optional "),a("code",[e._v("napi_value")]),e._v(" with the string for the error code to\nbe associated with the error.")]),e._v(" "),a("li",[a("code",[e._v("[in] msg")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" that references a JavaScript "),a("code",[e._v("String")]),e._v(" to be\nused as the message for the "),a("code",[e._v("Error")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing the error created.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API returns a JavaScript "),a("code",[e._v("RangeError")]),e._v(" with the text provided.")]),e._v(" "),a("h4",{attrs:{id:"napi-get-and-clear-last-exception"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-and-clear-last-exception"}},[e._v("#")]),e._v(" napi_get_and_clear_last_exception")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_and_clear_last_exception")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                              napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": The exception if one is pending, NULL otherwise.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API returns true if an exception is pending.")]),e._v(" "),a("p",[e._v("This API can be called even if there is a pending JavaScript exception.")]),e._v(" "),a("h4",{attrs:{id:"napi-is-exception-pending"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-is-exception-pending"}},[e._v("#")]),e._v(" napi_is_exception_pending")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_is_exception_pending")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" bool"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": Boolean value that is set to true if an exception is pending.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API returns true if an exception is pending.")]),e._v(" "),a("p",[e._v("This API can be called even if there is a pending JavaScript exception.")]),e._v(" "),a("h4",{attrs:{id:"napi-fatal-exception"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-fatal-exception"}},[e._v("#")]),e._v(" napi_fatal_exception")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_fatal_exception")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_value err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] err")]),e._v(": The error that is passed to "),a("code",[e._v("'uncaughtException'")]),e._v(".")])]),e._v(" "),a("p",[e._v("Trigger an "),a("code",[e._v("'uncaughtException'")]),e._v(" in JavaScript. Useful if an async\ncallback throws an exception with no way to recover.")]),e._v(" "),a("h3",{attrs:{id:"fatal-errors"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fatal-errors"}},[e._v("#")]),e._v(" Fatal Errors")]),e._v(" "),a("p",[e._v("In the event of an unrecoverable error in a native module, a fatal error can be\nthrown to immediately terminate the process.")]),e._v(" "),a("h4",{attrs:{id:"napi-fatal-error"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-fatal-error"}},[e._v("#")]),e._v(" napi_fatal_error")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("NAPI_NO_RETURN "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_fatal_error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("char")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" location"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                                 size_t location_len"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                                 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("char")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                                 size_t message_len"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] location")]),e._v(": Optional location at which the error occurred.")]),e._v(" "),a("li",[a("code",[e._v("[in] location_len")]),e._v(": The length of the location in bytes, or\n"),a("code",[e._v("NAPI_AUTO_LENGTH")]),e._v(" if it is null-terminated.")]),e._v(" "),a("li",[a("code",[e._v("[in] message")]),e._v(": The message associated with the error.")]),e._v(" "),a("li",[a("code",[e._v("[in] message_len")]),e._v(": The length of the message in bytes, or\n"),a("code",[e._v("NAPI_AUTO_LENGTH")]),e._v(" if it is\nnull-terminated.")])]),e._v(" "),a("p",[e._v("The function call does not return, the process will be terminated.")]),e._v(" "),a("p",[e._v("This API can be called even if there is a pending JavaScript exception.")]),e._v(" "),a("h2",{attrs:{id:"object-lifetime-management"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#object-lifetime-management"}},[e._v("#")]),e._v(" Object Lifetime management")]),e._v(" "),a("p",[e._v("As N-API calls are made, handles to objects in the heap for the underlying\nVM may be returned as "),a("code",[e._v("napi_values")]),e._v(". These handles must hold the\nobjects 'live' until they are no longer required by the native code,\notherwise the objects could be collected before the native code was\nfinished using them.")]),e._v(" "),a("p",[e._v("As object handles are returned they are associated with a\n'scope'. The lifespan for the default scope is tied to the lifespan\nof the native method call. The result is that, by default, handles\nremain valid and the objects associated with these handles will be\nheld live for the lifespan of the native method call.")]),e._v(" "),a("p",[e._v("In many cases, however, it is necessary that the handles remain valid for\neither a shorter or longer lifespan than that of the native method.\nThe sections which follow describe the N-API functions that can be used\nto change the handle lifespan from the default.")]),e._v(" "),a("h3",{attrs:{id:"making-handle-lifespan-shorter-than-that-of-the-native-method"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#making-handle-lifespan-shorter-than-that-of-the-native-method"}},[e._v("#")]),e._v(" Making handle lifespan shorter than that of the native method")]),e._v(" "),a("p",[e._v("It is often necessary to make the lifespan of handles shorter than\nthe lifespan of a native method. For example, consider a native method\nthat has a loop which iterates through the elements in a large array:")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("for")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("int")]),e._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1000000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  napi_value result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  napi_status status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_element")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("break")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// do something with element")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),a("p",[e._v("This would result in a large number of handles being created, consuming\nsubstantial resources. In addition, even though the native code could only\nuse the most recent handle, all of the associated objects would also be\nkept alive since they all share the same scope.")]),e._v(" "),a("p",[e._v("To handle this case, N-API provides the ability to establish a new 'scope' to\nwhich newly created handles will be associated. Once those handles\nare no longer required, the scope can be 'closed' and any handles associated\nwith the scope are invalidated. The methods available to open/close scopes are\n"),a("a",{attrs:{href:"#n_api_napi_open_handle_scope"}},[a("code",[e._v("napi_open_handle_scope")])]),e._v(" and "),a("a",{attrs:{href:"#n_api_napi_close_handle_scope"}},[a("code",[e._v("napi_close_handle_scope")])]),e._v(".")]),e._v(" "),a("p",[e._v("N-API only supports a single nested hierarchy of scopes. There is only one\nactive scope at any time, and all new handles will be associated with that\nscope while it is active. Scopes must be closed in the reverse order from\nwhich they are opened. In addition, all scopes created within a native method\nmust be closed before returning from that method.")]),e._v(" "),a("p",[e._v("Taking the earlier example, adding calls to "),a("a",{attrs:{href:"#n_api_napi_open_handle_scope"}},[a("code",[e._v("napi_open_handle_scope")])]),e._v(" and\n"),a("a",{attrs:{href:"#n_api_napi_close_handle_scope"}},[a("code",[e._v("napi_close_handle_scope")])]),e._v(" would ensure that at most a single handle\nis valid throughout the execution of the loop:")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("for")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("int")]),e._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1000000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  napi_handle_scope scope"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  napi_status status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_open_handle_scope")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("scope"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("break")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n  napi_value result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_element")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("break")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// do something with element")]),e._v("\n  status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_close_handle_scope")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" scope"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("break")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),a("p",[e._v("When nesting scopes, there are cases where a handle from an\ninner scope needs to live beyond the lifespan of that scope. N-API supports an\n'escapable scope' in order to support this case. An escapable scope\nallows one handle to be 'promoted' so that it 'escapes' the\ncurrent scope and the lifespan of the handle changes from the current\nscope to that of the outer scope.")]),e._v(" "),a("p",[e._v("The methods available to open/close escapable scopes are\n"),a("a",{attrs:{href:"#n_api_napi_open_escapable_handle_scope"}},[a("code",[e._v("napi_open_escapable_handle_scope")])]),e._v(" and\n"),a("a",{attrs:{href:"#n_api_napi_close_escapable_handle_scope"}},[a("code",[e._v("napi_close_escapable_handle_scope")])]),e._v(".")]),e._v(" "),a("p",[e._v("The request to promote a handle is made through "),a("a",{attrs:{href:"#n_api_napi_escape_handle"}},[a("code",[e._v("napi_escape_handle")])]),e._v(" which\ncan only be called once.")]),e._v(" "),a("h4",{attrs:{id:"napi-open-handle-scope"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-open-handle-scope"}},[e._v("#")]),e._v(" napi_open_handle_scope")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("NAPI_EXTERN napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_open_handle_scope")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                               napi_handle_scope"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing the new scope.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API open a new scope.")]),e._v(" "),a("h4",{attrs:{id:"napi-close-handle-scope"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-close-handle-scope"}},[e._v("#")]),e._v(" napi_close_handle_scope")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("NAPI_EXTERN napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_close_handle_scope")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                                napi_handle_scope scope"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] scope")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing the scope to be closed.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API closes the scope passed in. Scopes must be closed in the\nreverse order from which they were created.")]),e._v(" "),a("p",[e._v("This API can be called even if there is a pending JavaScript exception.")]),e._v(" "),a("h4",{attrs:{id:"napi-open-escapable-handle-scope"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-open-escapable-handle-scope"}},[e._v("#")]),e._v(" napi_open_escapable_handle_scope")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("NAPI_EXTERN napi_status\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_open_escapable_handle_scope")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                     napi_handle_scope"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing the new scope.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API open a new scope from which one object can be promoted\nto the outer scope.")]),e._v(" "),a("h4",{attrs:{id:"napi-close-escapable-handle-scope"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-close-escapable-handle-scope"}},[e._v("#")]),e._v(" napi_close_escapable_handle_scope")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("NAPI_EXTERN napi_status\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_close_escapable_handle_scope")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                      napi_handle_scope scope"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] scope")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing the scope to be closed.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API closes the scope passed in. Scopes must be closed in the\nreverse order from which they were created.")]),e._v(" "),a("p",[e._v("This API can be called even if there is a pending JavaScript exception.")]),e._v(" "),a("h4",{attrs:{id:"napi-escape-handle"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-escape-handle"}},[e._v("#")]),e._v(" napi_escape_handle")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_escape_handle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                               napi_escapable_handle_scope scope"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                               napi_value escapee"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                               napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] scope")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing the current scope.")]),e._v(" "),a("li",[a("code",[e._v("[in] escapee")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing the JavaScript "),a("code",[e._v("Object")]),e._v(" to be\nescaped.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing the handle to the escaped\n"),a("code",[e._v("Object")]),e._v(" in the outer scope.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API promotes the handle to the JavaScript object so that it is valid\nfor the lifetime of the outer scope. It can only be called once per scope.\nIf it is called more than once an error will be returned.")]),e._v(" "),a("p",[e._v("This API can be called even if there is a pending JavaScript exception.")]),e._v(" "),a("h3",{attrs:{id:"references-to-objects-with-a-lifespan-longer-than-that-of-the-native-method"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#references-to-objects-with-a-lifespan-longer-than-that-of-the-native-method"}},[e._v("#")]),e._v(" References to objects with a lifespan longer than that of the native method")]),e._v(" "),a("p",[e._v("In some cases an addon will need to be able to create and reference objects\nwith a lifespan longer than that of a single native method invocation. For\nexample, to create a constructor and later use that constructor\nin a request to creates instances, it must be possible to reference\nthe constructor object across many different instance creation requests. This\nwould not be possible with a normal handle returned as a "),a("code",[e._v("napi_value")]),e._v(" as\ndescribed in the earlier section. The lifespan of a normal handle is\nmanaged by scopes and all scopes must be closed before the end of a native\nmethod.")]),e._v(" "),a("p",[e._v("N-API provides methods to create persistent references to an object.\nEach persistent reference has an associated count with a value of 0\nor higher. The count determines if the reference will keep\nthe corresponding object live. References with a count of 0 do not\nprevent the object from being collected and are often called 'weak'\nreferences. Any count greater than 0 will prevent the object\nfrom being collected.")]),e._v(" "),a("p",[e._v("References can be created with an initial reference count. The count can\nthen be modified through "),a("a",{attrs:{href:"#n_api_napi_reference_ref"}},[a("code",[e._v("napi_reference_ref")])]),e._v(" and\n"),a("a",{attrs:{href:"#n_api_napi_reference_unref"}},[a("code",[e._v("napi_reference_unref")])]),e._v(". If an object is collected while the count\nfor a reference is 0, all subsequent calls to\nget the object associated with the reference "),a("a",{attrs:{href:"#n_api_napi_get_reference_value"}},[a("code",[e._v("napi_get_reference_value")])]),e._v("\nwill return NULL for the returned "),a("code",[e._v("napi_value")]),e._v(". An attempt to call\n"),a("a",{attrs:{href:"#n_api_napi_reference_ref"}},[a("code",[e._v("napi_reference_ref")])]),e._v(" for a reference whose object has been collected\nwill result in an error.")]),e._v(" "),a("p",[e._v("References must be deleted once they are no longer required by the addon. When\na reference is deleted it will no longer prevent the corresponding object from\nbeing collected. Failure to delete a persistent reference will result in\na 'memory leak' with both the native memory for the persistent reference and\nthe corresponding object on the heap being retained forever.")]),e._v(" "),a("p",[e._v("There can be multiple persistent references created which refer to the same\nobject, each of which will either keep the object live or not based on its\nindividual count.")]),e._v(" "),a("h4",{attrs:{id:"napi-create-reference"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-create-reference"}},[e._v("#")]),e._v(" napi_create_reference")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("NAPI_EXTERN napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_reference")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                              napi_value value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("int")]),e._v(" initial_refcount"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                              napi_ref"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing the "),a("code",[e._v("Object")]),e._v(" to which we want\na reference.")]),e._v(" "),a("li",[a("code",[e._v("[in] initial_refcount")]),e._v(": Initial reference count for the new reference.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": "),a("code",[e._v("napi_ref")]),e._v(" pointing to the new reference.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API create a new reference with the specified reference count\nto the "),a("code",[e._v("Object")]),e._v(" passed in.")]),e._v(" "),a("h4",{attrs:{id:"napi-delete-reference"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-delete-reference"}},[e._v("#")]),e._v(" napi_delete_reference")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("NAPI_EXTERN napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_delete_reference")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_ref ref"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] ref")]),e._v(": "),a("code",[e._v("napi_ref")]),e._v(" to be deleted.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API deletes the reference passed in.")]),e._v(" "),a("p",[e._v("This API can be called even if there is a pending JavaScript exception.")]),e._v(" "),a("h4",{attrs:{id:"napi-reference-ref"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-reference-ref"}},[e._v("#")]),e._v(" napi_reference_ref")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("NAPI_EXTERN napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_reference_ref")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                           napi_ref ref"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                           "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("int")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] ref")]),e._v(": "),a("code",[e._v("napi_ref")]),e._v(" for which the reference count will be incremented.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": The new reference count.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API increments the reference count for the reference\npassed in and returns the resulting reference count.")]),e._v(" "),a("h4",{attrs:{id:"napi-reference-unref"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-reference-unref"}},[e._v("#")]),e._v(" napi_reference_unref")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("NAPI_EXTERN napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_reference_unref")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                             napi_ref ref"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                             "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("int")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] ref")]),e._v(": "),a("code",[e._v("napi_ref")]),e._v(" for which the reference count will be decremented.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": The new reference count.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API decrements the reference count for the reference\npassed in and returns the resulting reference count.")]),e._v(" "),a("h4",{attrs:{id:"napi-get-reference-value"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-reference-value"}},[e._v("#")]),e._v(" napi_get_reference_value")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("NAPI_EXTERN napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_reference_value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                                 napi_ref ref"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                                 napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("the "),a("code",[e._v("napi_value passed")]),e._v(" in or out of these methods is a handle to the\nobject to which the reference is related.")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] ref")]),e._v(": "),a("code",[e._v("napi_ref")]),e._v(" for which we requesting the corresponding "),a("code",[e._v("Object")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": The "),a("code",[e._v("napi_value")]),e._v(" for the "),a("code",[e._v("Object")]),e._v(" referenced by the\n"),a("code",[e._v("napi_ref")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("If still valid, this API returns the "),a("code",[e._v("napi_value")]),e._v(" representing the\nJavaScript "),a("code",[e._v("Object")]),e._v(" associated with the "),a("code",[e._v("napi_ref")]),e._v(". Otherwise, result\nwill be NULL.")]),e._v(" "),a("h3",{attrs:{id:"cleanup-on-exit-of-the-current-node-js-instance"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cleanup-on-exit-of-the-current-node-js-instance"}},[e._v("#")]),e._v(" Cleanup on exit of the current Node.js instance")]),e._v(" "),a("p",[e._v("While a Node.js process typically releases all its resources when exiting,\nembedders of Node.js, or future Worker support, may require addons to register\nclean-up hooks that will be run once the current Node.js instance exits.")]),e._v(" "),a("p",[e._v("N-API provides functions for registering and un-registering such callbacks.\nWhen those callbacks are run, all resources that are being held by the addon\nshould be freed up.")]),e._v(" "),a("h4",{attrs:{id:"napi-add-env-cleanup-hook"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-add-env-cleanup-hook"}},[e._v("#")]),e._v(" napi_add_env_cleanup_hook")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("NODE_EXTERN napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_add_env_cleanup_hook")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                                  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v("fun"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" arg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                                  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" arg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("Registers "),a("code",[e._v("fun")]),e._v(" as a function to be run with the "),a("code",[e._v("arg")]),e._v(" parameter once the\ncurrent Node.js environment exits.")]),e._v(" "),a("p",[e._v("A function can safely be specified multiple times with different\n"),a("code",[e._v("arg")]),e._v(" values. In that case, it will be called multiple times as well.\nProviding the same "),a("code",[e._v("fun")]),e._v(" and "),a("code",[e._v("arg")]),e._v(" values multiple times is not allowed\nand will lead the process to abort.")]),e._v(" "),a("p",[e._v("The hooks will be called in reverse order, i.e. the most recently added one\nwill be called first.")]),e._v(" "),a("p",[e._v("Removing this hook can be done by using "),a("code",[e._v("napi_remove_env_cleanup_hook")]),e._v(".\nTypically, that happens when the resource for which this hook was added\nis being torn down anyway.")]),e._v(" "),a("h4",{attrs:{id:"napi-remove-env-cleanup-hook"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-remove-env-cleanup-hook"}},[e._v("#")]),e._v(" napi_remove_env_cleanup_hook")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("NAPI_EXTERN napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_remove_env_cleanup_hook")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                                     "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v("fun"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" arg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                                     "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" arg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("Unregisters "),a("code",[e._v("fun")]),e._v(" as a function to be run with the "),a("code",[e._v("arg")]),e._v(" parameter once the\ncurrent Node.js environment exits. Both the argument and the function value\nneed to be exact matches.")]),e._v(" "),a("p",[e._v("The function must have originally been registered\nwith "),a("code",[e._v("napi_add_env_cleanup_hook")]),e._v(", otherwise the process will abort.")]),e._v(" "),a("h2",{attrs:{id:"module-registration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#module-registration"}},[e._v("#")]),e._v(" Module registration")]),e._v(" "),a("p",[e._v("N-API modules are registered in a manner similar to other modules\nexcept that instead of using the "),a("code",[e._v("NODE_MODULE")]),e._v(" macro the following\nis used:")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("NAPI_MODULE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("NODE_GYP_MODULE_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" Init"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("p",[e._v("The next difference is the signature for the "),a("code",[e._v("Init")]),e._v(" method. For a N-API\nmodule it is as follows:")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_value "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("Init")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_value exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("The return value from "),a("code",[e._v("Init")]),e._v(" is treated as the "),a("code",[e._v("exports")]),e._v(" object for the module.\nThe "),a("code",[e._v("Init")]),e._v(" method is passed an empty object via the "),a("code",[e._v("exports")]),e._v(" parameter as a\nconvenience. If "),a("code",[e._v("Init")]),e._v(" returns NULL, the parameter passed as "),a("code",[e._v("exports")]),e._v(" is\nexported by the module. N-API modules cannot modify the "),a("code",[e._v("module")]),e._v(" object but can\nspecify anything as the "),a("code",[e._v("exports")]),e._v(" property of the module.")]),e._v(" "),a("p",[e._v("To add the method "),a("code",[e._v("hello")]),e._v(" as a function so that it can be called as a method\nprovided by the addon:")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_value "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("Init")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_value exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  napi_status status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  napi_property_descriptor desc "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"hello"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" Method"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_default"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_define_properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("desc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),a("p",[e._v("To set a function to be returned by the "),a("code",[e._v("require()")]),e._v(" for the addon:")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_value "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("Init")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_value exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  napi_value method"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  napi_status status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"exports"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" NAPI_AUTO_LENGTH"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" Method"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("method"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" method"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),a("p",[e._v("To define a class so that new instances can be created (often used with\n"),a("a",{attrs:{href:"#n_api_object_wrap"}},[e._v("Object Wrap")]),e._v("):")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// NOTE: partial example, not all referenced code is included")]),e._v("\nnapi_value "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("Init")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_value exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  napi_status status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  napi_property_descriptor properties"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"value"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" GetValue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" SetValue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_default"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("DECLARE_NAPI_METHOD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"plusOne"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" PlusOne"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("DECLARE_NAPI_METHOD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"multiply"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" Multiply"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n  napi_value cons"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_define_class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"MyObject"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" New"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" properties"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("cons"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n  status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_reference")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" cons"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("constructor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n  status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_set_named_property")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"MyObject"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" cons"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),a("p",[e._v("If the module will be loaded multiple times during the lifetime of the Node.js\nprocess, use the "),a("code",[e._v("NAPI_MODULE_INIT")]),e._v(" macro to initialize the module:")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("NAPI_MODULE_INIT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  napi_value answer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  napi_status result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n  status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_int64")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("42")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("answer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n  status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_set_named_property")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"answer"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" answer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),a("p",[e._v("This macro includes "),a("code",[e._v("NAPI_MODULE")]),e._v(", and declares an "),a("code",[e._v("Init")]),e._v(" function with a\nspecial name and with visibility beyond the addon. This will allow Node.js to\ninitialize the module even if it is loaded multiple times.")]),e._v(" "),a("p",[e._v("There are a few design considerations when declaring a module that may be loaded\nmultiple times. The documentation of "),a("router-link",{attrs:{to:"/node/addons.html#addons_context_aware_addons"}},[e._v("context-aware addons")]),e._v(" provides more\ndetails.")],1),e._v(" "),a("p",[e._v("The variables "),a("code",[e._v("env")]),e._v(" and "),a("code",[e._v("exports")]),e._v(" will be available inside the function body\nfollowing the macro invocation.")]),e._v(" "),a("p",[e._v("For more details on setting properties on objects, see the section on\n"),a("a",{attrs:{href:"#n_api_working_with_javascript_properties"}},[e._v("Working with JavaScript Properties")]),e._v(".")]),e._v(" "),a("p",[e._v("For more details on building addon modules in general, refer to the existing\nAPI.")]),e._v(" "),a("h2",{attrs:{id:"working-with-javascript-values"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#working-with-javascript-values"}},[e._v("#")]),e._v(" Working with JavaScript Values")]),e._v(" "),a("p",[e._v("N-API exposes a set of APIs to create all types of JavaScript values.\nSome of these types are documented under "),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 6"),a("OutboundLink")],1),e._v("\nof the "),a("a",{attrs:{href:"https://tc39.github.io/ecma262/",target:"_blank",rel:"noopener noreferrer"}},[e._v("ECMAScript Language Specification"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("p",[e._v("Fundamentally, these APIs are used to do one of the following:")]),e._v(" "),a("ol",[a("li",[e._v("Create a new JavaScript object")]),e._v(" "),a("li",[e._v("Convert from a primitive C type to an N-API value")]),e._v(" "),a("li",[e._v("Convert from N-API value to a primitive C type")]),e._v(" "),a("li",[e._v("Get global instances including "),a("code",[e._v("undefined")]),e._v(" and "),a("code",[e._v("null")])])]),e._v(" "),a("p",[e._v("N-API values are represented by the type "),a("code",[e._v("napi_value")]),e._v(".\nAny N-API call that requires a JavaScript value takes in a "),a("code",[e._v("napi_value")]),e._v(".\nIn some cases, the API does check the type of the "),a("code",[e._v("napi_value")]),e._v(" up-front.\nHowever, for better performance, it's better for the caller to make sure that\nthe "),a("code",[e._v("napi_value")]),e._v(" in question is of the JavaScript type expected by the API.")]),e._v(" "),a("h3",{attrs:{id:"enum-types"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#enum-types"}},[e._v("#")]),e._v(" Enum types")]),e._v(" "),a("h4",{attrs:{id:"napi-valuetype"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-valuetype"}},[e._v("#")]),e._v(" napi_valuetype")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("typedef")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("enum")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// ES6 types (corresponds to typeof)")]),e._v("\n  napi_undefined"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_null"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_boolean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_number"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_symbol"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_function"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_external"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_bigint"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" napi_valuetype"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("Describes the type of a "),a("code",[e._v("napi_value")]),e._v(". This generally corresponds to the types\ndescribed in "),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-ecmascript-language-types",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 6.1"),a("OutboundLink")],1),e._v(" of the ECMAScript Language Specification.\nIn addition to types in that section, "),a("code",[e._v("napi_valuetype")]),e._v(" can also represent\n"),a("code",[e._v("Function")]),e._v("s and "),a("code",[e._v("Object")]),e._v("s with external data.")]),e._v(" "),a("p",[e._v("A JavaScript value of type "),a("code",[e._v("napi_external")]),e._v(" appears in JavaScript as a plain\nobject such that no properties can be set on it, and no prototype.")]),e._v(" "),a("h4",{attrs:{id:"napi-typedarray-type"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-typedarray-type"}},[e._v("#")]),e._v(" napi_typedarray_type")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("typedef")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("enum")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  napi_int8_array"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_uint8_array"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_uint8_clamped_array"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_int16_array"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_uint16_array"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_int32_array"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_uint32_array"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_float32_array"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_float64_array"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_bigint64_array"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_biguint64_array"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" napi_typedarray_type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("This represents the underlying binary scalar datatype of the "),a("code",[e._v("TypedArray")]),e._v(".\nElements of this enum correspond to\n"),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-typedarray-objects",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 22.2"),a("OutboundLink")],1),e._v(" of the "),a("a",{attrs:{href:"https://tc39.github.io/ecma262/",target:"_blank",rel:"noopener noreferrer"}},[e._v("ECMAScript Language Specification"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"object-creation-functions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#object-creation-functions"}},[e._v("#")]),e._v(" Object Creation Functions")]),e._v(" "),a("h4",{attrs:{id:"napi-create-array"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-create-array"}},[e._v("#")]),e._v(" napi_create_array")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_array")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the N-API call is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": A "),a("code",[e._v("napi_value")]),e._v(" representing a JavaScript "),a("code",[e._v("Array")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API returns an N-API value corresponding to a JavaScript "),a("code",[e._v("Array")]),e._v(" type.\nJavaScript arrays are described in\n"),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-array-objects",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 22.1"),a("OutboundLink")],1),e._v(" of the ECMAScript Language Specification.")]),e._v(" "),a("h4",{attrs:{id:"napi-create-array-with-length"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-create-array-with-length"}},[e._v("#")]),e._v(" napi_create_array_with_length")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_array_with_length")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                          size_t length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                          napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] length")]),e._v(": The initial length of the "),a("code",[e._v("Array")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": A "),a("code",[e._v("napi_value")]),e._v(" representing a JavaScript "),a("code",[e._v("Array")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API returns an N-API value corresponding to a JavaScript "),a("code",[e._v("Array")]),e._v(" type.\nThe "),a("code",[e._v("Array")]),e._v("'s length property is set to the passed-in length parameter.\nHowever, the underlying buffer is not guaranteed to be pre-allocated by the VM\nwhen the array is created. That behavior is left to the underlying VM\nimplementation. If the buffer must be a contiguous block of memory that can be\ndirectly read and/or written via C, consider using\n"),a("a",{attrs:{href:"#n_api_napi_create_external_arraybuffer"}},[a("code",[e._v("napi_create_external_arraybuffer")])]),e._v(".")]),e._v(" "),a("p",[e._v("JavaScript arrays are described in\n"),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-array-objects",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 22.1"),a("OutboundLink")],1),e._v(" of the ECMAScript Language Specification.")]),e._v(" "),a("h4",{attrs:{id:"napi-create-arraybuffer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-create-arraybuffer"}},[e._v("#")]),e._v(" napi_create_arraybuffer")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_arraybuffer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                    size_t byte_length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                    napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] length")]),e._v(": The length in bytes of the array buffer to create.")]),e._v(" "),a("li",[a("code",[e._v("[out] data")]),e._v(": Pointer to the underlying byte buffer of the "),a("code",[e._v("ArrayBuffer")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": A "),a("code",[e._v("napi_value")]),e._v(" representing a JavaScript "),a("code",[e._v("ArrayBuffer")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API returns an N-API value corresponding to a JavaScript "),a("code",[e._v("ArrayBuffer")]),e._v(".\n"),a("code",[e._v("ArrayBuffer")]),e._v("s are used to represent fixed-length binary data buffers. They are\nnormally used as a backing-buffer for "),a("code",[e._v("TypedArray")]),e._v(" objects.\nThe "),a("code",[e._v("ArrayBuffer")]),e._v(" allocated will have an underlying byte buffer whose size is\ndetermined by the "),a("code",[e._v("length")]),e._v(" parameter that's passed in.\nThe underlying buffer is optionally returned back to the caller in case the\ncaller wants to directly manipulate the buffer. This buffer can only be\nwritten to directly from native code. To write to this buffer from JavaScript,\na typed array or "),a("code",[e._v("DataView")]),e._v(" object would need to be created.")]),e._v(" "),a("p",[e._v("JavaScript "),a("code",[e._v("ArrayBuffer")]),e._v(" objects are described in\n"),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-arraybuffer-objects",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 24.1"),a("OutboundLink")],1),e._v(" of the ECMAScript Language Specification.")]),e._v(" "),a("h4",{attrs:{id:"napi-create-buffer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-create-buffer"}},[e._v("#")]),e._v(" napi_create_buffer")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_buffer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                               size_t size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                               "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                               napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] size")]),e._v(": Size in bytes of the underlying buffer.")]),e._v(" "),a("li",[a("code",[e._v("[out] data")]),e._v(": Raw pointer to the underlying buffer.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": A "),a("code",[e._v("napi_value")]),e._v(" representing a "),a("code",[e._v("node::Buffer")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API allocates a "),a("code",[e._v("node::Buffer")]),e._v(" object. While this is still a\nfully-supported data structure, in most cases using a "),a("code",[e._v("TypedArray")]),e._v(" will suffice.")]),e._v(" "),a("h4",{attrs:{id:"napi-create-buffer-copy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-create-buffer-copy"}},[e._v("#")]),e._v(" napi_create_buffer_copy")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_buffer_copy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                    size_t length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result_data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                    napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] size")]),e._v(": Size in bytes of the input buffer (should be the same as the\nsize of the new buffer).")]),e._v(" "),a("li",[a("code",[e._v("[in] data")]),e._v(": Raw pointer to the underlying buffer to copy from.")]),e._v(" "),a("li",[a("code",[e._v("[out] result_data")]),e._v(": Pointer to the new "),a("code",[e._v("Buffer")]),e._v("'s underlying data buffer.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": A "),a("code",[e._v("napi_value")]),e._v(" representing a "),a("code",[e._v("node::Buffer")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API allocates a "),a("code",[e._v("node::Buffer")]),e._v(" object and initializes it with data copied\nfrom the passed-in buffer. While this is still a fully-supported data\nstructure, in most cases using a "),a("code",[e._v("TypedArray")]),e._v(" will suffice.")]),e._v(" "),a("h4",{attrs:{id:"napi-create-date"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-create-date"}},[e._v("#")]),e._v(" napi_create_date")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_date")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                             "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("double")]),e._v(" time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                             napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] time")]),e._v(": ECMAScript time value in milliseconds since 01 January, 1970 UTC.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": A "),a("code",[e._v("napi_value")]),e._v(" representing a JavaScript "),a("code",[e._v("Date")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API does not observe leap seconds; they are ignored, as\nECMAScript aligns with POSIX time specification.")]),e._v(" "),a("p",[e._v("This API allocates a JavaScript "),a("code",[e._v("Date")]),e._v(" object.")]),e._v(" "),a("p",[e._v("JavaScript "),a("code",[e._v("Date")]),e._v(" objects are described in\n"),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-date-objects",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 20.3"),a("OutboundLink")],1),e._v(" of the ECMAScript Language Specification.")]),e._v(" "),a("h4",{attrs:{id:"napi-create-external"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-create-external"}},[e._v("#")]),e._v(" napi_create_external")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_external")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                 napi_finalize finalize_cb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" finalize_hint"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                 napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] data")]),e._v(": Raw pointer to the external data.")]),e._v(" "),a("li",[a("code",[e._v("[in] finalize_cb")]),e._v(": Optional callback to call when the external value\nis being collected.")]),e._v(" "),a("li",[a("code",[e._v("[in] finalize_hint")]),e._v(": Optional hint to pass to the finalize callback\nduring collection.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": A "),a("code",[e._v("napi_value")]),e._v(" representing an external value.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API allocates a JavaScript value with external data attached to it. This\nis used to pass external data through JavaScript code, so it can be retrieved\nlater by native code using "),a("a",{attrs:{href:"#n_api_napi_get_value_external"}},[a("code",[e._v("napi_get_value_external")])]),e._v(".")]),e._v(" "),a("p",[e._v("The API adds a "),a("code",[e._v("napi_finalize")]),e._v(" callback which will be called when the JavaScript\nobject just created is ready for garbage collection. It is similar to\n"),a("code",[e._v("napi_wrap()")]),e._v(" except that:")]),e._v(" "),a("ul",[a("li",[e._v("the native data cannot be retrieved later using "),a("code",[e._v("napi_unwrap()")]),e._v(",")]),e._v(" "),a("li",[e._v("nor can it be removed later using "),a("code",[e._v("napi_remove_wrap()")]),e._v(", and")]),e._v(" "),a("li",[e._v("the object created by the API can be used with "),a("code",[e._v("napi_wrap()")]),e._v(".")])]),e._v(" "),a("p",[e._v("The created value is not an object, and therefore does not support additional\nproperties. It is considered a distinct value type: calling "),a("code",[e._v("napi_typeof()")]),e._v(" with\nan external value yields "),a("code",[e._v("napi_external")]),e._v(".")]),e._v(" "),a("h4",{attrs:{id:"napi-create-external-arraybuffer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-create-external-arraybuffer"}},[e._v("#")]),e._v(" napi_create_external_arraybuffer")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_external_arraybuffer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" external_data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                 size_t byte_length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                 napi_finalize finalize_cb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" finalize_hint"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                 napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] external_data")]),e._v(": Pointer to the underlying byte buffer of the\n"),a("code",[e._v("ArrayBuffer")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[in] byte_length")]),e._v(": The length in bytes of the underlying buffer.")]),e._v(" "),a("li",[a("code",[e._v("[in] finalize_cb")]),e._v(": Optional callback to call when the "),a("code",[e._v("ArrayBuffer")]),e._v(" is\nbeing collected.")]),e._v(" "),a("li",[a("code",[e._v("[in] finalize_hint")]),e._v(": Optional hint to pass to the finalize callback\nduring collection.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": A "),a("code",[e._v("napi_value")]),e._v(" representing a JavaScript "),a("code",[e._v("ArrayBuffer")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API returns an N-API value corresponding to a JavaScript "),a("code",[e._v("ArrayBuffer")]),e._v(".\nThe underlying byte buffer of the "),a("code",[e._v("ArrayBuffer")]),e._v(" is externally allocated and\nmanaged. The caller must ensure that the byte buffer remains valid until the\nfinalize callback is called.")]),e._v(" "),a("p",[e._v("The API adds a "),a("code",[e._v("napi_finalize")]),e._v(" callback which will be called when the JavaScript\nobject just created is ready for garbage collection. It is similar to\n"),a("code",[e._v("napi_wrap()")]),e._v(" except that:")]),e._v(" "),a("ul",[a("li",[e._v("the native data cannot be retrieved later using "),a("code",[e._v("napi_unwrap()")]),e._v(",")]),e._v(" "),a("li",[e._v("nor can it be removed later using "),a("code",[e._v("napi_remove_wrap()")]),e._v(", and")]),e._v(" "),a("li",[e._v("the object created by the API can be used with "),a("code",[e._v("napi_wrap()")]),e._v(".")])]),e._v(" "),a("p",[e._v("JavaScript "),a("code",[e._v("ArrayBuffer")]),e._v("s are described in\n"),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-arraybuffer-objects",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 24.1"),a("OutboundLink")],1),e._v(" of the ECMAScript Language Specification.")]),e._v(" "),a("h4",{attrs:{id:"napi-create-external-buffer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-create-external-buffer"}},[e._v("#")]),e._v(" napi_create_external_buffer")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_external_buffer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                        size_t length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                        napi_finalize finalize_cb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" finalize_hint"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                        napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] length")]),e._v(": Size in bytes of the input buffer (should be the same as\nthe size of the new buffer).")]),e._v(" "),a("li",[a("code",[e._v("[in] data")]),e._v(": Raw pointer to the underlying buffer to copy from.")]),e._v(" "),a("li",[a("code",[e._v("[in] finalize_cb")]),e._v(": Optional callback to call when the "),a("code",[e._v("ArrayBuffer")]),e._v(" is\nbeing collected.")]),e._v(" "),a("li",[a("code",[e._v("[in] finalize_hint")]),e._v(": Optional hint to pass to the finalize callback\nduring collection.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": A "),a("code",[e._v("napi_value")]),e._v(" representing a "),a("code",[e._v("node::Buffer")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API allocates a "),a("code",[e._v("node::Buffer")]),e._v(" object and initializes it with data\nbacked by the passed in buffer. While this is still a fully-supported data\nstructure, in most cases using a "),a("code",[e._v("TypedArray")]),e._v(" will suffice.")]),e._v(" "),a("p",[e._v("The API adds a "),a("code",[e._v("napi_finalize")]),e._v(" callback which will be called when the JavaScript\nobject just created is ready for garbage collection. It is similar to\n"),a("code",[e._v("napi_wrap()")]),e._v(" except that:")]),e._v(" "),a("ul",[a("li",[e._v("the native data cannot be retrieved later using "),a("code",[e._v("napi_unwrap()")]),e._v(",")]),e._v(" "),a("li",[e._v("nor can it be removed later using "),a("code",[e._v("napi_remove_wrap()")]),e._v(", and")]),e._v(" "),a("li",[e._v("the object created by the API can be used with "),a("code",[e._v("napi_wrap()")]),e._v(".")])]),e._v(" "),a("p",[e._v("For Node.js >=4 "),a("code",[e._v("Buffers")]),e._v(" are "),a("code",[e._v("Uint8Array")]),e._v("s.")]),e._v(" "),a("h4",{attrs:{id:"napi-create-object"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-create-object"}},[e._v("#")]),e._v(" napi_create_object")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": A "),a("code",[e._v("napi_value")]),e._v(" representing a JavaScript "),a("code",[e._v("Object")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API allocates a default JavaScript "),a("code",[e._v("Object")]),e._v(".\nIt is the equivalent of doing "),a("code",[e._v("new Object()")]),e._v(" in JavaScript.")]),e._v(" "),a("p",[e._v("The JavaScript "),a("code",[e._v("Object")]),e._v(" type is described in "),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-object-type",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 6.1.7"),a("OutboundLink")],1),e._v(" of the\nECMAScript Language Specification.")]),e._v(" "),a("h4",{attrs:{id:"napi-create-symbol"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-create-symbol"}},[e._v("#")]),e._v(" napi_create_symbol")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_symbol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                               napi_value description"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                               napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] description")]),e._v(": Optional "),a("code",[e._v("napi_value")]),e._v(" which refers to a JavaScript\n"),a("code",[e._v("String")]),e._v(" to be set as the description for the symbol.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": A "),a("code",[e._v("napi_value")]),e._v(" representing a JavaScript "),a("code",[e._v("Symbol")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API creates a JavaScript "),a("code",[e._v("Symbol")]),e._v(" object from a UTF8-encoded C string.")]),e._v(" "),a("p",[e._v("The JavaScript "),a("code",[e._v("Symbol")]),e._v(" type is described in "),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-symbol-objects",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 19.4"),a("OutboundLink")],1),e._v("\nof the ECMAScript Language Specification.")]),e._v(" "),a("h4",{attrs:{id:"napi-create-typedarray"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-create-typedarray"}},[e._v("#")]),e._v(" napi_create_typedarray")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_typedarray")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                   napi_typedarray_type type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                   size_t length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                   napi_value arraybuffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                   size_t byte_offset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                   napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] type")]),e._v(": Scalar datatype of the elements within the "),a("code",[e._v("TypedArray")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[in] length")]),e._v(": Number of elements in the "),a("code",[e._v("TypedArray")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[in] arraybuffer")]),e._v(": "),a("code",[e._v("ArrayBuffer")]),e._v(" underlying the typed array.")]),e._v(" "),a("li",[a("code",[e._v("[in] byte_offset")]),e._v(": The byte offset within the "),a("code",[e._v("ArrayBuffer")]),e._v(" from which to\nstart projecting the "),a("code",[e._v("TypedArray")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": A "),a("code",[e._v("napi_value")]),e._v(" representing a JavaScript "),a("code",[e._v("TypedArray")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API creates a JavaScript "),a("code",[e._v("TypedArray")]),e._v(" object over an existing\n"),a("code",[e._v("ArrayBuffer")]),e._v(". "),a("code",[e._v("TypedArray")]),e._v(" objects provide an array-like view over an\nunderlying data buffer where each element has the same underlying binary scalar\ndatatype.")]),e._v(" "),a("p",[e._v("It's required that "),a("code",[e._v("(length * size_of_element) + byte_offset")]),e._v(" should\nbe <= the size in bytes of the array passed in. If not, a "),a("code",[e._v("RangeError")]),e._v(" exception\nis raised.")]),e._v(" "),a("p",[e._v("JavaScript "),a("code",[e._v("TypedArray")]),e._v(" objects are described in\n"),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-typedarray-objects",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 22.2"),a("OutboundLink")],1),e._v(" of the ECMAScript Language Specification.")]),e._v(" "),a("h4",{attrs:{id:"napi-create-dataview"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-create-dataview"}},[e._v("#")]),e._v(" napi_create_dataview")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_dataview")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                 size_t byte_length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                 napi_value arraybuffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                 size_t byte_offset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                 napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] length")]),e._v(": Number of elements in the "),a("code",[e._v("DataView")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[in] arraybuffer")]),e._v(": "),a("code",[e._v("ArrayBuffer")]),e._v(" underlying the "),a("code",[e._v("DataView")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[in] byte_offset")]),e._v(": The byte offset within the "),a("code",[e._v("ArrayBuffer")]),e._v(" from which to\nstart projecting the "),a("code",[e._v("DataView")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": A "),a("code",[e._v("napi_value")]),e._v(" representing a JavaScript "),a("code",[e._v("DataView")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API creates a JavaScript "),a("code",[e._v("DataView")]),e._v(" object over an existing "),a("code",[e._v("ArrayBuffer")]),e._v(".\n"),a("code",[e._v("DataView")]),e._v(" objects provide an array-like view over an underlying data buffer,\nbut one which allows items of different size and type in the "),a("code",[e._v("ArrayBuffer")]),e._v(".")]),e._v(" "),a("p",[e._v("It is required that "),a("code",[e._v("byte_length + byte_offset")]),e._v(" is less than or equal to the\nsize in bytes of the array passed in. If not, a "),a("code",[e._v("RangeError")]),e._v(" exception is\nraised.")]),e._v(" "),a("p",[e._v("JavaScript "),a("code",[e._v("DataView")]),e._v(" objects are described in\n"),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-dataview-objects",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 24.3"),a("OutboundLink")],1),e._v(" of the ECMAScript Language Specification.")]),e._v(" "),a("h3",{attrs:{id:"functions-to-convert-from-c-types-to-n-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#functions-to-convert-from-c-types-to-n-api"}},[e._v("#")]),e._v(" Functions to convert from C types to N-API")]),e._v(" "),a("h4",{attrs:{id:"napi-create-int32"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-create-int32"}},[e._v("#")]),e._v(" napi_create_int32")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_int32")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" int32_t value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": Integer value to be represented in JavaScript.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": A "),a("code",[e._v("napi_value")]),e._v(" representing a JavaScript "),a("code",[e._v("Number")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API is used to convert from the C "),a("code",[e._v("int32_t")]),e._v(" type to the JavaScript\n"),a("code",[e._v("Number")]),e._v(" type.")]),e._v(" "),a("p",[e._v("The JavaScript "),a("code",[e._v("Number")]),e._v(" type is described in\n"),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-ecmascript-language-types-number-type",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 6.1.6"),a("OutboundLink")],1),e._v(" of the ECMAScript Language Specification.")]),e._v(" "),a("h4",{attrs:{id:"napi-create-uint32"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-create-uint32"}},[e._v("#")]),e._v(" napi_create_uint32")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_uint32")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" uint32_t value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": Unsigned integer value to be represented in JavaScript.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": A "),a("code",[e._v("napi_value")]),e._v(" representing a JavaScript "),a("code",[e._v("Number")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API is used to convert from the C "),a("code",[e._v("uint32_t")]),e._v(" type to the JavaScript\n"),a("code",[e._v("Number")]),e._v(" type.")]),e._v(" "),a("p",[e._v("The JavaScript "),a("code",[e._v("Number")]),e._v(" type is described in\n"),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-ecmascript-language-types-number-type",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 6.1.6"),a("OutboundLink")],1),e._v(" of the ECMAScript Language Specification.")]),e._v(" "),a("h4",{attrs:{id:"napi-create-int64"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-create-int64"}},[e._v("#")]),e._v(" napi_create_int64")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_int64")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" int64_t value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": Integer value to be represented in JavaScript.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": A "),a("code",[e._v("napi_value")]),e._v(" representing a JavaScript "),a("code",[e._v("Number")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API is used to convert from the C "),a("code",[e._v("int64_t")]),e._v(" type to the JavaScript\n"),a("code",[e._v("Number")]),e._v(" type.")]),e._v(" "),a("p",[e._v("The JavaScript "),a("code",[e._v("Number")]),e._v(" type is described in "),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-ecmascript-language-types-number-type",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 6.1.6"),a("OutboundLink")],1),e._v("\nof the ECMAScript Language Specification. Note the complete range of "),a("code",[e._v("int64_t")]),e._v("\ncannot be represented with full precision in JavaScript. Integer values\noutside the range of "),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-number.min_safe_integer",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("Number.MIN_SAFE_INTEGER")]),a("OutboundLink")],1),e._v(" "),a("code",[e._v("-(2^53 - 1)")]),e._v(" -\n"),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-number.max_safe_integer",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("Number.MAX_SAFE_INTEGER")]),a("OutboundLink")],1),e._v(" "),a("code",[e._v("(2^53 - 1)")]),e._v(" will lose precision.")]),e._v(" "),a("h4",{attrs:{id:"napi-create-double"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-create-double"}},[e._v("#")]),e._v(" napi_create_double")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_double")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("double")]),e._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": Double-precision value to be represented in JavaScript.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": A "),a("code",[e._v("napi_value")]),e._v(" representing a JavaScript "),a("code",[e._v("Number")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API is used to convert from the C "),a("code",[e._v("double")]),e._v(" type to the JavaScript\n"),a("code",[e._v("Number")]),e._v(" type.")]),e._v(" "),a("p",[e._v("The JavaScript "),a("code",[e._v("Number")]),e._v(" type is described in\n"),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-ecmascript-language-types-number-type",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 6.1.6"),a("OutboundLink")],1),e._v(" of the ECMAScript Language Specification.")]),e._v(" "),a("h4",{attrs:{id:"napi-create-bigint-int64"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-create-bigint-int64"}},[e._v("#")]),e._v(" napi_create_bigint_int64")]),e._v(" "),a("blockquote",[a("p",[e._v("Stability: 1 - Experimental")])]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_bigint_int64")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                     int64_t value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                     napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": Integer value to be represented in JavaScript.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": A "),a("code",[e._v("napi_value")]),e._v(" representing a JavaScript "),a("code",[e._v("BigInt")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API converts the C "),a("code",[e._v("int64_t")]),e._v(" type to the JavaScript "),a("code",[e._v("BigInt")]),e._v(" type.")]),e._v(" "),a("h4",{attrs:{id:"napi-create-bigint-uint64"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-create-bigint-uint64"}},[e._v("#")]),e._v(" napi_create_bigint_uint64")]),e._v(" "),a("blockquote",[a("p",[e._v("Stability: 1 - Experimental")])]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_bigint_uint64")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                      uint64_t value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                      napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": Unsigned integer value to be represented in JavaScript.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": A "),a("code",[e._v("napi_value")]),e._v(" representing a JavaScript "),a("code",[e._v("BigInt")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API converts the C "),a("code",[e._v("uint64_t")]),e._v(" type to the JavaScript "),a("code",[e._v("BigInt")]),e._v(" type.")]),e._v(" "),a("h4",{attrs:{id:"napi-create-bigint-words"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-create-bigint-words"}},[e._v("#")]),e._v(" napi_create_bigint_words")]),e._v(" "),a("blockquote",[a("p",[e._v("Stability: 1 - Experimental")])]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_bigint_words")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                     "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("int")]),e._v(" sign_bit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                     size_t word_count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                     "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" uint64_t"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" words"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                     napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] sign_bit")]),e._v(": Determines if the resulting "),a("code",[e._v("BigInt")]),e._v(" will be positive or\nnegative.")]),e._v(" "),a("li",[a("code",[e._v("[in] word_count")]),e._v(": The length of the "),a("code",[e._v("words")]),e._v(" array.")]),e._v(" "),a("li",[a("code",[e._v("[in] words")]),e._v(": An array of "),a("code",[e._v("uint64_t")]),e._v(" little-endian 64-bit words.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": A "),a("code",[e._v("napi_value")]),e._v(" representing a JavaScript "),a("code",[e._v("BigInt")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API converts an array of unsigned 64-bit words into a single "),a("code",[e._v("BigInt")]),e._v("\nvalue.")]),e._v(" "),a("p",[e._v("The resulting "),a("code",[e._v("BigInt")]),e._v(" is calculated as: (–1)"),a("sup",[a("code",[e._v("sign_bit")])]),e._v(" ("),a("code",[e._v("words[0]")]),e._v("\n× (2"),a("sup",[e._v("64")]),e._v(")"),a("sup",[e._v("0")]),e._v(" + "),a("code",[e._v("words[1]")]),e._v(" × (2"),a("sup",[e._v("64")]),e._v(")"),a("sup",[e._v("1")]),e._v(" + …)")]),e._v(" "),a("h4",{attrs:{id:"napi-create-string-latin1"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-create-string-latin1"}},[e._v("#")]),e._v(" napi_create_string_latin1")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_string_latin1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("char")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" str"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                      size_t length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                      napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] str")]),e._v(": Character buffer representing an ISO-8859-1-encoded string.")]),e._v(" "),a("li",[a("code",[e._v("[in] length")]),e._v(": The length of the string in bytes, or\n"),a("code",[e._v("NAPI_AUTO_LENGTH")]),e._v(" if it is null-terminated.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": A "),a("code",[e._v("napi_value")]),e._v(" representing a JavaScript "),a("code",[e._v("String")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API creates a JavaScript "),a("code",[e._v("String")]),e._v(" object from an ISO-8859-1-encoded C\nstring. The native string is copied.")]),e._v(" "),a("p",[e._v("The JavaScript "),a("code",[e._v("String")]),e._v(" type is described in\n"),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-ecmascript-language-types-string-type",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 6.1.4"),a("OutboundLink")],1),e._v(" of the ECMAScript Language Specification.")]),e._v(" "),a("h4",{attrs:{id:"napi-create-string-utf16"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-create-string-utf16"}},[e._v("#")]),e._v(" napi_create_string_utf16")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_string_utf16")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                     "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" char16_t"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" str"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                     size_t length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                     napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] str")]),e._v(": Character buffer representing a UTF16-LE-encoded string.")]),e._v(" "),a("li",[a("code",[e._v("[in] length")]),e._v(": The length of the string in two-byte code units, or\n"),a("code",[e._v("NAPI_AUTO_LENGTH")]),e._v(" if it is null-terminated.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": A "),a("code",[e._v("napi_value")]),e._v(" representing a JavaScript "),a("code",[e._v("String")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API creates a JavaScript "),a("code",[e._v("String")]),e._v(" object from a UTF16-LE-encoded C string.\nThe native string is copied.")]),e._v(" "),a("p",[e._v("The JavaScript "),a("code",[e._v("String")]),e._v(" type is described in\n"),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-ecmascript-language-types-string-type",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 6.1.4"),a("OutboundLink")],1),e._v(" of the ECMAScript Language Specification.")]),e._v(" "),a("h4",{attrs:{id:"napi-create-string-utf8"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-create-string-utf8"}},[e._v("#")]),e._v(" napi_create_string_utf8")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_string_utf8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("char")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" str"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                    size_t length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                    napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] str")]),e._v(": Character buffer representing a UTF8-encoded string.")]),e._v(" "),a("li",[a("code",[e._v("[in] length")]),e._v(": The length of the string in bytes, or "),a("code",[e._v("NAPI_AUTO_LENGTH")]),e._v("\nif it is null-terminated.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": A "),a("code",[e._v("napi_value")]),e._v(" representing a JavaScript "),a("code",[e._v("String")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API creates a JavaScript "),a("code",[e._v("String")]),e._v(" object from a UTF8-encoded C string.\nThe native string is copied.")]),e._v(" "),a("p",[e._v("The JavaScript "),a("code",[e._v("String")]),e._v(" type is described in\n"),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-ecmascript-language-types-string-type",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 6.1.4"),a("OutboundLink")],1),e._v(" of the ECMAScript Language Specification.")]),e._v(" "),a("h3",{attrs:{id:"functions-to-convert-from-n-api-to-c-types"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#functions-to-convert-from-n-api-to-c-types"}},[e._v("#")]),e._v(" Functions to convert from N-API to C types")]),e._v(" "),a("h4",{attrs:{id:"napi-get-array-length"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-array-length"}},[e._v("#")]),e._v(" napi_get_array_length")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_array_length")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                  napi_value value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                  uint32_t"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing the JavaScript "),a("code",[e._v("Array")]),e._v(" whose length is\nbeing queried.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": "),a("code",[e._v("uint32")]),e._v(" representing length of the array.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API returns the length of an array.")]),e._v(" "),a("p",[a("code",[e._v("Array")]),e._v(" length is described in "),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-properties-of-array-instances-length",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 22.1.4.1"),a("OutboundLink")],1),e._v(" of the ECMAScript Language\nSpecification.")]),e._v(" "),a("h4",{attrs:{id:"napi-get-arraybuffer-info"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-arraybuffer-info"}},[e._v("#")]),e._v(" napi_get_arraybuffer_info")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_arraybuffer_info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                      napi_value arraybuffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                      size_t"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" byte_length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] arraybuffer")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing the "),a("code",[e._v("ArrayBuffer")]),e._v(" being queried.")]),e._v(" "),a("li",[a("code",[e._v("[out] data")]),e._v(": The underlying data buffer of the "),a("code",[e._v("ArrayBuffer")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[out] byte_length")]),e._v(": Length in bytes of the underlying data buffer.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API is used to retrieve the underlying data buffer of an "),a("code",[e._v("ArrayBuffer")]),e._v(" and\nits length.")]),e._v(" "),a("p",[a("em",[e._v("WARNING")]),e._v(": Use caution while using this API. The lifetime of the underlying data\nbuffer is managed by the "),a("code",[e._v("ArrayBuffer")]),e._v(" even after it's returned. A\npossible safe way to use this API is in conjunction with\n"),a("a",{attrs:{href:"#n_api_napi_create_reference"}},[a("code",[e._v("napi_create_reference")])]),e._v(", which can be used to guarantee control over the\nlifetime of the "),a("code",[e._v("ArrayBuffer")]),e._v(". It's also safe to use the returned data buffer\nwithin the same callback as long as there are no calls to other APIs that might\ntrigger a GC.")]),e._v(" "),a("h4",{attrs:{id:"napi-get-buffer-info"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-buffer-info"}},[e._v("#")]),e._v(" napi_get_buffer_info")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_buffer_info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                 napi_value value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                 size_t"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing the "),a("code",[e._v("node::Buffer")]),e._v(" being queried.")]),e._v(" "),a("li",[a("code",[e._v("[out] data")]),e._v(": The underlying data buffer of the "),a("code",[e._v("node::Buffer")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[out] length")]),e._v(": Length in bytes of the underlying data buffer.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API is used to retrieve the underlying data buffer of a "),a("code",[e._v("node::Buffer")]),e._v("\nand it's length.")]),e._v(" "),a("p",[a("em",[e._v("Warning")]),e._v(": Use caution while using this API since the underlying data buffer's\nlifetime is not guaranteed if it's managed by the VM.")]),e._v(" "),a("h4",{attrs:{id:"napi-get-prototype"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-prototype"}},[e._v("#")]),e._v(" napi_get_prototype")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_prototype")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                               napi_value object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                               napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] object")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing JavaScript "),a("code",[e._v("Object")]),e._v(" whose prototype\nto return. This returns the equivalent of "),a("code",[e._v("Object.getPrototypeOf")]),e._v(" (which is\nnot the same as the function's "),a("code",[e._v("prototype")]),e._v(" property).")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing prototype of the given object.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("h4",{attrs:{id:"napi-get-typedarray-info"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-typedarray-info"}},[e._v("#")]),e._v(" napi_get_typedarray_info")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_typedarray_info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                     napi_value typedarray"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                     napi_typedarray_type"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                     size_t"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                     "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                     napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" arraybuffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                     size_t"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" byte_offset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] typedarray")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing the "),a("code",[e._v("TypedArray")]),e._v(" whose\nproperties to query.")]),e._v(" "),a("li",[a("code",[e._v("[out] type")]),e._v(": Scalar datatype of the elements within the "),a("code",[e._v("TypedArray")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[out] length")]),e._v(": The number of elements in the "),a("code",[e._v("TypedArray")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[out] data")]),e._v(": The data buffer underlying the "),a("code",[e._v("TypedArray")]),e._v(" adjusted by\nthe "),a("code",[e._v("byte_offset")]),e._v(" value so that it points to the first element in the\n"),a("code",[e._v("TypedArray")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[out] arraybuffer")]),e._v(": The "),a("code",[e._v("ArrayBuffer")]),e._v(" underlying the "),a("code",[e._v("TypedArray")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[out] byte_offset")]),e._v(": The byte offset within the underlying native array\nat which the first element of the arrays is located. The value for the data\nparameter has already been adjusted so that data points to the first element\nin the array. Therefore, the first byte of the native array would be at\n"),a("code",[e._v("data - byte_offset")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API returns various properties of a typed array.")]),e._v(" "),a("p",[a("em",[e._v("Warning")]),e._v(": Use caution while using this API since the underlying data buffer\nis managed by the VM.")]),e._v(" "),a("h4",{attrs:{id:"napi-get-dataview-info"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-dataview-info"}},[e._v("#")]),e._v(" napi_get_dataview_info")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_dataview_info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                   napi_value dataview"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                   size_t"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" byte_length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                   napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" arraybuffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                   size_t"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" byte_offset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] dataview")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing the "),a("code",[e._v("DataView")]),e._v(" whose\nproperties to query.")]),e._v(" "),a("li",[a("code",[e._v("[out] byte_length")]),e._v(": "),a("code",[e._v("Number")]),e._v(" of bytes in the "),a("code",[e._v("DataView")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[out] data")]),e._v(": The data buffer underlying the "),a("code",[e._v("DataView")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[out] arraybuffer")]),e._v(": "),a("code",[e._v("ArrayBuffer")]),e._v(" underlying the "),a("code",[e._v("DataView")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[out] byte_offset")]),e._v(": The byte offset within the data buffer from which\nto start projecting the "),a("code",[e._v("DataView")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API returns various properties of a "),a("code",[e._v("DataView")]),e._v(".")]),e._v(" "),a("h4",{attrs:{id:"napi-get-date-value"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-date-value"}},[e._v("#")]),e._v(" napi_get_date_value")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_date_value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                napi_value value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("double")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing a JavaScript "),a("code",[e._v("Date")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": Time value as a "),a("code",[e._v("double")]),e._v(" represented as milliseconds\nsince midnight at the beginning of 01 January, 1970 UTC.")])]),e._v(" "),a("p",[e._v("This API does not observe leap seconds; they are ignored, as\nECMAScript aligns with POSIX time specification.")]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded. If a non-date "),a("code",[e._v("napi_value")]),e._v(" is passed\nin it returns "),a("code",[e._v("napi_date_expected")]),e._v(".")]),e._v(" "),a("p",[e._v("This API returns the C double primitive of time value for the given JavaScript\n"),a("code",[e._v("Date")]),e._v(".")]),e._v(" "),a("h4",{attrs:{id:"napi-get-value-bool"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-value-bool"}},[e._v("#")]),e._v(" napi_get_value_bool")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_value_bool")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_value value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" bool"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing JavaScript "),a("code",[e._v("Boolean")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": C boolean primitive equivalent of the given JavaScript\n"),a("code",[e._v("Boolean")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded. If a non-boolean "),a("code",[e._v("napi_value")]),e._v(" is\npassed in it returns "),a("code",[e._v("napi_boolean_expected")]),e._v(".")]),e._v(" "),a("p",[e._v("This API returns the C boolean primitive equivalent of the given JavaScript\n"),a("code",[e._v("Boolean")]),e._v(".")]),e._v(" "),a("h4",{attrs:{id:"napi-get-value-double"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-value-double"}},[e._v("#")]),e._v(" napi_get_value_double")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_value_double")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                  napi_value value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("double")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing JavaScript "),a("code",[e._v("Number")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": C double primitive equivalent of the given JavaScript\n"),a("code",[e._v("Number")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded. If a non-number "),a("code",[e._v("napi_value")]),e._v(" is passed\nin it returns "),a("code",[e._v("napi_number_expected")]),e._v(".")]),e._v(" "),a("p",[e._v("This API returns the C double primitive equivalent of the given JavaScript\n"),a("code",[e._v("Number")]),e._v(".")]),e._v(" "),a("h4",{attrs:{id:"napi-get-value-bigint-int64"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-value-bigint-int64"}},[e._v("#")]),e._v(" napi_get_value_bigint_int64")]),e._v(" "),a("blockquote",[a("p",[e._v("Stability: 1 - Experimental")])]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_value_bigint_int64")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                        napi_value value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                        int64_t"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                        bool"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" lossless"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing JavaScript "),a("code",[e._v("BigInt")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": C "),a("code",[e._v("int64_t")]),e._v(" primitive equivalent of the given JavaScript\n"),a("code",[e._v("BigInt")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[out] lossless")]),e._v(": Indicates whether the "),a("code",[e._v("BigInt")]),e._v(" value was converted\nlosslessly.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded. If a non-"),a("code",[e._v("BigInt")]),e._v(" is passed in it\nreturns "),a("code",[e._v("napi_bigint_expected")]),e._v(".")]),e._v(" "),a("p",[e._v("This API returns the C "),a("code",[e._v("int64_t")]),e._v(" primitive equivalent of the given JavaScript\n"),a("code",[e._v("BigInt")]),e._v(". If needed it will truncate the value, setting "),a("code",[e._v("lossless")]),e._v(" to "),a("code",[e._v("false")]),e._v(".")]),e._v(" "),a("h4",{attrs:{id:"napi-get-value-bigint-uint64"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-value-bigint-uint64"}},[e._v("#")]),e._v(" napi_get_value_bigint_uint64")]),e._v(" "),a("blockquote",[a("p",[e._v("Stability: 1 - Experimental")])]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_value_bigint_uint64")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                        napi_value value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                        uint64_t"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                        bool"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" lossless"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing JavaScript "),a("code",[e._v("BigInt")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": C "),a("code",[e._v("uint64_t")]),e._v(" primitive equivalent of the given JavaScript\n"),a("code",[e._v("BigInt")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[out] lossless")]),e._v(": Indicates whether the "),a("code",[e._v("BigInt")]),e._v(" value was converted\nlosslessly.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded. If a non-"),a("code",[e._v("BigInt")]),e._v(" is passed in it\nreturns "),a("code",[e._v("napi_bigint_expected")]),e._v(".")]),e._v(" "),a("p",[e._v("This API returns the C "),a("code",[e._v("uint64_t")]),e._v(" primitive equivalent of the given JavaScript\n"),a("code",[e._v("BigInt")]),e._v(". If needed it will truncate the value, setting "),a("code",[e._v("lossless")]),e._v(" to "),a("code",[e._v("false")]),e._v(".")]),e._v(" "),a("h4",{attrs:{id:"napi-get-value-bigint-words"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-value-bigint-words"}},[e._v("#")]),e._v(" napi_get_value_bigint_words")]),e._v(" "),a("blockquote",[a("p",[e._v("Stability: 1 - Experimental")])]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_value_bigint_words")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                        napi_value value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("int")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" sign_bit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                        size_t"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" word_count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                        uint64_t"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" words"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing JavaScript "),a("code",[e._v("BigInt")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[out] sign_bit")]),e._v(": Integer representing if the JavaScript "),a("code",[e._v("BigInt")]),e._v(" is positive\nor negative.")]),e._v(" "),a("li",[a("code",[e._v("[in/out] word_count")]),e._v(": Must be initialized to the length of the "),a("code",[e._v("words")]),e._v("\narray. Upon return, it will be set to the actual number of words that\nwould be needed to store this "),a("code",[e._v("BigInt")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[out] words")]),e._v(": Pointer to a pre-allocated 64-bit word array.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API converts a single "),a("code",[e._v("BigInt")]),e._v(" value into a sign bit, 64-bit little-endian\narray, and the number of elements in the array. "),a("code",[e._v("sign_bit")]),e._v(" and "),a("code",[e._v("words")]),e._v(" may be\nboth set to "),a("code",[e._v("NULL")]),e._v(", in order to get only "),a("code",[e._v("word_count")]),e._v(".")]),e._v(" "),a("h4",{attrs:{id:"napi-get-value-external"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-value-external"}},[e._v("#")]),e._v(" napi_get_value_external")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_value_external")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                    napi_value value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing JavaScript external value.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": Pointer to the data wrapped by the JavaScript external value.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded. If a non-external "),a("code",[e._v("napi_value")]),e._v(" is\npassed in it returns "),a("code",[e._v("napi_invalid_arg")]),e._v(".")]),e._v(" "),a("p",[e._v("This API retrieves the external data pointer that was previously passed to\n"),a("code",[e._v("napi_create_external()")]),e._v(".")]),e._v(" "),a("h4",{attrs:{id:"napi-get-value-int32"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-value-int32"}},[e._v("#")]),e._v(" napi_get_value_int32")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_value_int32")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                 napi_value value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                 int32_t"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing JavaScript "),a("code",[e._v("Number")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": C "),a("code",[e._v("int32")]),e._v(" primitive equivalent of the given JavaScript\n"),a("code",[e._v("Number")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded. If a non-number "),a("code",[e._v("napi_value")]),e._v("\nis passed in "),a("code",[e._v("napi_number_expected")]),e._v(".")]),e._v(" "),a("p",[e._v("This API returns the C "),a("code",[e._v("int32")]),e._v(" primitive equivalent\nof the given JavaScript "),a("code",[e._v("Number")]),e._v(".")]),e._v(" "),a("p",[e._v("If the number exceeds the range of the 32 bit integer, then the result is\ntruncated to the equivalent of the bottom 32 bits. This can result in a large\npositive number becoming a negative number if the value is > 2^31 -1.")]),e._v(" "),a("p",[e._v("Non-finite number values ("),a("code",[e._v("NaN")]),e._v(", "),a("code",[e._v("+Infinity")]),e._v(", or "),a("code",[e._v("-Infinity")]),e._v(") set the\nresult to zero.")]),e._v(" "),a("h4",{attrs:{id:"napi-get-value-int64"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-value-int64"}},[e._v("#")]),e._v(" napi_get_value_int64")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_value_int64")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                 napi_value value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                 int64_t"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing JavaScript "),a("code",[e._v("Number")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": C "),a("code",[e._v("int64")]),e._v(" primitive equivalent of the given JavaScript\n"),a("code",[e._v("Number")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded. If a non-number "),a("code",[e._v("napi_value")]),e._v("\nis passed in it returns "),a("code",[e._v("napi_number_expected")]),e._v(".")]),e._v(" "),a("p",[e._v("This API returns the C "),a("code",[e._v("int64")]),e._v(" primitive equivalent of the given JavaScript\n"),a("code",[e._v("Number")]),e._v(".")]),e._v(" "),a("p",[a("code",[e._v("Number")]),e._v(" values outside the range of "),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-number.min_safe_integer",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("Number.MIN_SAFE_INTEGER")]),a("OutboundLink")],1),e._v(" "),a("code",[e._v("-(2^53 - 1)")]),e._v(" - "),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-number.max_safe_integer",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("Number.MAX_SAFE_INTEGER")]),a("OutboundLink")],1),e._v(" "),a("code",[e._v("(2^53 - 1)")]),e._v(" will lose precision.")]),e._v(" "),a("p",[e._v("Non-finite number values ("),a("code",[e._v("NaN")]),e._v(", "),a("code",[e._v("+Infinity")]),e._v(", or "),a("code",[e._v("-Infinity")]),e._v(") set the\nresult to zero.")]),e._v(" "),a("h4",{attrs:{id:"napi-get-value-string-latin1"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-value-string-latin1"}},[e._v("#")]),e._v(" napi_get_value_string_latin1")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_value_string_latin1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                         napi_value value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                         "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("char")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" buf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                         size_t bufsize"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                         size_t"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing JavaScript string.")]),e._v(" "),a("li",[a("code",[e._v("[in] buf")]),e._v(": Buffer to write the ISO-8859-1-encoded string into. If NULL is\npassed in, the length of the string (in bytes) is returned.")]),e._v(" "),a("li",[a("code",[e._v("[in] bufsize")]),e._v(": Size of the destination buffer. When this value is\ninsufficient, the returned string will be truncated.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": Number of bytes copied into the buffer, excluding the null\nterminator.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded. If a non-"),a("code",[e._v("String")]),e._v(" "),a("code",[e._v("napi_value")]),e._v("\nis passed in it returns "),a("code",[e._v("napi_string_expected")]),e._v(".")]),e._v(" "),a("p",[e._v("This API returns the ISO-8859-1-encoded string corresponding the value passed\nin.")]),e._v(" "),a("h4",{attrs:{id:"napi-get-value-string-utf8"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-value-string-utf8"}},[e._v("#")]),e._v(" napi_get_value_string_utf8")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_value_string_utf8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                       napi_value value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                       "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("char")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" buf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                       size_t bufsize"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                       size_t"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing JavaScript string.")]),e._v(" "),a("li",[a("code",[e._v("[in] buf")]),e._v(": Buffer to write the UTF8-encoded string into. If NULL is passed\nin, the length of the string (in bytes) is returned.")]),e._v(" "),a("li",[a("code",[e._v("[in] bufsize")]),e._v(": Size of the destination buffer. When this value is\ninsufficient, the returned string will be truncated.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": Number of bytes copied into the buffer, excluding the null\nterminator.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded. If a non-"),a("code",[e._v("String")]),e._v(" "),a("code",[e._v("napi_value")]),e._v("\nis passed in it returns "),a("code",[e._v("napi_string_expected")]),e._v(".")]),e._v(" "),a("p",[e._v("This API returns the UTF8-encoded string corresponding the value passed in.")]),e._v(" "),a("h4",{attrs:{id:"napi-get-value-string-utf16"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-value-string-utf16"}},[e._v("#")]),e._v(" napi_get_value_string_utf16")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_value_string_utf16")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                        napi_value value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                        char16_t"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" buf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                        size_t bufsize"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                        size_t"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing JavaScript string.")]),e._v(" "),a("li",[a("code",[e._v("[in] buf")]),e._v(": Buffer to write the UTF16-LE-encoded string into. If NULL is\npassed in, the length of the string (in 2-byte code units) is returned.")]),e._v(" "),a("li",[a("code",[e._v("[in] bufsize")]),e._v(": Size of the destination buffer. When this value is\ninsufficient, the returned string will be truncated.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": Number of 2-byte code units copied into the buffer, excluding\nthe null terminator.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded. If a non-"),a("code",[e._v("String")]),e._v(" "),a("code",[e._v("napi_value")]),e._v("\nis passed in it returns "),a("code",[e._v("napi_string_expected")]),e._v(".")]),e._v(" "),a("p",[e._v("This API returns the UTF16-encoded string corresponding the value passed in.")]),e._v(" "),a("h4",{attrs:{id:"napi-get-value-uint32"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-value-uint32"}},[e._v("#")]),e._v(" napi_get_value_uint32")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_value_uint32")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                  napi_value value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                  uint32_t"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing JavaScript "),a("code",[e._v("Number")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": C primitive equivalent of the given "),a("code",[e._v("napi_value")]),e._v(" as a\n"),a("code",[e._v("uint32_t")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded. If a non-number "),a("code",[e._v("napi_value")]),e._v("\nis passed in it returns "),a("code",[e._v("napi_number_expected")]),e._v(".")]),e._v(" "),a("p",[e._v("This API returns the C primitive equivalent of the given "),a("code",[e._v("napi_value")]),e._v(" as a\n"),a("code",[e._v("uint32_t")]),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"functions-to-get-global-instances"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#functions-to-get-global-instances"}},[e._v("#")]),e._v(" Functions to get global instances")]),e._v(" "),a("h4",{attrs:{id:"napi-get-boolean"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-boolean"}},[e._v("#")]),e._v(" napi_get_boolean")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_boolean")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" bool value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": The value of the boolean to retrieve.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing JavaScript "),a("code",[e._v("Boolean")]),e._v(" singleton to\nretrieve.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API is used to return the JavaScript singleton object that is used to\nrepresent the given boolean value.")]),e._v(" "),a("h4",{attrs:{id:"napi-get-global"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-global"}},[e._v("#")]),e._v(" napi_get_global")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_global")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing JavaScript "),a("code",[e._v("global")]),e._v(" object.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API returns the "),a("code",[e._v("global")]),e._v(" object.")]),e._v(" "),a("h4",{attrs:{id:"napi-get-null"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-null"}},[e._v("#")]),e._v(" napi_get_null")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing JavaScript "),a("code",[e._v("null")]),e._v(" object.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API returns the "),a("code",[e._v("null")]),e._v(" object.")]),e._v(" "),a("h4",{attrs:{id:"napi-get-undefined"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-undefined"}},[e._v("#")]),e._v(" napi_get_undefined")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_undefined")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing JavaScript Undefined value.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API returns the Undefined object.")]),e._v(" "),a("h2",{attrs:{id:"working-with-javascript-values-and-abstract-operations"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#working-with-javascript-values-and-abstract-operations"}},[e._v("#")]),e._v(" Working with JavaScript Values and Abstract Operations")]),e._v(" "),a("p",[e._v("N-API exposes a set of APIs to perform some abstract operations on JavaScript\nvalues. Some of these operations are documented under "),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-abstract-operations",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 7"),a("OutboundLink")],1),e._v("\nof the "),a("a",{attrs:{href:"https://tc39.github.io/ecma262/",target:"_blank",rel:"noopener noreferrer"}},[e._v("ECMAScript Language Specification"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("p",[e._v("These APIs support doing one of the following:")]),e._v(" "),a("ol",[a("li",[e._v("Coerce JavaScript values to specific JavaScript types (such as "),a("code",[e._v("Number")]),e._v(" or\n"),a("code",[e._v("String")]),e._v(").")]),e._v(" "),a("li",[e._v("Check the type of a JavaScript value.")]),e._v(" "),a("li",[e._v("Check for equality between two JavaScript values.")])]),e._v(" "),a("h3",{attrs:{id:"napi-coerce-to-bool"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-coerce-to-bool"}},[e._v("#")]),e._v(" napi_coerce_to_bool")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_coerce_to_bool")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                napi_value value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": The JavaScript value to coerce.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing the coerced JavaScript "),a("code",[e._v("Boolean")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API implements the abstract operation "),a("code",[e._v("ToBoolean()")]),e._v(" as defined in\n"),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-toboolean",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 7.1.2"),a("OutboundLink")],1),e._v(" of the ECMAScript Language Specification.\nThis API can be re-entrant if getters are defined on the passed-in "),a("code",[e._v("Object")]),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"napi-coerce-to-number"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-coerce-to-number"}},[e._v("#")]),e._v(" napi_coerce_to_number")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_coerce_to_number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                  napi_value value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                  napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": The JavaScript value to coerce.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing the coerced JavaScript "),a("code",[e._v("Number")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API implements the abstract operation "),a("code",[e._v("ToNumber()")]),e._v(" as defined in\n"),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-tonumber",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 7.1.3"),a("OutboundLink")],1),e._v(" of the ECMAScript Language Specification.\nThis API can be re-entrant if getters are defined on the passed-in "),a("code",[e._v("Object")]),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"napi-coerce-to-object"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-coerce-to-object"}},[e._v("#")]),e._v(" napi_coerce_to_object")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_coerce_to_object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                  napi_value value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                  napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": The JavaScript value to coerce.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing the coerced JavaScript "),a("code",[e._v("Object")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API implements the abstract operation "),a("code",[e._v("ToObject()")]),e._v(" as defined in\n"),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-toobject",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 7.1.13"),a("OutboundLink")],1),e._v(" of the ECMAScript Language Specification.\nThis API can be re-entrant if getters are defined on the passed-in "),a("code",[e._v("Object")]),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"napi-coerce-to-string"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-coerce-to-string"}},[e._v("#")]),e._v(" napi_coerce_to_string")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_coerce_to_string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                  napi_value value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                  napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": The JavaScript value to coerce.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing the coerced JavaScript "),a("code",[e._v("String")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API implements the abstract operation "),a("code",[e._v("ToString()")]),e._v(" as defined in\n"),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-toobject",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 7.1.13"),a("OutboundLink")],1),e._v(" of the ECMAScript Language Specification.\nThis API can be re-entrant if getters are defined on the passed-in "),a("code",[e._v("Object")]),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"napi-typeof"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-typeof"}},[e._v("#")]),e._v(" napi_typeof")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_typeof")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_value value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_valuetype"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": The JavaScript value whose type to query.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": The type of the JavaScript value.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("napi_invalid_arg")]),e._v(" if the type of "),a("code",[e._v("value")]),e._v(" is not a known ECMAScript type and\n"),a("code",[e._v("value")]),e._v(" is not an External value.")])]),e._v(" "),a("p",[e._v("This API represents behavior similar to invoking the "),a("code",[e._v("typeof")]),e._v(" Operator on\nthe object as defined in "),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-typeof-operator",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 12.5.5"),a("OutboundLink")],1),e._v(" of the ECMAScript Language\nSpecification. However, it has support for detecting an External value.\nIf "),a("code",[e._v("value")]),e._v(" has a type that is invalid, an error is returned.")]),e._v(" "),a("h3",{attrs:{id:"napi-instanceof"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-instanceof"}},[e._v("#")]),e._v(" napi_instanceof")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_instanceof")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                            napi_value object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                            napi_value constructor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                            bool"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] object")]),e._v(": The JavaScript value to check.")]),e._v(" "),a("li",[a("code",[e._v("[in] constructor")]),e._v(": The JavaScript function object of the constructor\nfunction to check against.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": Boolean that is set to true if "),a("code",[e._v("object instanceof constructor")]),e._v("\nis true.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API represents invoking the "),a("code",[e._v("instanceof")]),e._v(" Operator on the object as\ndefined in "),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-instanceofoperator",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 12.10.4"),a("OutboundLink")],1),e._v(" of the ECMAScript Language Specification.")]),e._v(" "),a("h3",{attrs:{id:"napi-is-array"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-is-array"}},[e._v("#")]),e._v(" napi_is_array")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_is_array")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_value value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" bool"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": The JavaScript value to check.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": Whether the given object is an array.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API represents invoking the "),a("code",[e._v("IsArray")]),e._v(" operation on the object\nas defined in "),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-isarray",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 7.2.2"),a("OutboundLink")],1),e._v(" of the ECMAScript Language Specification.")]),e._v(" "),a("h3",{attrs:{id:"napi-is-arraybuffer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-is-arraybuffer"}},[e._v("#")]),e._v(" napi_is_arraybuffer")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_is_arraybuffer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_value value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" bool"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": The JavaScript value to check.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": Whether the given object is an "),a("code",[e._v("ArrayBuffer")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API checks if the "),a("code",[e._v("Object")]),e._v(" passed in is an array buffer.")]),e._v(" "),a("h3",{attrs:{id:"napi-is-buffer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-is-buffer"}},[e._v("#")]),e._v(" napi_is_buffer")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_is_buffer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_value value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" bool"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": The JavaScript value to check.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": Whether the given "),a("code",[e._v("napi_value")]),e._v(" represents a "),a("code",[e._v("node::Buffer")]),e._v("\nobject.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API checks if the "),a("code",[e._v("Object")]),e._v(" passed in is a buffer.")]),e._v(" "),a("h3",{attrs:{id:"napi-is-date"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-is-date"}},[e._v("#")]),e._v(" napi_is_date")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_is_date")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_value value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" bool"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": The JavaScript value to check.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": Whether the given "),a("code",[e._v("napi_value")]),e._v(" represents a JavaScript "),a("code",[e._v("Date")]),e._v("\nobject.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API checks if the "),a("code",[e._v("Object")]),e._v(" passed in is a date.")]),e._v(" "),a("h3",{attrs:{id:"napi-is-error-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-is-error-2"}},[e._v("#")]),e._v(" napi_is_error")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_is_error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_value value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" bool"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": The JavaScript value to check.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": Whether the given "),a("code",[e._v("napi_value")]),e._v(" represents an "),a("code",[e._v("Error")]),e._v(" object.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API checks if the "),a("code",[e._v("Object")]),e._v(" passed in is an "),a("code",[e._v("Error")]),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"napi-is-typedarray"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-is-typedarray"}},[e._v("#")]),e._v(" napi_is_typedarray")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_is_typedarray")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_value value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" bool"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": The JavaScript value to check.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": Whether the given "),a("code",[e._v("napi_value")]),e._v(" represents a "),a("code",[e._v("TypedArray")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API checks if the "),a("code",[e._v("Object")]),e._v(" passed in is a typed array.")]),e._v(" "),a("h3",{attrs:{id:"napi-is-dataview"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-is-dataview"}},[e._v("#")]),e._v(" napi_is_dataview")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_is_dataview")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_value value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" bool"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": The JavaScript value to check.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": Whether the given "),a("code",[e._v("napi_value")]),e._v(" represents a "),a("code",[e._v("DataView")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API checks if the "),a("code",[e._v("Object")]),e._v(" passed in is a "),a("code",[e._v("DataView")]),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"napi-strict-equals"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-strict-equals"}},[e._v("#")]),e._v(" napi_strict_equals")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_strict_equals")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                               napi_value lhs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                               napi_value rhs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                               bool"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] lhs")]),e._v(": The JavaScript value to check.")]),e._v(" "),a("li",[a("code",[e._v("[in] rhs")]),e._v(": The JavaScript value to check against.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": Whether the two "),a("code",[e._v("napi_value")]),e._v(" objects are equal.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API represents the invocation of the Strict Equality algorithm as\ndefined in "),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-strict-equality-comparison",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 7.2.14"),a("OutboundLink")],1),e._v(" of the ECMAScript Language Specification.")]),e._v(" "),a("h3",{attrs:{id:"napi-detach-arraybuffer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-detach-arraybuffer"}},[e._v("#")]),e._v(" napi_detach_arraybuffer")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_detach_arraybuffer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                    napi_value arraybuffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] arraybuffer")]),e._v(": The JavaScript "),a("code",[e._v("ArrayBuffer")]),e._v(" to be detached.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded. If a non-detachable "),a("code",[e._v("ArrayBuffer")]),e._v(" is\npassed in it returns "),a("code",[e._v("napi_detachable_arraybuffer_expected")]),e._v(".")]),e._v(" "),a("p",[e._v("Generally, an "),a("code",[e._v("ArrayBuffer")]),e._v(" is non-detachable if it has been detached before.\nThe engine may impose additional conditions on whether an "),a("code",[e._v("ArrayBuffer")]),e._v(" is\ndetachable. For example, V8 requires that the "),a("code",[e._v("ArrayBuffer")]),e._v(" be external,\nthat is, created with "),a("a",{attrs:{href:"#n_api_napi_create_external_arraybuffer"}},[a("code",[e._v("napi_create_external_arraybuffer")])]),e._v(".")]),e._v(" "),a("p",[e._v("This API represents the invocation of the "),a("code",[e._v("ArrayBuffer")]),e._v(" detach operation as\ndefined in "),a("a",{attrs:{href:"https://tc39.es/ecma262/#sec-detacharraybuffer",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 24.1.1.3"),a("OutboundLink")],1),e._v(" of the ECMAScript Language Specification.")]),e._v(" "),a("h2",{attrs:{id:"working-with-javascript-properties"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#working-with-javascript-properties"}},[e._v("#")]),e._v(" Working with JavaScript Properties")]),e._v(" "),a("p",[e._v("N-API exposes a set of APIs to get and set properties on JavaScript\nobjects. Some of these types are documented under "),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-abstract-operations",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 7"),a("OutboundLink")],1),e._v(" of the\n"),a("a",{attrs:{href:"https://tc39.github.io/ecma262/",target:"_blank",rel:"noopener noreferrer"}},[e._v("ECMAScript Language Specification"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("p",[e._v("Properties in JavaScript are represented as a tuple of a key and a value.\nFundamentally, all property keys in N-API can be represented in one of the\nfollowing forms:")]),e._v(" "),a("ul",[a("li",[e._v("Named: a simple UTF8-encoded string")]),e._v(" "),a("li",[e._v("Integer-Indexed: an index value represented by "),a("code",[e._v("uint32_t")])]),e._v(" "),a("li",[e._v("JavaScript value: these are represented in N-API by "),a("code",[e._v("napi_value")]),e._v(". This can\nbe a "),a("code",[e._v("napi_value")]),e._v(" representing a "),a("code",[e._v("String")]),e._v(", "),a("code",[e._v("Number")]),e._v(", or "),a("code",[e._v("Symbol")]),e._v(".")])]),e._v(" "),a("p",[e._v("N-API values are represented by the type "),a("code",[e._v("napi_value")]),e._v(".\nAny N-API call that requires a JavaScript value takes in a "),a("code",[e._v("napi_value")]),e._v(".\nHowever, it's the caller's responsibility to make sure that the\n"),a("code",[e._v("napi_value")]),e._v(" in question is of the JavaScript type expected by the API.")]),e._v(" "),a("p",[e._v("The APIs documented in this section provide a simple interface to\nget and set properties on arbitrary JavaScript objects represented by\n"),a("code",[e._v("napi_value")]),e._v(".")]),e._v(" "),a("p",[e._v("For instance, consider the following JavaScript code snippet:")]),e._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" obj "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\nobj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("myProp "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("123")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("The equivalent can be done using N-API values with the following snippet:")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" napi_generic_failure"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// const obj = {}")]),e._v("\nnapi_value obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\nstatus "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Create a napi_value for 123")]),e._v("\nstatus "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_int32")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("123")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// obj.myProp = 123")]),e._v("\nstatus "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_set_named_property")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"myProp"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("Indexed properties can be set in a similar manner. Consider the following\nJavaScript snippet:")]),e._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" arr "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\narr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("123")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'hello'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("The equivalent can be done using N-API values with the following snippet:")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" napi_generic_failure"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// const arr = [];")]),e._v("\nnapi_value arr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\nstatus "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_array")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("arr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Create a napi_value for 'hello'")]),e._v("\nstatus "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_string_utf8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"hello"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" NAPI_AUTO_LENGTH"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// arr[123] = 'hello';")]),e._v("\nstatus "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_set_element")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" arr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("123")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("Properties can be retrieved using the APIs described in this section.\nConsider the following JavaScript snippet:")]),e._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" arr "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" value "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" arr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("123")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("The following is the approximate equivalent of the N-API counterpart:")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" napi_generic_failure"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// const arr = []")]),e._v("\nnapi_value arr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\nstatus "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_array")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("arr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// const value = arr[123]")]),e._v("\nstatus "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_element")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" arr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("123")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("Finally, multiple properties can also be defined on an object for performance\nreasons. Consider the following JavaScript:")]),e._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" obj "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\nObject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("defineProperties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'foo'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("123")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" writable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" configurable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" enumerable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'bar'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("456")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" writable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" configurable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" enumerable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("The following is the approximate equivalent of the N-API counterpart:")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" napi_status_generic_failure"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// const obj = {};")]),e._v("\nnapi_value obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\nstatus "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Create napi_values for 123 and 456")]),e._v("\nnapi_value fooValue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" barValue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\nstatus "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_int32")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("123")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("fooValue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\nstatus "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_int32")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("456")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("barValue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Set the properties")]),e._v("\nnapi_property_descriptor descriptors"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"foo"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" fooValue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_default"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"bar"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" barValue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_default"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\nstatus "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_define_properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("sizeof")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("descriptors"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("/")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("sizeof")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("descriptors"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                descriptors"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("h3",{attrs:{id:"structures"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#structures"}},[e._v("#")]),e._v(" Structures")]),e._v(" "),a("h4",{attrs:{id:"napi-property-attributes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-property-attributes"}},[e._v("#")]),e._v(" napi_property_attributes")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("typedef")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("enum")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  napi_default "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_writable "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<<")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_enumerable "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<<")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  napi_configurable "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<<")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Used with napi_define_class to distinguish static properties")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// from instance properties. Ignored by napi_define_properties.")]),e._v("\n  napi_static "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<<")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" napi_property_attributes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[a("code",[e._v("napi_property_attributes")]),e._v(" are flags used to control the behavior of properties\nset on a JavaScript object. Other than "),a("code",[e._v("napi_static")]),e._v(" they correspond to the\nattributes listed in "),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#table-2",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 6.1.7.1"),a("OutboundLink")],1),e._v("\nof the "),a("a",{attrs:{href:"https://tc39.github.io/ecma262/",target:"_blank",rel:"noopener noreferrer"}},[e._v("ECMAScript Language Specification"),a("OutboundLink")],1),e._v(".\nThey can be one or more of the following bitflags:")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("napi_default")]),e._v(": No explicit attributes are set on the property. By default, a\nproperty is read only, not enumerable and not configurable.")]),e._v(" "),a("li",[a("code",[e._v("napi_writable")]),e._v(": The property is writable.")]),e._v(" "),a("li",[a("code",[e._v("napi_enumerable")]),e._v(": The property is enumerable.")]),e._v(" "),a("li",[a("code",[e._v("napi_configurable")]),e._v(": The property is configurable as defined in\n"),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#table-2",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 6.1.7.1"),a("OutboundLink")],1),e._v(" of the "),a("a",{attrs:{href:"https://tc39.github.io/ecma262/",target:"_blank",rel:"noopener noreferrer"}},[e._v("ECMAScript Language Specification"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("napi_static")]),e._v(": The property will be defined as a static property on a class as\nopposed to an instance property, which is the default. This is used only by\n"),a("a",{attrs:{href:"#n_api_napi_define_class"}},[a("code",[e._v("napi_define_class")])]),e._v(". It is ignored by "),a("code",[e._v("napi_define_properties")]),e._v(".")])]),e._v(" "),a("h4",{attrs:{id:"napi-property-descriptor"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-property-descriptor"}},[e._v("#")]),e._v(" napi_property_descriptor")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("typedef")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("struct")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// One of utf8name or name should be NULL.")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("char")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" utf8name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  napi_value name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n  napi_callback method"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  napi_callback getter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  napi_callback setter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  napi_value value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n  napi_property_attributes attributes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" napi_property_descriptor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("utf8name")]),e._v(": Optional "),a("code",[e._v("String")]),e._v(" describing the key for the property,\nencoded as UTF8. One of "),a("code",[e._v("utf8name")]),e._v(" or "),a("code",[e._v("name")]),e._v(" must be provided for the\nproperty.")]),e._v(" "),a("li",[a("code",[e._v("name")]),e._v(": Optional "),a("code",[e._v("napi_value")]),e._v(" that points to a JavaScript string or symbol\nto be used as the key for the property. One of "),a("code",[e._v("utf8name")]),e._v(" or "),a("code",[e._v("name")]),e._v(" must\nbe provided for the property.")]),e._v(" "),a("li",[a("code",[e._v("value")]),e._v(": The value that's retrieved by a get access of the property if the\nproperty is a data property. If this is passed in, set "),a("code",[e._v("getter")]),e._v(", "),a("code",[e._v("setter")]),e._v(",\n"),a("code",[e._v("method")]),e._v(" and "),a("code",[e._v("data")]),e._v(" to "),a("code",[e._v("NULL")]),e._v(" (since these members won't be used).")]),e._v(" "),a("li",[a("code",[e._v("getter")]),e._v(": A function to call when a get access of the property is performed.\nIf this is passed in, set "),a("code",[e._v("value")]),e._v(" and "),a("code",[e._v("method")]),e._v(" to "),a("code",[e._v("NULL")]),e._v(" (since these members\nwon't be used). The given function is called implicitly by the runtime when the\nproperty is accessed from JavaScript code (or if a get on the property is\nperformed using a N-API call).")]),e._v(" "),a("li",[a("code",[e._v("setter")]),e._v(": A function to call when a set access of the property is performed.\nIf this is passed in, set "),a("code",[e._v("value")]),e._v(" and "),a("code",[e._v("method")]),e._v(" to "),a("code",[e._v("NULL")]),e._v(" (since these members\nwon't be used). The given function is called implicitly by the runtime when the\nproperty is set from JavaScript code (or if a set on the property is\nperformed using a N-API call).")]),e._v(" "),a("li",[a("code",[e._v("method")]),e._v(": Set this to make the property descriptor object's "),a("code",[e._v("value")]),e._v("\nproperty to be a JavaScript function represented by "),a("code",[e._v("method")]),e._v(". If this is\npassed in, set "),a("code",[e._v("value")]),e._v(", "),a("code",[e._v("getter")]),e._v(" and "),a("code",[e._v("setter")]),e._v(" to "),a("code",[e._v("NULL")]),e._v(" (since these members\nwon't be used).")]),e._v(" "),a("li",[a("code",[e._v("attributes")]),e._v(": The attributes associated with the particular property.\nSee "),a("a",{attrs:{href:"#n_api_napi_property_attributes"}},[a("code",[e._v("napi_property_attributes")])]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("data")]),e._v(": The callback data passed into "),a("code",[e._v("method")]),e._v(", "),a("code",[e._v("getter")]),e._v(" and "),a("code",[e._v("setter")]),e._v(" if\nthis function is invoked.")])]),e._v(" "),a("h3",{attrs:{id:"functions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#functions"}},[e._v("#")]),e._v(" Functions")]),e._v(" "),a("h4",{attrs:{id:"napi-get-property-names"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-property-names"}},[e._v("#")]),e._v(" napi_get_property_names")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_property_names")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                    napi_value object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                    napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the N-API call is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] object")]),e._v(": The object from which to retrieve the properties.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": A "),a("code",[e._v("napi_value")]),e._v(" representing an array of JavaScript values\nthat represent the property names of the object. The API can be used to\niterate over "),a("code",[e._v("result")]),e._v(" using "),a("a",{attrs:{href:"#n_api_napi_get_array_length"}},[a("code",[e._v("napi_get_array_length")])]),e._v("\nand "),a("a",{attrs:{href:"#n_api_napi_get_element"}},[a("code",[e._v("napi_get_element")])]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API returns the names of the enumerable properties of "),a("code",[e._v("object")]),e._v(" as an array\nof strings. The properties of "),a("code",[e._v("object")]),e._v(" whose key is a symbol will not be\nincluded.")]),e._v(" "),a("h4",{attrs:{id:"napi-set-property"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-set-property"}},[e._v("#")]),e._v(" napi_set_property")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_set_property")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                              napi_value object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                              napi_value key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                              napi_value value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the N-API call is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] object")]),e._v(": The object on which to set the property.")]),e._v(" "),a("li",[a("code",[e._v("[in] key")]),e._v(": The name of the property to set.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": The property value.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API set a property on the "),a("code",[e._v("Object")]),e._v(" passed in.")]),e._v(" "),a("h4",{attrs:{id:"napi-get-property"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-property"}},[e._v("#")]),e._v(" napi_get_property")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_property")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                              napi_value object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                              napi_value key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                              napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the N-API call is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] object")]),e._v(": The object from which to retrieve the property.")]),e._v(" "),a("li",[a("code",[e._v("[in] key")]),e._v(": The name of the property to retrieve.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": The value of the property.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API gets the requested property from the "),a("code",[e._v("Object")]),e._v(" passed in.")]),e._v(" "),a("h4",{attrs:{id:"napi-has-property"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-has-property"}},[e._v("#")]),e._v(" napi_has_property")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_has_property")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                              napi_value object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                              napi_value key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                              bool"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the N-API call is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] object")]),e._v(": The object to query.")]),e._v(" "),a("li",[a("code",[e._v("[in] key")]),e._v(": The name of the property whose existence to check.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": Whether the property exists on the object or not.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API checks if the "),a("code",[e._v("Object")]),e._v(" passed in has the named property.")]),e._v(" "),a("h4",{attrs:{id:"napi-delete-property"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-delete-property"}},[e._v("#")]),e._v(" napi_delete_property")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_delete_property")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                 napi_value object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                 napi_value key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                 bool"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the N-API call is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] object")]),e._v(": The object to query.")]),e._v(" "),a("li",[a("code",[e._v("[in] key")]),e._v(": The name of the property to delete.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": Whether the property deletion succeeded or not. "),a("code",[e._v("result")]),e._v(" can\noptionally be ignored by passing "),a("code",[e._v("NULL")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API attempts to delete the "),a("code",[e._v("key")]),e._v(" own property from "),a("code",[e._v("object")]),e._v(".")]),e._v(" "),a("h4",{attrs:{id:"napi-has-own-property"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-has-own-property"}},[e._v("#")]),e._v(" napi_has_own_property")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_has_own_property")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                  napi_value object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                  napi_value key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                  bool"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the N-API call is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] object")]),e._v(": The object to query.")]),e._v(" "),a("li",[a("code",[e._v("[in] key")]),e._v(": The name of the own property whose existence to check.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": Whether the own property exists on the object or not.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API checks if the "),a("code",[e._v("Object")]),e._v(" passed in has the named own property. "),a("code",[e._v("key")]),e._v(" must\nbe a string or a "),a("code",[e._v("Symbol")]),e._v(", or an error will be thrown. N-API will not perform\nany conversion between data types.")]),e._v(" "),a("h4",{attrs:{id:"napi-set-named-property"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-set-named-property"}},[e._v("#")]),e._v(" napi_set_named_property")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_set_named_property")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                    napi_value object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("char")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" utf8Name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                    napi_value value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the N-API call is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] object")]),e._v(": The object on which to set the property.")]),e._v(" "),a("li",[a("code",[e._v("[in] utf8Name")]),e._v(": The name of the property to set.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": The property value.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This method is equivalent to calling "),a("a",{attrs:{href:"#n_api_napi_set_property"}},[a("code",[e._v("napi_set_property")])]),e._v(" with a "),a("code",[e._v("napi_value")]),e._v("\ncreated from the string passed in as "),a("code",[e._v("utf8Name")]),e._v(".")]),e._v(" "),a("h4",{attrs:{id:"napi-get-named-property"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-named-property"}},[e._v("#")]),e._v(" napi_get_named_property")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_named_property")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                    napi_value object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("char")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" utf8Name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                    napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the N-API call is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] object")]),e._v(": The object from which to retrieve the property.")]),e._v(" "),a("li",[a("code",[e._v("[in] utf8Name")]),e._v(": The name of the property to get.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": The value of the property.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This method is equivalent to calling "),a("a",{attrs:{href:"#n_api_napi_get_property"}},[a("code",[e._v("napi_get_property")])]),e._v(" with a "),a("code",[e._v("napi_value")]),e._v("\ncreated from the string passed in as "),a("code",[e._v("utf8Name")]),e._v(".")]),e._v(" "),a("h4",{attrs:{id:"napi-has-named-property"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-has-named-property"}},[e._v("#")]),e._v(" napi_has_named_property")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_has_named_property")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                    napi_value object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("char")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" utf8Name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                    bool"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the N-API call is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] object")]),e._v(": The object to query.")]),e._v(" "),a("li",[a("code",[e._v("[in] utf8Name")]),e._v(": The name of the property whose existence to check.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": Whether the property exists on the object or not.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This method is equivalent to calling "),a("a",{attrs:{href:"#n_api_napi_has_property"}},[a("code",[e._v("napi_has_property")])]),e._v(" with a "),a("code",[e._v("napi_value")]),e._v("\ncreated from the string passed in as "),a("code",[e._v("utf8Name")]),e._v(".")]),e._v(" "),a("h4",{attrs:{id:"napi-set-element"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-set-element"}},[e._v("#")]),e._v(" napi_set_element")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_set_element")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                             napi_value object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                             uint32_t index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                             napi_value value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the N-API call is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] object")]),e._v(": The object from which to set the properties.")]),e._v(" "),a("li",[a("code",[e._v("[in] index")]),e._v(": The index of the property to set.")]),e._v(" "),a("li",[a("code",[e._v("[in] value")]),e._v(": The property value.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API sets and element on the "),a("code",[e._v("Object")]),e._v(" passed in.")]),e._v(" "),a("h4",{attrs:{id:"napi-get-element"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-element"}},[e._v("#")]),e._v(" napi_get_element")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_element")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                             napi_value object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                             uint32_t index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                             napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the N-API call is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] object")]),e._v(": The object from which to retrieve the property.")]),e._v(" "),a("li",[a("code",[e._v("[in] index")]),e._v(": The index of the property to get.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": The value of the property.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API gets the element at the requested index.")]),e._v(" "),a("h4",{attrs:{id:"napi-has-element"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-has-element"}},[e._v("#")]),e._v(" napi_has_element")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_has_element")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                             napi_value object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                             uint32_t index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                             bool"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the N-API call is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] object")]),e._v(": The object to query.")]),e._v(" "),a("li",[a("code",[e._v("[in] index")]),e._v(": The index of the property whose existence to check.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": Whether the property exists on the object or not.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API returns if the "),a("code",[e._v("Object")]),e._v(" passed in has an element at the\nrequested index.")]),e._v(" "),a("h4",{attrs:{id:"napi-delete-element"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-delete-element"}},[e._v("#")]),e._v(" napi_delete_element")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_delete_element")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                napi_value object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                uint32_t index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                bool"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the N-API call is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] object")]),e._v(": The object to query.")]),e._v(" "),a("li",[a("code",[e._v("[in] index")]),e._v(": The index of the property to delete.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": Whether the element deletion succeeded or not. "),a("code",[e._v("result")]),e._v(" can\noptionally be ignored by passing "),a("code",[e._v("NULL")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API attempts to delete the specified "),a("code",[e._v("index")]),e._v(" from "),a("code",[e._v("object")]),e._v(".")]),e._v(" "),a("h4",{attrs:{id:"napi-define-properties"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-define-properties"}},[e._v("#")]),e._v(" napi_define_properties")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_define_properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                   napi_value object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                   size_t property_count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" napi_property_descriptor"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" properties"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the N-API call is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] object")]),e._v(": The object from which to retrieve the properties.")]),e._v(" "),a("li",[a("code",[e._v("[in] property_count")]),e._v(": The number of elements in the "),a("code",[e._v("properties")]),e._v(" array.")]),e._v(" "),a("li",[a("code",[e._v("[in] properties")]),e._v(": The array of property descriptors.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This method allows the efficient definition of multiple properties on a given\nobject. The properties are defined using property descriptors (see\n"),a("a",{attrs:{href:"#n_api_napi_property_descriptor"}},[a("code",[e._v("napi_property_descriptor")])]),e._v("). Given an array of such property descriptors,\nthis API will set the properties on the object one at a time, as defined by\n"),a("code",[e._v("DefineOwnProperty()")]),e._v(" (described in "),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-ordinary-object-internal-methods-and-internal-slots-defineownproperty-p-desc",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 9.1.6"),a("OutboundLink")],1),e._v(" of the ECMA-262\nspecification).")]),e._v(" "),a("h2",{attrs:{id:"working-with-javascript-functions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#working-with-javascript-functions"}},[e._v("#")]),e._v(" Working with JavaScript Functions")]),e._v(" "),a("p",[e._v("N-API provides a set of APIs that allow JavaScript code to\ncall back into native code. N-API APIs that support calling back\ninto native code take in a callback functions represented by\nthe "),a("code",[e._v("napi_callback")]),e._v(" type. When the JavaScript VM calls back to\nnative code, the "),a("code",[e._v("napi_callback")]),e._v(" function provided is invoked. The APIs\ndocumented in this section allow the callback function to do the\nfollowing:")]),e._v(" "),a("ul",[a("li",[e._v("Get information about the context in which the callback was invoked.")]),e._v(" "),a("li",[e._v("Get the arguments passed into the callback.")]),e._v(" "),a("li",[e._v("Return a "),a("code",[e._v("napi_value")]),e._v(" back from the callback.")])]),e._v(" "),a("p",[e._v("Additionally, N-API provides a set of functions which allow calling\nJavaScript functions from native code. One can either call a function\nlike a regular JavaScript function call, or as a constructor\nfunction.")]),e._v(" "),a("p",[e._v("Any non-"),a("code",[e._v("NULL")]),e._v(" data which is passed to this API via the "),a("code",[e._v("data")]),e._v(" field of the\n"),a("code",[e._v("napi_property_descriptor")]),e._v(" items can be associated with "),a("code",[e._v("object")]),e._v(" and freed\nwhenever "),a("code",[e._v("object")]),e._v(" is garbage-collected by passing both "),a("code",[e._v("object")]),e._v(" and the data to\n"),a("a",{attrs:{href:"#n_api_napi_add_finalizer"}},[a("code",[e._v("napi_add_finalizer")])]),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"napi-call-function"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-call-function"}},[e._v("#")]),e._v(" napi_call_function")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_call_function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                               napi_value recv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                               napi_value func"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                               "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("int")]),e._v(" argc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                               "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" argv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                               napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] recv")]),e._v(": The "),a("code",[e._v("this")]),e._v(" object passed to the called function.")]),e._v(" "),a("li",[a("code",[e._v("[in] func")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing the JavaScript function\nto be invoked.")]),e._v(" "),a("li",[a("code",[e._v("[in] argc")]),e._v(": The count of elements in the "),a("code",[e._v("argv")]),e._v(" array.")]),e._v(" "),a("li",[a("code",[e._v("[in] argv")]),e._v(": Array of "),a("code",[e._v("napi_values")]),e._v(" representing JavaScript values passed\nin as arguments to the function.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing the JavaScript object returned.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This method allows a JavaScript function object to be called from a native\nadd-on. This is the primary mechanism of calling back "),a("em",[e._v("from")]),e._v(" the add-on's\nnative code "),a("em",[e._v("into")]),e._v(" JavaScript. For the special case of calling into JavaScript\nafter an async operation, see "),a("a",{attrs:{href:"#n_api_napi_make_callback"}},[a("code",[e._v("napi_make_callback")])]),e._v(".")]),e._v(" "),a("p",[e._v("A sample use case might look as follows. Consider the following JavaScript\nsnippet:")]),e._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("AddTwo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[e._v("num")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" num "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("+")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),a("p",[e._v("Then, the above function can be invoked from a native add-on using the\nfollowing code:")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v('// Get the function named "AddTwo" on the global object')]),e._v("\nnapi_value global"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" add_two"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" arg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\nnapi_status status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_global")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("global"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\nstatus "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_named_property")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" global"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"AddTwo"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("add_two"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// const arg = 1337")]),e._v("\nstatus "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_int32")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1337")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("arg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\nnapi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" argv "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("arg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\nsize_t argc "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// AddTwo(arg);")]),e._v("\nnapi_value return_val"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\nstatus "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_call_function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" global"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" add_two"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" argc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" argv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("return_val"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Convert the result back to a native type")]),e._v("\nint32_t result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\nstatus "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_value_int32")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" return_val"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("h3",{attrs:{id:"napi-create-function"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-create-function"}},[e._v("#")]),e._v(" napi_create_function")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("char")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" utf8name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                 size_t length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                 napi_callback cb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                 napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] utf8Name")]),e._v(": The name of the function encoded as UTF8. This is visible\nwithin JavaScript as the new function object's "),a("code",[e._v("name")]),e._v(" property.")]),e._v(" "),a("li",[a("code",[e._v("[in] length")]),e._v(": The length of the "),a("code",[e._v("utf8name")]),e._v(" in bytes, or\n"),a("code",[e._v("NAPI_AUTO_LENGTH")]),e._v(" if it is null-terminated.")]),e._v(" "),a("li",[a("code",[e._v("[in] cb")]),e._v(": The native function which should be called when this function\nobject is invoked.")]),e._v(" "),a("li",[a("code",[e._v("[in] data")]),e._v(": User-provided data context. This will be passed back into the\nfunction when invoked later.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing the JavaScript function object for\nthe newly created function.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API allows an add-on author to create a function object in native code.\nThis is the primary mechanism to allow calling "),a("em",[e._v("into")]),e._v(" the add-on's native code\n"),a("em",[e._v("from")]),e._v(" JavaScript.")]),e._v(" "),a("p",[e._v("The newly created function is not automatically visible from script after this\ncall. Instead, a property must be explicitly set on any object that is visible\nto JavaScript, in order for the function to be accessible from script.")]),e._v(" "),a("p",[e._v("In order to expose a function as part of the\nadd-on's module exports, set the newly created function on the exports\nobject. A sample module might look as follows:")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_value "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("SayHello")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_callback_info info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Hello\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\nnapi_value "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("Init")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_value exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  napi_status status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n  napi_value fn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" SayHello"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("fn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n  status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_set_named_property")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sayHello"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" fn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("NAPI_MODULE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("NODE_GYP_MODULE_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" Init"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("p",[e._v("Given the above code, the add-on can be used from JavaScript as follows:")]),e._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" myaddon "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'./addon'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\nmyaddon"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sayHello")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("The string passed to "),a("code",[e._v("require()")]),e._v(" is the name of the target in "),a("code",[e._v("binding.gyp")]),e._v("\nresponsible for creating the "),a("code",[e._v(".node")]),e._v(" file.")]),e._v(" "),a("p",[e._v("Any non-"),a("code",[e._v("NULL")]),e._v(" data which is passed to this API via the "),a("code",[e._v("data")]),e._v(" parameter can\nbe associated with the resulting JavaScript function (which is returned in the\n"),a("code",[e._v("result")]),e._v(" parameter) and freed whenever the function is garbage-collected by\npassing both the JavaScript function and the data to "),a("a",{attrs:{href:"#n_api_napi_add_finalizer"}},[a("code",[e._v("napi_add_finalizer")])]),e._v(".")]),e._v(" "),a("p",[e._v("JavaScript "),a("code",[e._v("Function")]),e._v("s are described in "),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-function-objects",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 19.2"),a("OutboundLink")],1),e._v(" of the ECMAScript\nLanguage Specification.")]),e._v(" "),a("h3",{attrs:{id:"napi-get-cb-info"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-cb-info"}},[e._v("#")]),e._v(" napi_get_cb_info")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_cb_info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                             napi_callback_info cbinfo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                             size_t"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" argc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                             napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" argv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                             napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" thisArg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                             "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] cbinfo")]),e._v(": The callback info passed into the callback function.")]),e._v(" "),a("li",[a("code",[e._v("[in-out] argc")]),e._v(": Specifies the size of the provided "),a("code",[e._v("argv")]),e._v(" array\nand receives the actual count of arguments.")]),e._v(" "),a("li",[a("code",[e._v("[out] argv")]),e._v(": Buffer to which the "),a("code",[e._v("napi_value")]),e._v(" representing the\narguments are copied. If there are more arguments than the provided\ncount, only the requested number of arguments are copied. If there are fewer\narguments provided than claimed, the rest of "),a("code",[e._v("argv")]),e._v(" is filled with "),a("code",[e._v("napi_value")]),e._v("\nvalues that represent "),a("code",[e._v("undefined")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[out] this")]),e._v(": Receives the JavaScript "),a("code",[e._v("this")]),e._v(" argument for the call.")]),e._v(" "),a("li",[a("code",[e._v("[out] data")]),e._v(": Receives the data pointer for the callback.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This method is used within a callback function to retrieve details about the\ncall like the arguments and the "),a("code",[e._v("this")]),e._v(" pointer from a given callback info.")]),e._v(" "),a("h3",{attrs:{id:"napi-get-new-target"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-new-target"}},[e._v("#")]),e._v(" napi_get_new_target")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_new_target")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                napi_callback_info cbinfo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] cbinfo")]),e._v(": The callback info passed into the callback function.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": The "),a("code",[e._v("new.target")]),e._v(" of the constructor call.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API returns the "),a("code",[e._v("new.target")]),e._v(" of the constructor call. If the current\ncallback is not a constructor call, the result is "),a("code",[e._v("NULL")]),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"napi-new-instance"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-new-instance"}},[e._v("#")]),e._v(" napi_new_instance")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_new_instance")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                              napi_value cons"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                              size_t argc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                              napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" argv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                              napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] cons")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing the JavaScript function\nto be invoked as a constructor.")]),e._v(" "),a("li",[a("code",[e._v("[in] argc")]),e._v(": The count of elements in the "),a("code",[e._v("argv")]),e._v(" array.")]),e._v(" "),a("li",[a("code",[e._v("[in] argv")]),e._v(": Array of JavaScript values as "),a("code",[e._v("napi_value")]),e._v("\nrepresenting the arguments to the constructor.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing the JavaScript object returned,\nwhich in this case is the constructed object.")])]),e._v(" "),a("p",[e._v("This method is used to instantiate a new JavaScript value using a given\n"),a("code",[e._v("napi_value")]),e._v(" that represents the constructor for the object. For example,\nconsider the following snippet:")]),e._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("MyObject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[e._v("param")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("param "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" param"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" arg "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'hello'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" value "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MyObject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("arg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("The following can be approximated in N-API using the following snippet:")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Get the constructor function MyObject")]),e._v("\nnapi_value global"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" constructor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" arg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\nnapi_status status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_global")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("global"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\nstatus "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_named_property")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" global"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"MyObject"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("constructor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v('// const arg = "hello"')]),e._v("\nstatus "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_string_utf8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"hello"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" NAPI_AUTO_LENGTH"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("arg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\nnapi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" argv "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("arg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\nsize_t argc "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// const value = new MyObject(arg)")]),e._v("\nstatus "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_new_instance")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" constructor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" argc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" argv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("h2",{attrs:{id:"object-wrap"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#object-wrap"}},[e._v("#")]),e._v(" Object Wrap")]),e._v(" "),a("p",[e._v('N-API offers a way to "wrap" C++ classes and instances so that the class\nconstructor and methods can be called from JavaScript.')]),e._v(" "),a("ol",[a("li",[e._v("The "),a("a",{attrs:{href:"#n_api_napi_define_class"}},[a("code",[e._v("napi_define_class")])]),e._v(" API defines a JavaScript class with constructor,\nstatic properties and methods, and instance properties and methods that\ncorrespond to the C++ class.")]),e._v(" "),a("li",[e._v("When JavaScript code invokes the constructor, the constructor callback\nuses "),a("a",{attrs:{href:"#n_api_napi_wrap"}},[a("code",[e._v("napi_wrap")])]),e._v(" to wrap a new C++ instance in a JavaScript object,\nthen returns the wrapper object.")]),e._v(" "),a("li",[e._v("When JavaScript code invokes a method or property accessor on the class,\nthe corresponding "),a("code",[e._v("napi_callback")]),e._v(" C++ function is invoked. For an instance\ncallback, "),a("a",{attrs:{href:"#n_api_napi_unwrap"}},[a("code",[e._v("napi_unwrap")])]),e._v(" obtains the C++ instance that is the target of\nthe call.")])]),e._v(" "),a("p",[e._v("For wrapped objects it may be difficult to distinguish between a function\ncalled on a class prototype and a function called on an instance of a class.\nA common pattern used to address this problem is to save a persistent\nreference to the class constructor for later "),a("code",[e._v("instanceof")]),e._v(" checks.")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_value MyClass_constructor "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\nstatus "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_reference_value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" MyClass"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("::")]),e._v("es_constructor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("MyClass_constructor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("assert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_ok "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("==")]),e._v(" status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\nbool is_instance "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" false"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\nstatus "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_instanceof")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" es_this"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" MyClass_constructor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("is_instance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("assert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_ok "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("==")]),e._v(" status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("is_instance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// napi_unwrap() ...")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("else")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// otherwise...")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),a("p",[e._v("The reference must be freed once it is no longer needed.")]),e._v(" "),a("h3",{attrs:{id:"napi-define-class"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-define-class"}},[e._v("#")]),e._v(" napi_define_class")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_define_class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("char")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" utf8name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                              size_t length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                              napi_callback constructor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                              size_t property_count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" napi_property_descriptor"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" properties"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                              napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] utf8name")]),e._v(": Name of the JavaScript constructor function; this is\nnot required to be the same as the C++ class name, though it is recommended\nfor clarity.")]),e._v(" "),a("li",[a("code",[e._v("[in] length")]),e._v(": The length of the "),a("code",[e._v("utf8name")]),e._v(" in bytes, or "),a("code",[e._v("NAPI_AUTO_LENGTH")]),e._v("\nif it is null-terminated.")]),e._v(" "),a("li",[a("code",[e._v("[in] constructor")]),e._v(": Callback function that handles constructing instances\nof the class. (This should be a static method on the class, not an actual\nC++ constructor function.)")]),e._v(" "),a("li",[a("code",[e._v("[in] data")]),e._v(": Optional data to be passed to the constructor callback as\nthe "),a("code",[e._v("data")]),e._v(" property of the callback info.")]),e._v(" "),a("li",[a("code",[e._v("[in] property_count")]),e._v(": Number of items in the "),a("code",[e._v("properties")]),e._v(" array argument.")]),e._v(" "),a("li",[a("code",[e._v("[in] properties")]),e._v(": Array of property descriptors describing static and\ninstance data properties, accessors, and methods on the class\nSee "),a("code",[e._v("napi_property_descriptor")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": A "),a("code",[e._v("napi_value")]),e._v(" representing the constructor function for\nthe class.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("Defines a JavaScript class that corresponds to a C++ class, including:")]),e._v(" "),a("ul",[a("li",[e._v("A JavaScript constructor function that has the class name and invokes the\nprovided C++ constructor callback.")]),e._v(" "),a("li",[e._v("Properties on the constructor function corresponding to "),a("em",[e._v("static")]),e._v(" data\nproperties, accessors, and methods of the C++ class (defined by\nproperty descriptors with the "),a("code",[e._v("napi_static")]),e._v(" attribute).")]),e._v(" "),a("li",[e._v("Properties on the constructor function's "),a("code",[e._v("prototype")]),e._v(" object corresponding to\n"),a("em",[e._v("non-static")]),e._v(" data properties, accessors, and methods of the C++ class\n(defined by property descriptors without the "),a("code",[e._v("napi_static")]),e._v(" attribute).")])]),e._v(" "),a("p",[e._v("The C++ constructor callback should be a static method on the class that calls\nthe actual class constructor, then wraps the new C++ instance in a JavaScript\nobject, and returns the wrapper object. See "),a("code",[e._v("napi_wrap()")]),e._v(" for details.")]),e._v(" "),a("p",[e._v("The JavaScript constructor function returned from "),a("a",{attrs:{href:"#n_api_napi_define_class"}},[a("code",[e._v("napi_define_class")])]),e._v(" is\noften saved and used later, to construct new instances of the class from native\ncode, and/or check whether provided values are instances of the class. In that\ncase, to prevent the function value from being garbage-collected, create a\npersistent reference to it using "),a("a",{attrs:{href:"#n_api_napi_create_reference"}},[a("code",[e._v("napi_create_reference")])]),e._v(" and ensure the\nreference count is kept >= 1.")]),e._v(" "),a("p",[e._v("Any non-"),a("code",[e._v("NULL")]),e._v(" data which is passed to this API via the "),a("code",[e._v("data")]),e._v(" parameter or via\nthe "),a("code",[e._v("data")]),e._v(" field of the "),a("code",[e._v("napi_property_descriptor")]),e._v(" array items can be associated\nwith the resulting JavaScript constructor (which is returned in the "),a("code",[e._v("result")]),e._v("\nparameter) and freed whenever the class is garbage-collected by passing both\nthe JavaScript function and the data to "),a("a",{attrs:{href:"#n_api_napi_add_finalizer"}},[a("code",[e._v("napi_add_finalizer")])]),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"napi-wrap"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-wrap"}},[e._v("#")]),e._v(" napi_wrap")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_wrap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                      napi_value js_object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" native_object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                      napi_finalize finalize_cb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" finalize_hint"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                      napi_ref"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] js_object")]),e._v(": The JavaScript object that will be the wrapper for the\nnative object.")]),e._v(" "),a("li",[a("code",[e._v("[in] native_object")]),e._v(": The native instance that will be wrapped in the\nJavaScript object.")]),e._v(" "),a("li",[a("code",[e._v("[in] finalize_cb")]),e._v(": Optional native callback that can be used to free the\nnative instance when the JavaScript object is ready for garbage-collection.")]),e._v(" "),a("li",[a("code",[e._v("[in] finalize_hint")]),e._v(": Optional contextual hint that is passed to the\nfinalize callback.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": Optional reference to the wrapped object.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("Wraps a native instance in a JavaScript object. The native instance can be\nretrieved later using "),a("code",[e._v("napi_unwrap()")]),e._v(".")]),e._v(" "),a("p",[e._v("When JavaScript code invokes a constructor for a class that was defined using\n"),a("code",[e._v("napi_define_class()")]),e._v(", the "),a("code",[e._v("napi_callback")]),e._v(" for the constructor is invoked.\nAfter constructing an instance of the native class, the callback must then call\n"),a("code",[e._v("napi_wrap()")]),e._v(" to wrap the newly constructed instance in the already-created\nJavaScript object that is the "),a("code",[e._v("this")]),e._v(" argument to the constructor callback.\n(That "),a("code",[e._v("this")]),e._v(" object was created from the constructor function's "),a("code",[e._v("prototype")]),e._v(",\nso it already has definitions of all the instance properties and methods.)")]),e._v(" "),a("p",[e._v("Typically when wrapping a class instance, a finalize callback should be\nprovided that simply deletes the native instance that is received as the "),a("code",[e._v("data")]),e._v("\nargument to the finalize callback.")]),e._v(" "),a("p",[e._v("The optional returned reference is initially a weak reference, meaning it\nhas a reference count of 0. Typically this reference count would be incremented\ntemporarily during async operations that require the instance to remain valid.")]),e._v(" "),a("p",[a("em",[e._v("Caution")]),e._v(": The optional returned reference (if obtained) should be deleted via\n"),a("a",{attrs:{href:"#n_api_napi_delete_reference"}},[a("code",[e._v("napi_delete_reference")])]),e._v(" ONLY in response to the finalize callback\ninvocation. If it is deleted before then, then the finalize callback may never\nbe invoked. Therefore, when obtaining a reference a finalize callback is also\nrequired in order to enable correct disposal of the reference.")]),e._v(" "),a("p",[e._v("Calling "),a("code",[e._v("napi_wrap()")]),e._v(" a second time on an object will return an error. To\nassociate another native instance with the object, use "),a("code",[e._v("napi_remove_wrap()")]),e._v("\nfirst.")]),e._v(" "),a("h3",{attrs:{id:"napi-unwrap"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-unwrap"}},[e._v("#")]),e._v(" napi_unwrap")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_unwrap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                        napi_value js_object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] js_object")]),e._v(": The object associated with the native instance.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": Pointer to the wrapped native instance.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("Retrieves a native instance that was previously wrapped in a JavaScript\nobject using "),a("code",[e._v("napi_wrap()")]),e._v(".")]),e._v(" "),a("p",[e._v("When JavaScript code invokes a method or property accessor on the class, the\ncorresponding "),a("code",[e._v("napi_callback")]),e._v(" is invoked. If the callback is for an instance\nmethod or accessor, then the "),a("code",[e._v("this")]),e._v(" argument to the callback is the wrapper\nobject; the wrapped C++ instance that is the target of the call can be obtained\nthen by calling "),a("code",[e._v("napi_unwrap()")]),e._v(" on the wrapper object.")]),e._v(" "),a("h3",{attrs:{id:"napi-remove-wrap"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-remove-wrap"}},[e._v("#")]),e._v(" napi_remove_wrap")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_remove_wrap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                             napi_value js_object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                             "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] js_object")]),e._v(": The object associated with the native instance.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": Pointer to the wrapped native instance.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("Retrieves a native instance that was previously wrapped in the JavaScript\nobject "),a("code",[e._v("js_object")]),e._v(" using "),a("code",[e._v("napi_wrap()")]),e._v(" and removes the wrapping. If a finalize\ncallback was associated with the wrapping, it will no longer be called when the\nJavaScript object becomes garbage-collected.")]),e._v(" "),a("h3",{attrs:{id:"napi-add-finalizer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-add-finalizer"}},[e._v("#")]),e._v(" napi_add_finalizer")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_add_finalizer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                               napi_value js_object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                               "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" native_object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                               napi_finalize finalize_cb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                               "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" finalize_hint"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                               napi_ref"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] js_object")]),e._v(": The JavaScript object to which the native data will be\nattached.")]),e._v(" "),a("li",[a("code",[e._v("[in] native_object")]),e._v(": The native data that will be attached to the JavaScript\nobject.")]),e._v(" "),a("li",[a("code",[e._v("[in] finalize_cb")]),e._v(": Native callback that will be used to free the\nnative data when the JavaScript object is ready for garbage-collection.")]),e._v(" "),a("li",[a("code",[e._v("[in] finalize_hint")]),e._v(": Optional contextual hint that is passed to the\nfinalize callback.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": Optional reference to the JavaScript object.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("Adds a "),a("code",[e._v("napi_finalize")]),e._v(" callback which will be called when the JavaScript object\nin "),a("code",[e._v("js_object")]),e._v(" is ready for garbage collection. This API is similar to\n"),a("code",[e._v("napi_wrap()")]),e._v(" except that:")]),e._v(" "),a("ul",[a("li",[e._v("the native data cannot be retrieved later using "),a("code",[e._v("napi_unwrap()")]),e._v(",")]),e._v(" "),a("li",[e._v("nor can it be removed later using "),a("code",[e._v("napi_remove_wrap()")]),e._v(", and")]),e._v(" "),a("li",[e._v("the API can be called multiple times with different data items in order to\nattach each of them to the JavaScript object, and")]),e._v(" "),a("li",[e._v("the object manipulated by the API can be used with "),a("code",[e._v("napi_wrap()")]),e._v(".")])]),e._v(" "),a("p",[a("em",[e._v("Caution")]),e._v(": The optional returned reference (if obtained) should be deleted via\n"),a("a",{attrs:{href:"#n_api_napi_delete_reference"}},[a("code",[e._v("napi_delete_reference")])]),e._v(" ONLY in response to the finalize callback\ninvocation. If it is deleted before then, then the finalize callback may never\nbe invoked. Therefore, when obtaining a reference a finalize callback is also\nrequired in order to enable correct disposal of the reference.")]),e._v(" "),a("h2",{attrs:{id:"simple-asynchronous-operations"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#simple-asynchronous-operations"}},[e._v("#")]),e._v(" Simple Asynchronous Operations")]),e._v(" "),a("p",[e._v("Addon modules often need to leverage async helpers from libuv as part of their\nimplementation. This allows them to schedule work to be executed asynchronously\nso that their methods can return in advance of the work being completed. This\nallows them to avoid blocking overall execution of the Node.js application.")]),e._v(" "),a("p",[e._v("N-API provides an ABI-stable interface for these\nsupporting functions which covers the most common asynchronous use cases.")]),e._v(" "),a("p",[e._v("N-API defines the "),a("code",[e._v("napi_work")]),e._v(" structure which is used to manage\nasynchronous workers. Instances are created/deleted with\n"),a("a",{attrs:{href:"#n_api_napi_create_async_work"}},[a("code",[e._v("napi_create_async_work")])]),e._v(" and "),a("a",{attrs:{href:"#n_api_napi_delete_async_work"}},[a("code",[e._v("napi_delete_async_work")])]),e._v(".")]),e._v(" "),a("p",[e._v("The "),a("code",[e._v("execute")]),e._v(" and "),a("code",[e._v("complete")]),e._v(" callbacks are functions that will be\ninvoked when the executor is ready to execute and when it completes its\ntask respectively.")]),e._v(" "),a("p",[e._v("The "),a("code",[e._v("execute")]),e._v(" function should avoid making any N-API calls\nthat could result in the execution of JavaScript or interaction with\nJavaScript objects. Most often, any code that needs to make N-API\ncalls should be made in "),a("code",[e._v("complete")]),e._v(" callback instead.\nAvoid using the "),a("code",[e._v("napi_env")]),e._v(" parameter in the execute callback as\nit will likely execute JavaScript.")]),e._v(" "),a("p",[e._v("These functions implement the following interfaces:")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("typedef")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v("napi_async_execute_callback"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("typedef")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v("napi_async_complete_callback"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                             napi_status status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                             "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("When these methods are invoked, the "),a("code",[e._v("data")]),e._v(" parameter passed will be the\naddon-provided "),a("code",[e._v("void*")]),e._v(" data that was passed into the\n"),a("code",[e._v("napi_create_async_work")]),e._v(" call.")]),e._v(" "),a("p",[e._v("Once created the async worker can be queued\nfor execution using the "),a("a",{attrs:{href:"#n_api_napi_queue_async_work"}},[a("code",[e._v("napi_queue_async_work")])]),e._v(" function:")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_queue_async_work")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                  napi_async_work work"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[a("a",{attrs:{href:"#n_api_napi_cancel_async_work"}},[a("code",[e._v("napi_cancel_async_work")])]),e._v(" can be used if the work needs\nto be cancelled before the work has started execution.")]),e._v(" "),a("p",[e._v("After calling "),a("a",{attrs:{href:"#n_api_napi_cancel_async_work"}},[a("code",[e._v("napi_cancel_async_work")])]),e._v(", the "),a("code",[e._v("complete")]),e._v(" callback\nwill be invoked with a status value of "),a("code",[e._v("napi_cancelled")]),e._v(".\nThe work should not be deleted before the "),a("code",[e._v("complete")]),e._v("\ncallback invocation, even when it was cancelled.")]),e._v(" "),a("h3",{attrs:{id:"napi-create-async-work"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-create-async-work"}},[e._v("#")]),e._v(" napi_create_async_work")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_async_work")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                   napi_value async_resource"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                   napi_value async_resource_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                   napi_async_execute_callback execute"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                   napi_async_complete_callback complete"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                   napi_async_work"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] async_resource")]),e._v(": An optional object associated with the async work\nthat will be passed to possible "),a("code",[e._v("async_hooks")]),e._v(" "),a("router-link",{attrs:{to:"/node/async_hooks.html#async_hooks_init_asyncid_type_triggerasyncid_resource"}},[a("code",[e._v("init")]),e._v(" hooks")]),e._v(".")],1),e._v(" "),a("li",[a("code",[e._v("[in] async_resource_name")]),e._v(": Identifier for the kind of resource that is\nbeing provided for diagnostic information exposed by the "),a("code",[e._v("async_hooks")]),e._v(" API.")]),e._v(" "),a("li",[a("code",[e._v("[in] execute")]),e._v(": The native function which should be called to execute\nthe logic asynchronously. The given function is called from a worker pool\nthread and can execute in parallel with the main event loop thread.")]),e._v(" "),a("li",[a("code",[e._v("[in] complete")]),e._v(": The native function which will be called when the\nasynchronous logic is completed or is cancelled. The given function is called\nfrom the main event loop thread.")]),e._v(" "),a("li",[a("code",[e._v("[in] data")]),e._v(": User-provided data context. This will be passed back into the\nexecute and complete functions.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": "),a("code",[e._v("napi_async_work*")]),e._v(" which is the handle to the newly created\nasync work.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API allocates a work object that is used to execute logic asynchronously.\nIt should be freed using "),a("a",{attrs:{href:"#n_api_napi_delete_async_work"}},[a("code",[e._v("napi_delete_async_work")])]),e._v(" once the work is no longer\nrequired.")]),e._v(" "),a("p",[a("code",[e._v("async_resource_name")]),e._v(" should be a null-terminated, UTF-8-encoded string.")]),e._v(" "),a("p",[e._v("The "),a("code",[e._v("async_resource_name")]),e._v(" identifier is provided by the user and should be\nrepresentative of the type of async work being performed. It is also recommended\nto apply namespacing to the identifier, e.g. by including the module name. See\nthe "),a("router-link",{attrs:{to:"/node/async_hooks.html#async_hooks_type"}},[a("code",[e._v("async_hooks")]),e._v(" documentation")]),e._v(" for more information.")],1),e._v(" "),a("h3",{attrs:{id:"napi-delete-async-work"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-delete-async-work"}},[e._v("#")]),e._v(" napi_delete_async_work")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_delete_async_work")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                   napi_async_work work"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] work")]),e._v(": The handle returned by the call to "),a("code",[e._v("napi_create_async_work")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API frees a previously allocated work object.")]),e._v(" "),a("p",[e._v("This API can be called even if there is a pending JavaScript exception.")]),e._v(" "),a("h3",{attrs:{id:"napi-queue-async-work"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-queue-async-work"}},[e._v("#")]),e._v(" napi_queue_async_work")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_queue_async_work")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                  napi_async_work work"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] work")]),e._v(": The handle returned by the call to "),a("code",[e._v("napi_create_async_work")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API requests that the previously allocated work be scheduled\nfor execution. Once it returns successfully, this API must not be called again\nwith the same "),a("code",[e._v("napi_async_work")]),e._v(" item or the result will be undefined.")]),e._v(" "),a("h3",{attrs:{id:"napi-cancel-async-work"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-cancel-async-work"}},[e._v("#")]),e._v(" napi_cancel_async_work")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_cancel_async_work")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                   napi_async_work work"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] work")]),e._v(": The handle returned by the call to "),a("code",[e._v("napi_create_async_work")]),e._v(".")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API cancels queued work if it has not yet\nbeen started. If it has already started executing, it cannot be\ncancelled and "),a("code",[e._v("napi_generic_failure")]),e._v(" will be returned. If successful,\nthe "),a("code",[e._v("complete")]),e._v(" callback will be invoked with a status value of\n"),a("code",[e._v("napi_cancelled")]),e._v(". The work should not be deleted before the "),a("code",[e._v("complete")]),e._v("\ncallback invocation, even if it has been successfully cancelled.")]),e._v(" "),a("p",[e._v("This API can be called even if there is a pending JavaScript exception.")]),e._v(" "),a("h2",{attrs:{id:"custom-asynchronous-operations"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#custom-asynchronous-operations"}},[e._v("#")]),e._v(" Custom Asynchronous Operations")]),e._v(" "),a("p",[e._v("The simple asynchronous work APIs above may not be appropriate for every\nscenario. When using any other asynchronous mechanism, the following APIs\nare necessary to ensure an asynchronous operation is properly tracked by\nthe runtime.")]),e._v(" "),a("h3",{attrs:{id:"napi-async-init"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-async-init"}},[e._v("#")]),e._v(" napi_async_init")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_async_init")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                            napi_value async_resource"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                            napi_value async_resource_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                            napi_async_context"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] async_resource")]),e._v(": An optional object associated with the async work\nthat will be passed to possible "),a("code",[e._v("async_hooks")]),e._v(" "),a("router-link",{attrs:{to:"/node/async_hooks.html#async_hooks_init_asyncid_type_triggerasyncid_resource"}},[a("code",[e._v("init")]),e._v(" hooks")]),e._v(".")],1),e._v(" "),a("li",[a("code",[e._v("[in] async_resource_name")]),e._v(": Identifier for the kind of resource\nthat is being provided for diagnostic information exposed by the\n"),a("code",[e._v("async_hooks")]),e._v(" API.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": The initialized async context.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("h3",{attrs:{id:"napi-async-destroy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-async-destroy"}},[e._v("#")]),e._v(" napi_async_destroy")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_async_destroy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                               napi_async_context async_context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] async_context")]),e._v(": The async context to be destroyed.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API can be called even if there is a pending JavaScript exception.")]),e._v(" "),a("h3",{attrs:{id:"napi-make-callback"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-make-callback"}},[e._v("#")]),e._v(" napi_make_callback")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_make_callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                               napi_async_context async_context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                               napi_value recv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                               napi_value func"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                               "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("int")]),e._v(" argc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                               "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" argv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                               napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] async_context")]),e._v(": Context for the async operation that is\ninvoking the callback. This should normally be a value previously\nobtained from "),a("a",{attrs:{href:"#n_api_napi_async_init"}},[a("code",[e._v("napi_async_init")])]),e._v(". However "),a("code",[e._v("NULL")]),e._v(" is also allowed,\nwhich indicates the current async context (if any) is to be used\nfor the callback.")]),e._v(" "),a("li",[a("code",[e._v("[in] recv")]),e._v(": The "),a("code",[e._v("this")]),e._v(" object passed to the called function.")]),e._v(" "),a("li",[a("code",[e._v("[in] func")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing the JavaScript function\nto be invoked.")]),e._v(" "),a("li",[a("code",[e._v("[in] argc")]),e._v(": The count of elements in the "),a("code",[e._v("argv")]),e._v(" array.")]),e._v(" "),a("li",[a("code",[e._v("[in] argv")]),e._v(": Array of JavaScript values as "),a("code",[e._v("napi_value")]),e._v("\nrepresenting the arguments to the function.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": "),a("code",[e._v("napi_value")]),e._v(" representing the JavaScript object returned.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This method allows a JavaScript function object to be called from a native\nadd-on. This API is similar to "),a("code",[e._v("napi_call_function")]),e._v(". However, it is used to call\n"),a("em",[e._v("from")]),e._v(" native code back "),a("em",[e._v("into")]),e._v(" JavaScript "),a("em",[e._v("after")]),e._v(" returning from an async\noperation (when there is no other script on the stack). It is a fairly simple\nwrapper around "),a("code",[e._v("node::MakeCallback")]),e._v(".")]),e._v(" "),a("p",[e._v("Note it is "),a("em",[e._v("not")]),e._v(" necessary to use "),a("code",[e._v("napi_make_callback")]),e._v(" from within a\n"),a("code",[e._v("napi_async_complete_callback")]),e._v("; in that situation the callback's async\ncontext has already been set up, so a direct call to "),a("code",[e._v("napi_call_function")]),e._v("\nis sufficient and appropriate. Use of the "),a("code",[e._v("napi_make_callback")]),e._v(" function\nmay be required when implementing custom async behavior that does not use\n"),a("code",[e._v("napi_create_async_work")]),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"napi-open-callback-scope"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-open-callback-scope"}},[e._v("#")]),e._v(" napi_open_callback_scope")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("NAPI_EXTERN napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_open_callback_scope")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                                 napi_value resource_object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                                 napi_async_context context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                                 napi_callback_scope"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] resource_object")]),e._v(": An object associated with the async work\nthat will be passed to possible "),a("code",[e._v("async_hooks")]),e._v(" "),a("router-link",{attrs:{to:"/node/async_hooks.html#async_hooks_init_asyncid_type_triggerasyncid_resource"}},[a("code",[e._v("init")]),e._v(" hooks")]),e._v(".")],1),e._v(" "),a("li",[a("code",[e._v("[in] context")]),e._v(": Context for the async operation that is\ninvoking the callback. This should be a value previously obtained\nfrom "),a("a",{attrs:{href:"#n_api_napi_async_init"}},[a("code",[e._v("napi_async_init")])]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": The newly created scope.")])]),e._v(" "),a("p",[e._v("There are cases (for example, resolving promises) where it is\nnecessary to have the equivalent of the scope associated with a callback\nin place when making certain N-API calls. If there is no other script on\nthe stack the "),a("a",{attrs:{href:"#n_api_napi_open_callback_scope"}},[a("code",[e._v("napi_open_callback_scope")])]),e._v(" and\n"),a("a",{attrs:{href:"#n_api_napi_close_callback_scope"}},[a("code",[e._v("napi_close_callback_scope")])]),e._v(" functions can be used to open/close\nthe required scope.")]),e._v(" "),a("h3",{attrs:{id:"napi-close-callback-scope"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-close-callback-scope"}},[e._v("#")]),e._v(" napi_close_callback_scope")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("NAPI_EXTERN napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_close_callback_scope")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                                  napi_callback_scope scope"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] scope")]),e._v(": The scope to be closed.")])]),e._v(" "),a("p",[e._v("This API can be called even if there is a pending JavaScript exception.")]),e._v(" "),a("h2",{attrs:{id:"version-management"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#version-management"}},[e._v("#")]),e._v(" Version Management")]),e._v(" "),a("h3",{attrs:{id:"napi-get-node-version"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-node-version"}},[e._v("#")]),e._v(" napi_get_node_version")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("typedef")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("struct")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  uint32_t major"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  uint32_t minor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  uint32_t patch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("char")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" release"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" napi_node_version"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\nnapi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_node_version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" napi_node_version"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" version"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[out] version")]),e._v(": A pointer to version information for Node.js itself.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This function fills the "),a("code",[e._v("version")]),e._v(" struct with the major, minor, and patch\nversion of Node.js that is currently running, and the "),a("code",[e._v("release")]),e._v(" field with the\nvalue of "),a("router-link",{attrs:{to:"/node/process.html#process_process_release"}},[a("code",[e._v("process.release.name")])]),e._v(".")],1),e._v(" "),a("p",[e._v("The returned buffer is statically allocated and does not need to be freed.")]),e._v(" "),a("h3",{attrs:{id:"napi-get-version"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-version"}},[e._v("#")]),e._v(" napi_get_version")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                             uint32_t"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": The highest version of N-API supported.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API returns the highest N-API version supported by the\nNode.js runtime. N-API is planned to be additive such that\nnewer releases of Node.js may support additional API functions.\nIn order to allow an addon to use a newer function when running with\nversions of Node.js that support it, while providing\nfallback behavior when running with Node.js versions that don't\nsupport it:")]),e._v(" "),a("ul",[a("li",[e._v("Call "),a("code",[e._v("napi_get_version()")]),e._v(" to determine if the API is available.")]),e._v(" "),a("li",[e._v("If available, dynamically load a pointer to the function using "),a("code",[e._v("uv_dlsym()")]),e._v(".")]),e._v(" "),a("li",[e._v("Use the dynamically loaded pointer to invoke the function.")]),e._v(" "),a("li",[e._v("If the function is not available, provide an alternate implementation\nthat does not use the function.")])]),e._v(" "),a("h2",{attrs:{id:"memory-management"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#memory-management"}},[e._v("#")]),e._v(" Memory Management")]),e._v(" "),a("h3",{attrs:{id:"napi-adjust-external-memory"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-adjust-external-memory"}},[e._v("#")]),e._v(" napi_adjust_external_memory")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("NAPI_EXTERN napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_adjust_external_memory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                                    int64_t change_in_bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                                    int64_t"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] change_in_bytes")]),e._v(": The change in externally allocated memory that is\nkept alive by JavaScript objects.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": The adjusted value")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This function gives V8 an indication of the amount of externally allocated\nmemory that is kept alive by JavaScript objects (i.e. a JavaScript object\nthat points to its own memory allocated by a native module). Registering\nexternally allocated memory will trigger global garbage collections more\noften than it would otherwise.")]),e._v(" "),a("h2",{attrs:{id:"promises"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#promises"}},[e._v("#")]),e._v(" Promises")]),e._v(" "),a("p",[e._v("N-API provides facilities for creating "),a("code",[e._v("Promise")]),e._v(" objects as described in\n"),a("a",{attrs:{href:"https://tc39.github.io/ecma262/#sec-promise-objects",target:"_blank",rel:"noopener noreferrer"}},[e._v("Section 25.4"),a("OutboundLink")],1),e._v(" of the ECMA specification. It implements promises as a pair of\nobjects. When a promise is created by "),a("code",[e._v("napi_create_promise()")]),e._v(', a "deferred"\nobject is created and returned alongside the '),a("code",[e._v("Promise")]),e._v(". The deferred object is\nbound to the created "),a("code",[e._v("Promise")]),e._v(" and is the only means to resolve or reject the\n"),a("code",[e._v("Promise")]),e._v(" using "),a("code",[e._v("napi_resolve_deferred()")]),e._v(" or "),a("code",[e._v("napi_reject_deferred()")]),e._v(". The\ndeferred object that is created by "),a("code",[e._v("napi_create_promise()")]),e._v(" is freed by\n"),a("code",[e._v("napi_resolve_deferred()")]),e._v(" or "),a("code",[e._v("napi_reject_deferred()")]),e._v(". The "),a("code",[e._v("Promise")]),e._v(" object may\nbe returned to JavaScript where it can be used in the usual fashion.")]),e._v(" "),a("p",[e._v("For example, to create a promise and pass it to an asynchronous worker:")]),e._v(" "),a("div",{staticClass:"language-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_deferred deferred"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\nnapi_value promise"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\nnapi_status status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Create the promise.")]),e._v("\nstatus "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_promise")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("deferred"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("promise"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Pass the deferred to a function that performs an asynchronous action.")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("do_something_asynchronous")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("deferred"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Return the promise to JS")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" promise"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("The above function "),a("code",[e._v("do_something_asynchronous()")]),e._v(" would perform its asynchronous\naction and then it would resolve or reject the deferred, thereby concluding the\npromise and freeing the deferred:")]),e._v(" "),a("div",{staticClass:"language-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_deferred deferred"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\nnapi_value undefined"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\nnapi_status status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Create a value with which to conclude the deferred.")]),e._v("\nstatus "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_undefined")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("undefined"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Resolve or reject the promise associated with the deferred depending on")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// whether the asynchronous action succeeded.")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("asynchronous_action_succeeded"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_resolve_deferred")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" deferred"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" undefined"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("else")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_reject_deferred")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" deferred"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" undefined"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" napi_ok"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// At this point the deferred has been freed, so we should assign NULL to it.")]),e._v("\ndeferred "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("h3",{attrs:{id:"napi-create-promise"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-create-promise"}},[e._v("#")]),e._v(" napi_create_promise")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_promise")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                napi_deferred"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" deferred"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" promise"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[out] deferred")]),e._v(": A newly created deferred object which can later be passed to\n"),a("code",[e._v("napi_resolve_deferred()")]),e._v(" or "),a("code",[e._v("napi_reject_deferred()")]),e._v(" to resolve resp. reject\nthe associated promise.")]),e._v(" "),a("li",[a("code",[e._v("[out] promise")]),e._v(": The JavaScript promise associated with the deferred object.")])]),e._v(" "),a("p",[e._v("Returns "),a("code",[e._v("napi_ok")]),e._v(" if the API succeeded.")]),e._v(" "),a("p",[e._v("This API creates a deferred object and a JavaScript promise.")]),e._v(" "),a("h3",{attrs:{id:"napi-resolve-deferred"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-resolve-deferred"}},[e._v("#")]),e._v(" napi_resolve_deferred")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_resolve_deferred")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                  napi_deferred deferred"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                  napi_value resolution"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] deferred")]),e._v(": The deferred object whose associated promise to resolve.")]),e._v(" "),a("li",[a("code",[e._v("[in] resolution")]),e._v(": The value with which to resolve the promise.")])]),e._v(" "),a("p",[e._v("This API resolves a JavaScript promise by way of the deferred object\nwith which it is associated. Thus, it can only be used to resolve JavaScript\npromises for which the corresponding deferred object is available. This\neffectively means that the promise must have been created using\n"),a("code",[e._v("napi_create_promise()")]),e._v(" and the deferred object returned from that call must\nhave been retained in order to be passed to this API.")]),e._v(" "),a("p",[e._v("The deferred object is freed upon successful completion.")]),e._v(" "),a("h3",{attrs:{id:"napi-reject-deferred"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-reject-deferred"}},[e._v("#")]),e._v(" napi_reject_deferred")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_reject_deferred")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                 napi_deferred deferred"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                 napi_value rejection"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] deferred")]),e._v(": The deferred object whose associated promise to resolve.")]),e._v(" "),a("li",[a("code",[e._v("[in] rejection")]),e._v(": The value with which to reject the promise.")])]),e._v(" "),a("p",[e._v("This API rejects a JavaScript promise by way of the deferred object\nwith which it is associated. Thus, it can only be used to reject JavaScript\npromises for which the corresponding deferred object is available. This\neffectively means that the promise must have been created using\n"),a("code",[e._v("napi_create_promise()")]),e._v(" and the deferred object returned from that call must\nhave been retained in order to be passed to this API.")]),e._v(" "),a("p",[e._v("The deferred object is freed upon successful completion.")]),e._v(" "),a("h3",{attrs:{id:"napi-is-promise"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-is-promise"}},[e._v("#")]),e._v(" napi_is_promise")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_is_promise")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                            napi_value promise"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                            bool"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" is_promise"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] promise")]),e._v(": The promise to examine")]),e._v(" "),a("li",[a("code",[e._v("[out] is_promise")]),e._v(": Flag indicating whether "),a("code",[e._v("promise")]),e._v(" is a native promise\nobject (that is, a promise object created by the underlying engine).")])]),e._v(" "),a("h2",{attrs:{id:"script-execution"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#script-execution"}},[e._v("#")]),e._v(" Script execution")]),e._v(" "),a("p",[e._v("N-API provides an API for executing a string containing JavaScript using the\nunderlying JavaScript engine.")]),e._v(" "),a("h3",{attrs:{id:"napi-run-script"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-run-script"}},[e._v("#")]),e._v(" napi_run_script")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("NAPI_EXTERN napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_run_script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                        napi_value script"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                        napi_value"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] script")]),e._v(": A JavaScript string containing the script to execute.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": The value resulting from having executed the script.")])]),e._v(" "),a("h2",{attrs:{id:"libuv-event-loop"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#libuv-event-loop"}},[e._v("#")]),e._v(" libuv event loop")]),e._v(" "),a("p",[e._v("N-API provides a function for getting the current event loop associated with\na specific "),a("code",[e._v("napi_env")]),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"napi-get-uv-event-loop"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-uv-event-loop"}},[e._v("#")]),e._v(" napi_get_uv_event_loop")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("NAPI_EXTERN napi_status "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_uv_event_loop")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                               uv_loop_t"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" loop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[out] loop")]),e._v(": The current libuv loop instance.")])]),e._v(" "),a("h2",{attrs:{id:"asynchronous-thread-safe-function-calls"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#asynchronous-thread-safe-function-calls"}},[e._v("#")]),e._v(" Asynchronous Thread-safe Function Calls")]),e._v(" "),a("p",[e._v("JavaScript functions can normally only be called from a native addon's main\nthread. If an addon creates additional threads, then N-API functions that\nrequire a "),a("code",[e._v("napi_env")]),e._v(", "),a("code",[e._v("napi_value")]),e._v(", or "),a("code",[e._v("napi_ref")]),e._v(" must not be called from those\nthreads.")]),e._v(" "),a("p",[e._v("When an addon has additional threads and JavaScript functions need to be invoked\nbased on the processing completed by those threads, those threads must\ncommunicate with the addon's main thread so that the main thread can invoke the\nJavaScript function on their behalf. The thread-safe function APIs provide an\neasy way to do this.")]),e._v(" "),a("p",[e._v("These APIs provide the type "),a("code",[e._v("napi_threadsafe_function")]),e._v(" as well as APIs to\ncreate, destroy, and call objects of this type.\n"),a("code",[e._v("napi_create_threadsafe_function()")]),e._v(" creates a persistent reference to a\n"),a("code",[e._v("napi_value")]),e._v(" that holds a JavaScript function which can be called from multiple\nthreads. The calls happen asynchronously. This means that values with which the\nJavaScript callback is to be called will be placed in a queue, and, for each\nvalue in the queue, a call will eventually be made to the JavaScript function.")]),e._v(" "),a("p",[e._v("Upon creation of a "),a("code",[e._v("napi_threadsafe_function")]),e._v(" a "),a("code",[e._v("napi_finalize")]),e._v(" callback can be\nprovided. This callback will be invoked on the main thread when the thread-safe\nfunction is about to be destroyed. It receives the context and the finalize data\ngiven during construction, and provides an opportunity for cleaning up after the\nthreads e.g. by calling "),a("code",[e._v("uv_thread_join()")]),e._v(". "),a("strong",[e._v("Aside from the main loop thread,\nno threads should be using the thread-safe function after the finalize callback\ncompletes.")])]),e._v(" "),a("p",[e._v("The "),a("code",[e._v("context")]),e._v(" given during the call to "),a("code",[e._v("napi_create_threadsafe_function()")]),e._v(" can\nbe retrieved from any thread with a call to\n"),a("code",[e._v("napi_get_threadsafe_function_context()")]),e._v(".")]),e._v(" "),a("p",[a("code",[e._v("napi_call_threadsafe_function()")]),e._v(" can then be used for initiating a call into\nJavaScript. "),a("code",[e._v("napi_call_threadsafe_function()")]),e._v(" accepts a parameter which controls\nwhether the API behaves blockingly. If set to "),a("code",[e._v("napi_tsfn_nonblocking")]),e._v(", the API\nbehaves non-blockingly, returning "),a("code",[e._v("napi_queue_full")]),e._v(" if the queue was full,\npreventing data from being successfully added to the queue. If set to\n"),a("code",[e._v("napi_tsfn_blocking")]),e._v(", the API blocks until space becomes available in the queue.\n"),a("code",[e._v("napi_call_threadsafe_function()")]),e._v(" never blocks if the thread-safe function was\ncreated with a maximum queue size of 0.")]),e._v(" "),a("p",[e._v("The actual call into JavaScript is controlled by the callback given via the\n"),a("code",[e._v("call_js_cb")]),e._v(" parameter. "),a("code",[e._v("call_js_cb")]),e._v(" is invoked on the main thread once for each\nvalue that was placed into the queue by a successful call to\n"),a("code",[e._v("napi_call_threadsafe_function()")]),e._v(". If such a callback is not given, a default\ncallback will be used, and the resulting JavaScript call will have no arguments.\nThe "),a("code",[e._v("call_js_cb")]),e._v(" callback receives the JavaScript function to call as a\n"),a("code",[e._v("napi_value")]),e._v(" in its parameters, as well as the "),a("code",[e._v("void*")]),e._v(" context pointer used when\ncreating the "),a("code",[e._v("napi_threadsafe_function")]),e._v(", and the next data pointer that was\ncreated by one of the secondary threads. The callback can then use an API such\nas "),a("code",[e._v("napi_call_function()")]),e._v(" to call into JavaScript.")]),e._v(" "),a("p",[e._v("The callback may also be invoked with "),a("code",[e._v("env")]),e._v(" and "),a("code",[e._v("call_js_cb")]),e._v(" both set to "),a("code",[e._v("NULL")]),e._v("\nto indicate that calls into JavaScript are no longer possible, while items\nremain in the queue that may need to be freed. This normally occurs when the\nNode.js process exits while there is a thread-safe function still active.")]),e._v(" "),a("p",[e._v("It is not necessary to call into JavaScript via "),a("code",[e._v("napi_make_callback()")]),e._v(" because\nN-API runs "),a("code",[e._v("call_js_cb")]),e._v(" in a context appropriate for callbacks.")]),e._v(" "),a("p",[e._v("Threads can be added to and removed from a "),a("code",[e._v("napi_threadsafe_function")]),e._v(" object\nduring its existence. Thus, in addition to specifying an initial number of\nthreads upon creation, "),a("code",[e._v("napi_acquire_threadsafe_function")]),e._v(" can be called to\nindicate that a new thread will start making use of the thread-safe function.\nSimilarly, "),a("code",[e._v("napi_release_threadsafe_function")]),e._v(" can be called to indicate that an\nexisting thread will stop making use of the thread-safe function.")]),e._v(" "),a("p",[a("code",[e._v("napi_threadsafe_function")]),e._v(" objects are destroyed when every thread which uses\nthe object has called "),a("code",[e._v("napi_release_threadsafe_function()")]),e._v(" or has received a\nreturn status of "),a("code",[e._v("napi_closing")]),e._v(" in response to a call to\n"),a("code",[e._v("napi_call_threadsafe_function")]),e._v(". The queue is emptied before the\n"),a("code",[e._v("napi_threadsafe_function")]),e._v(" is destroyed. "),a("code",[e._v("napi_release_threadsafe_function()")]),e._v("\nshould be the last API call made in conjunction with a given\n"),a("code",[e._v("napi_threadsafe_function")]),e._v(", because after the call completes, there is no\nguarantee that the "),a("code",[e._v("napi_threadsafe_function")]),e._v(" is still allocated. For the same\nreason, do not make use of a thread-safe function\nafter receiving a return value of "),a("code",[e._v("napi_closing")]),e._v(" in response to a call to\n"),a("code",[e._v("napi_call_threadsafe_function")]),e._v(". Data associated with the\n"),a("code",[e._v("napi_threadsafe_function")]),e._v(" can be freed in its "),a("code",[e._v("napi_finalize")]),e._v(" callback which\nwas passed to "),a("code",[e._v("napi_create_threadsafe_function()")]),e._v(".")]),e._v(" "),a("p",[e._v("Once the number of threads making use of a "),a("code",[e._v("napi_threadsafe_function")]),e._v(" reaches\nzero, no further threads can start making use of it by calling\n"),a("code",[e._v("napi_acquire_threadsafe_function()")]),e._v(". In fact, all subsequent API calls\nassociated with it, except "),a("code",[e._v("napi_release_threadsafe_function()")]),e._v(", will return an\nerror value of "),a("code",[e._v("napi_closing")]),e._v(".")]),e._v(" "),a("p",[e._v('The thread-safe function can be "aborted" by giving a value of '),a("code",[e._v("napi_tsfn_abort")]),e._v("\nto "),a("code",[e._v("napi_release_threadsafe_function()")]),e._v(". This will cause all subsequent APIs\nassociated with the thread-safe function except\n"),a("code",[e._v("napi_release_threadsafe_function()")]),e._v(" to return "),a("code",[e._v("napi_closing")]),e._v(" even before its\nreference count reaches zero. In particular, "),a("code",[e._v("napi_call_threadsafe_function()")]),e._v("\nwill return "),a("code",[e._v("napi_closing")]),e._v(", thus informing the threads that it is no longer\npossible to make asynchronous calls to the thread-safe function. This can be\nused as a criterion for terminating the thread. "),a("strong",[e._v("Upon receiving a return value\nof "),a("code",[e._v("napi_closing")]),e._v(" from "),a("code",[e._v("napi_call_threadsafe_function()")]),e._v(" a thread must make no\nfurther use of the thread-safe function because it is no longer guaranteed to\nbe allocated.")])]),e._v(" "),a("p",[e._v('Similarly to libuv handles, thread-safe functions can be "referenced" and\n"unreferenced". A "referenced" thread-safe function will cause the event loop on\nthe thread on which it is created to remain alive until the thread-safe function\nis destroyed. In contrast, an "unreferenced" thread-safe function will not\nprevent the event loop from exiting. The APIs '),a("code",[e._v("napi_ref_threadsafe_function")]),e._v(" and\n"),a("code",[e._v("napi_unref_threadsafe_function")]),e._v(" exist for this purpose.")]),e._v(" "),a("h3",{attrs:{id:"napi-create-threadsafe-function"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-create-threadsafe-function"}},[e._v("#")]),e._v(" napi_create_threadsafe_function")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("NAPI_EXTERN napi_status\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_create_threadsafe_function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                napi_value func"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                napi_value async_resource"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                napi_value async_resource_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                size_t max_queue_size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                size_t initial_thread_count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" thread_finalize_data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                napi_finalize thread_finalize_cb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                napi_threadsafe_function_call_js call_js_cb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                napi_threadsafe_function"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] func")]),e._v(": An optional JavaScript function to call from another thread.\nIt must be provided if "),a("code",[e._v("NULL")]),e._v(" is passed to "),a("code",[e._v("call_js_cb")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[in] async_resource")]),e._v(": An optional object associated with the async work that\nwill be passed to possible "),a("code",[e._v("async_hooks")]),e._v(" "),a("router-link",{attrs:{to:"/node/async_hooks.html#async_hooks_init_asyncid_type_triggerasyncid_resource"}},[a("code",[e._v("init")]),e._v(" hooks")]),e._v(".")],1),e._v(" "),a("li",[a("code",[e._v("[in] async_resource_name")]),e._v(": A JavaScript string to provide an identifier for\nthe kind of resource that is being provided for diagnostic information exposed\nby the "),a("code",[e._v("async_hooks")]),e._v(" API.")]),e._v(" "),a("li",[a("code",[e._v("[in] max_queue_size")]),e._v(": Maximum size of the queue. "),a("code",[e._v("0")]),e._v(" for no limit.")]),e._v(" "),a("li",[a("code",[e._v("[in] initial_thread_count")]),e._v(": The initial number of threads, including the main\nthread, which will be making use of this function.")]),e._v(" "),a("li",[a("code",[e._v("[in] thread_finalize_data")]),e._v(": Optional data to be passed to "),a("code",[e._v("thread_finalize_cb")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[in] thread_finalize_cb")]),e._v(": Optional function to call when the\n"),a("code",[e._v("napi_threadsafe_function")]),e._v(" is being destroyed.")]),e._v(" "),a("li",[a("code",[e._v("[in] context")]),e._v(": Optional data to attach to the resulting\n"),a("code",[e._v("napi_threadsafe_function")]),e._v(".")]),e._v(" "),a("li",[a("code",[e._v("[in] call_js_cb")]),e._v(": Optional callback which calls the JavaScript function in\nresponse to a call on a different thread. This callback will be called on the\nmain thread. If not given, the JavaScript function will be called with no\nparameters and with "),a("code",[e._v("undefined")]),e._v(" as its "),a("code",[e._v("this")]),e._v(" value.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": The asynchronous thread-safe JavaScript function.")])]),e._v(" "),a("h3",{attrs:{id:"napi-get-threadsafe-function-context"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-get-threadsafe-function-context"}},[e._v("#")]),e._v(" napi_get_threadsafe_function_context")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("NAPI_EXTERN napi_status\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_get_threadsafe_function_context")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_threadsafe_function func"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                     "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] func")]),e._v(": The thread-safe function for which to retrieve the context.")]),e._v(" "),a("li",[a("code",[e._v("[out] result")]),e._v(": The location where to store the context.")])]),e._v(" "),a("p",[e._v("This API may be called from any thread which makes use of "),a("code",[e._v("func")]),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"napi-call-threadsafe-function"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-call-threadsafe-function"}},[e._v("#")]),e._v(" napi_call_threadsafe_function")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("NAPI_EXTERN napi_status\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_call_threadsafe_function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_threadsafe_function func"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                              napi_threadsafe_function_call_mode is_blocking"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] func")]),e._v(": The asynchronous thread-safe JavaScript function to invoke.")]),e._v(" "),a("li",[a("code",[e._v("[in] data")]),e._v(": Data to send into JavaScript via the callback "),a("code",[e._v("call_js_cb")]),e._v("\nprovided during the creation of the thread-safe JavaScript function.")]),e._v(" "),a("li",[a("code",[e._v("[in] is_blocking")]),e._v(": Flag whose value can be either "),a("code",[e._v("napi_tsfn_blocking")]),e._v(" to\nindicate that the call should block if the queue is full or\n"),a("code",[e._v("napi_tsfn_nonblocking")]),e._v(" to indicate that the call should return immediately with\na status of "),a("code",[e._v("napi_queue_full")]),e._v(" whenever the queue is full.")])]),e._v(" "),a("p",[e._v("This API will return "),a("code",[e._v("napi_closing")]),e._v(" if "),a("code",[e._v("napi_release_threadsafe_function()")]),e._v(" was\ncalled with "),a("code",[e._v("abort")]),e._v(" set to "),a("code",[e._v("napi_tsfn_abort")]),e._v(" from any thread. The value is only\nadded to the queue if the API returns "),a("code",[e._v("napi_ok")]),e._v(".")]),e._v(" "),a("p",[e._v("This API may be called from any thread which makes use of "),a("code",[e._v("func")]),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"napi-acquire-threadsafe-function"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-acquire-threadsafe-function"}},[e._v("#")]),e._v(" napi_acquire_threadsafe_function")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("NAPI_EXTERN napi_status\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_acquire_threadsafe_function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_threadsafe_function func"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] func")]),e._v(": The asynchronous thread-safe JavaScript function to start making\nuse of.")])]),e._v(" "),a("p",[e._v("A thread should call this API before passing "),a("code",[e._v("func")]),e._v(" to any other thread-safe\nfunction APIs to indicate that it will be making use of "),a("code",[e._v("func")]),e._v(". This prevents\n"),a("code",[e._v("func")]),e._v(" from being destroyed when all other threads have stopped making use of\nit.")]),e._v(" "),a("p",[e._v("This API may be called from any thread which will start making use of "),a("code",[e._v("func")]),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"napi-release-threadsafe-function"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-release-threadsafe-function"}},[e._v("#")]),e._v(" napi_release_threadsafe_function")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("NAPI_EXTERN napi_status\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_release_threadsafe_function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_threadsafe_function func"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                                 napi_threadsafe_function_release_mode mode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] func")]),e._v(": The asynchronous thread-safe JavaScript function whose reference\ncount to decrement.")]),e._v(" "),a("li",[a("code",[e._v("[in] mode")]),e._v(": Flag whose value can be either "),a("code",[e._v("napi_tsfn_release")]),e._v(" to indicate\nthat the current thread will make no further calls to the thread-safe function,\nor "),a("code",[e._v("napi_tsfn_abort")]),e._v(" to indicate that in addition to the current thread, no\nother thread should make any further calls to the thread-safe function. If set\nto "),a("code",[e._v("napi_tsfn_abort")]),e._v(", further calls to "),a("code",[e._v("napi_call_threadsafe_function()")]),e._v(" will\nreturn "),a("code",[e._v("napi_closing")]),e._v(", and no further values will be placed in the queue.")])]),e._v(" "),a("p",[e._v("A thread should call this API when it stops making use of "),a("code",[e._v("func")]),e._v(". Passing "),a("code",[e._v("func")]),e._v("\nto any thread-safe APIs after having called this API has undefined results, as\n"),a("code",[e._v("func")]),e._v(" may have been destroyed.")]),e._v(" "),a("p",[e._v("This API may be called from any thread which will stop making use of "),a("code",[e._v("func")]),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"napi-ref-threadsafe-function"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-ref-threadsafe-function"}},[e._v("#")]),e._v(" napi_ref_threadsafe_function")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("NAPI_EXTERN napi_status\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_ref_threadsafe_function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_threadsafe_function func"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] func")]),e._v(": The thread-safe function to reference.")])]),e._v(" "),a("p",[e._v("This API is used to indicate that the event loop running on the main thread\nshould not exit until "),a("code",[e._v("func")]),e._v(" has been destroyed. Similar to "),a("a",{attrs:{href:"http://docs.libuv.org/en/v1.x/handle.html#c.uv_ref",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("uv_ref")]),a("OutboundLink")],1),e._v(" it is\nalso idempotent.")]),e._v(" "),a("p",[e._v("This API may only be called from the main thread.")]),e._v(" "),a("h3",{attrs:{id:"napi-unref-threadsafe-function"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#napi-unref-threadsafe-function"}},[e._v("#")]),e._v(" napi_unref_threadsafe_function")]),e._v(" "),a("div",{staticClass:"language-C extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[e._v("NAPI_EXTERN napi_status\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("napi_unref_threadsafe_function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("napi_env env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" napi_threadsafe_function func"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("ul",[a("li",[a("code",[e._v("[in] env")]),e._v(": The environment that the API is invoked under.")]),e._v(" "),a("li",[a("code",[e._v("[in] func")]),e._v(": The thread-safe function to unreference.")])]),e._v(" "),a("p",[e._v("This API is used to indicate that the event loop running on the main thread\nmay exit before "),a("code",[e._v("func")]),e._v(" is destroyed. Similar to "),a("a",{attrs:{href:"http://docs.libuv.org/en/v1.x/handle.html#c.uv_unref",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("uv_unref")]),a("OutboundLink")],1),e._v(" it is also\nidempotent.")]),e._v(" "),a("p",[e._v("This API may only be called from the main thread.")])])}),[],!1,null,null,null);t.default=s.exports}}]);