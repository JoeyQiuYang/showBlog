<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Trace Events | QLQ学习平台</title>
    <meta name="description" content="QLQ学习平台">
    <link rel="manifest" href="/public/blog/manifest.json">
    
    <link rel="preload" href="/public/blog/assets/css/0.styles.3ad33863.css" as="style"><link rel="preload" href="/public/blog/assets/js/app.e4ea57ce.js" as="script"><link rel="preload" href="/public/blog/assets/js/2.d1dd4e4d.js" as="script"><link rel="preload" href="/public/blog/assets/js/55.c466c411.js" as="script"><link rel="preload" href="/public/blog/assets/js/3.1f730cd9.js" as="script"><link rel="prefetch" href="/public/blog/assets/js/10.7d4b1d4b.js"><link rel="prefetch" href="/public/blog/assets/js/11.b74ab56f.js"><link rel="prefetch" href="/public/blog/assets/js/12.5effa0dc.js"><link rel="prefetch" href="/public/blog/assets/js/13.6eb918e8.js"><link rel="prefetch" href="/public/blog/assets/js/14.0de95251.js"><link rel="prefetch" href="/public/blog/assets/js/15.fa3eaaf6.js"><link rel="prefetch" href="/public/blog/assets/js/16.fa5a1f3f.js"><link rel="prefetch" href="/public/blog/assets/js/17.65e33a7a.js"><link rel="prefetch" href="/public/blog/assets/js/18.a604e43f.js"><link rel="prefetch" href="/public/blog/assets/js/19.43fdc1b1.js"><link rel="prefetch" href="/public/blog/assets/js/20.c6e0b4b7.js"><link rel="prefetch" href="/public/blog/assets/js/21.81d73e54.js"><link rel="prefetch" href="/public/blog/assets/js/22.2da1489e.js"><link rel="prefetch" href="/public/blog/assets/js/23.98032a48.js"><link rel="prefetch" href="/public/blog/assets/js/24.bf1aeeb3.js"><link rel="prefetch" href="/public/blog/assets/js/25.ff0a5a9e.js"><link rel="prefetch" href="/public/blog/assets/js/26.9a69e70f.js"><link rel="prefetch" href="/public/blog/assets/js/27.78d71253.js"><link rel="prefetch" href="/public/blog/assets/js/28.05172e35.js"><link rel="prefetch" href="/public/blog/assets/js/29.836b5f2c.js"><link rel="prefetch" href="/public/blog/assets/js/30.7f2a0aa5.js"><link rel="prefetch" href="/public/blog/assets/js/31.16e7c775.js"><link rel="prefetch" href="/public/blog/assets/js/32.9d8aa648.js"><link rel="prefetch" href="/public/blog/assets/js/33.3ad73093.js"><link rel="prefetch" href="/public/blog/assets/js/34.a27e23cf.js"><link rel="prefetch" href="/public/blog/assets/js/35.34f0ba53.js"><link rel="prefetch" href="/public/blog/assets/js/36.993eb43f.js"><link rel="prefetch" href="/public/blog/assets/js/37.70ac44f6.js"><link rel="prefetch" href="/public/blog/assets/js/38.4b9e0ad1.js"><link rel="prefetch" href="/public/blog/assets/js/39.f8c33c98.js"><link rel="prefetch" href="/public/blog/assets/js/4.a6ed393e.js"><link rel="prefetch" href="/public/blog/assets/js/40.a2197e85.js"><link rel="prefetch" href="/public/blog/assets/js/41.467d6440.js"><link rel="prefetch" href="/public/blog/assets/js/42.ba8fc1fa.js"><link rel="prefetch" href="/public/blog/assets/js/43.b9d80aa8.js"><link rel="prefetch" href="/public/blog/assets/js/44.9b55cec1.js"><link rel="prefetch" href="/public/blog/assets/js/45.fbd44db5.js"><link rel="prefetch" href="/public/blog/assets/js/46.cff257a8.js"><link rel="prefetch" href="/public/blog/assets/js/47.3cd816de.js"><link rel="prefetch" href="/public/blog/assets/js/48.fdd057cb.js"><link rel="prefetch" href="/public/blog/assets/js/49.e007afae.js"><link rel="prefetch" href="/public/blog/assets/js/5.868620b4.js"><link rel="prefetch" href="/public/blog/assets/js/50.05e06075.js"><link rel="prefetch" href="/public/blog/assets/js/51.28689d1c.js"><link rel="prefetch" href="/public/blog/assets/js/52.84b0ef5c.js"><link rel="prefetch" href="/public/blog/assets/js/53.586cad0a.js"><link rel="prefetch" href="/public/blog/assets/js/54.2b8a703d.js"><link rel="prefetch" href="/public/blog/assets/js/56.882ab9d2.js"><link rel="prefetch" href="/public/blog/assets/js/57.edaca7e3.js"><link rel="prefetch" href="/public/blog/assets/js/58.c7ce4964.js"><link rel="prefetch" href="/public/blog/assets/js/59.02f33b29.js"><link rel="prefetch" href="/public/blog/assets/js/6.8e0ec0a1.js"><link rel="prefetch" href="/public/blog/assets/js/60.3e43121d.js"><link rel="prefetch" href="/public/blog/assets/js/61.e73a45bf.js"><link rel="prefetch" href="/public/blog/assets/js/62.a1ea2161.js"><link rel="prefetch" href="/public/blog/assets/js/63.0a4a98df.js"><link rel="prefetch" href="/public/blog/assets/js/64.0422c733.js"><link rel="prefetch" href="/public/blog/assets/js/65.b26f077a.js"><link rel="prefetch" href="/public/blog/assets/js/7.287519a5.js"><link rel="prefetch" href="/public/blog/assets/js/8.5443f788.js"><link rel="prefetch" href="/public/blog/assets/js/9.ef0461e8.js">
    <link rel="stylesheet" href="/public/blog/assets/css/0.styles.3ad33863.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/public/blog/" class="home-link router-link-active"><!----> <span class="site-name">QLQ学习平台</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/public/blog/js/regexp.html" class="nav-link">javaScript</a></div><div class="nav-item"><a href="/public/blog/css/bfc.html" class="nav-link">css</a></div><div class="nav-item"><a href="/public/blog/webpack/base-config.html" class="nav-link">webpack</a></div><div class="nav-item"><a href="/public/blog/node/buffer.html" class="nav-link">node</a></div><div class="nav-item"><a href="/public/blog/fragment/angular.html" class="nav-link">js框架</a></div><div class="nav-item"><a href="/public/blog/pwa/PWA.html" class="nav-link">pwa</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/public/blog/js/regexp.html" class="nav-link">javaScript</a></div><div class="nav-item"><a href="/public/blog/css/bfc.html" class="nav-link">css</a></div><div class="nav-item"><a href="/public/blog/webpack/base-config.html" class="nav-link">webpack</a></div><div class="nav-item"><a href="/public/blog/node/buffer.html" class="nav-link">node</a></div><div class="nav-item"><a href="/public/blog/fragment/angular.html" class="nav-link">js框架</a></div><div class="nav-item"><a href="/public/blog/pwa/PWA.html" class="nav-link">pwa</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>node</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/public/blog/node/buffer.html" class="sidebar-link">Buffer</a></li><li><a href="/public/blog/node/stream.html" class="sidebar-link">Stream</a></li><li><a href="/public/blog/node/nodemon.html" class="sidebar-link">nodemon：高效的nodejs开发环境</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="trace-events"><a href="#trace-events" class="header-anchor">#</a> Trace Events</h1> <blockquote><p>Stability: 1 - Experimental</p></blockquote> <p>Trace Event provides a mechanism to centralize tracing information generated by
V8, Node.js core, and userspace code.</p> <p>Tracing can be enabled with the <code>--trace-event-categories</code> command-line flag
or by using the <code>trace_events</code> module. The <code>--trace-event-categories</code> flag
accepts a list of comma-separated category names.</p> <p>The available categories are:</p> <ul><li><code>node</code>: An empty placeholder.</li> <li><code>node.async_hooks</code>: Enables capture of detailed <a href="/public/blog/node/async_hooks.html"><code>async_hooks</code></a> trace data.
The <a href="/public/blog/node/async_hooks.html"><code>async_hooks</code></a> events have a unique <code>asyncId</code> and a special <code>triggerId</code> <code>triggerAsyncId</code> property.</li> <li><code>node.bootstrap</code>: Enables capture of Node.js bootstrap milestones.</li> <li><code>node.console</code>: Enables capture of <code>console.time()</code> and <code>console.count()</code>
output.</li> <li><code>node.dns.native</code>: Enables capture of trace data for DNS queries.</li> <li><code>node.environment</code>: Enables capture of Node.js Environment milestones.</li> <li><code>node.fs.sync</code>: Enables capture of trace data for file system sync methods.</li> <li><code>node.perf</code>: Enables capture of <a href="/public/blog/node/perf_hooks.html">Performance API</a> measurements.
<ul><li><code>node.perf.usertiming</code>: Enables capture of only Performance API User Timing
measures and marks.</li> <li><code>node.perf.timerify</code>: Enables capture of only Performance API timerify
measurements.</li></ul></li> <li><code>node.promises.rejections</code>: Enables capture of trace data tracking the number
of unhandled Promise rejections and handled-after-rejections.</li> <li><code>node.vm.script</code>: Enables capture of trace data for the <code>vm</code> module's
<code>runInNewContext()</code>, <code>runInContext()</code>, and <code>runInThisContext()</code> methods.</li> <li><code>v8</code>: The <a href="/public/blog/node/v8.html">V8</a> events are GC, compiling, and execution related.</li></ul> <p>By default the <code>node</code>, <code>node.async_hooks</code>, and <code>v8</code> categories are enabled.</p> <div class="language-txt extra-class"><pre class="language-text"><code>node --trace-event-categories v8,node,node.async_hooks server.js
</code></pre></div><p>Prior versions of Node.js required the use of the <code>--trace-events-enabled</code>
flag to enable trace events. This requirement has been removed. However, the
<code>--trace-events-enabled</code> flag <em>may</em> still be used and will enable the
<code>node</code>, <code>node.async_hooks</code>, and <code>v8</code> trace event categories by default.</p> <div class="language-txt extra-class"><pre class="language-text"><code>node --trace-events-enabled

// is equivalent to

node --trace-event-categories v8,node,node.async_hooks
</code></pre></div><p>Alternatively, trace events may be enabled using the <code>trace_events</code> module:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> trace_events <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'trace_events'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> tracing <span class="token operator">=</span> trace_events<span class="token punctuation">.</span><span class="token function">createTracing</span><span class="token punctuation">(</span><span class="token punctuation">{</span> categories<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'node.perf'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
tracing<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Enable trace event capture for the 'node.perf' category</span>

<span class="token comment">// do work</span>

tracing<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Disable trace event capture for the 'node.perf' category</span>
</code></pre></div><p>Running Node.js with tracing enabled will produce log files that can be opened
in the <a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool" target="_blank" rel="noopener noreferrer"><code>chrome://tracing</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
tab of Chrome.</p> <p>The logging file is by default called <code>node_trace.${rotation}.log</code>, where
<code>${rotation}</code> is an incrementing log-rotation id. The filepath pattern can
be specified with <code>--trace-event-file-pattern</code> that accepts a template
string that supports <code>${rotation}</code> and <code>${pid}</code>:</p> <div class="language-txt extra-class"><pre class="language-text"><code>node --trace-event-categories v8 --trace-event-file-pattern '${pid}-${rotation}.log' server.js
</code></pre></div><p>Starting with Node.js 10.0.0, the tracing system uses the same time source
as the one used by <code>process.hrtime()</code>
however the trace-event timestamps are expressed in microseconds,
unlike <code>process.hrtime()</code> which returns nanoseconds.</p> <p>The features from this module are not available in <a href="/public/blog/node/worker_threads.html#worker_threads_class_worker"><code>Worker</code></a> threads.</p> <h2 id="the-trace-events-module"><a href="#the-trace-events-module" class="header-anchor">#</a> The <code>trace_events</code> module</h2> <h3 id="tracing-object"><a href="#tracing-object" class="header-anchor">#</a> <code>Tracing</code> object</h3> <p>The <code>Tracing</code> object is used to enable or disable tracing for sets of
categories. Instances are created using the <code>trace_events.createTracing()</code>
method.</p> <p>When created, the <code>Tracing</code> object is disabled. Calling the
<code>tracing.enable()</code> method adds the categories to the set of enabled trace event
categories. Calling <code>tracing.disable()</code> will remove the categories from the
set of enabled trace event categories.</p> <h4 id="tracing-categories"><a href="#tracing-categories" class="header-anchor">#</a> <code>tracing.categories</code></h4> <ul><li>{string}</li></ul> <p>A comma-separated list of the trace event categories covered by this
<code>Tracing</code> object.</p> <h4 id="tracing-disable"><a href="#tracing-disable" class="header-anchor">#</a> <code>tracing.disable()</code></h4> <p>Disables this <code>Tracing</code> object.</p> <p>Only trace event categories <em>not</em> covered by other enabled <code>Tracing</code> objects
and <em>not</em> specified by the <code>--trace-event-categories</code> flag will be disabled.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> trace_events <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'trace_events'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> t1 <span class="token operator">=</span> trace_events<span class="token punctuation">.</span><span class="token function">createTracing</span><span class="token punctuation">(</span><span class="token punctuation">{</span> categories<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'node'</span><span class="token punctuation">,</span> <span class="token string">'v8'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> t2 <span class="token operator">=</span> trace_events<span class="token punctuation">.</span><span class="token function">createTracing</span><span class="token punctuation">(</span><span class="token punctuation">{</span> categories<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'node.perf'</span><span class="token punctuation">,</span> <span class="token string">'node'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
t1<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
t2<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Prints 'node,node.perf,v8'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>trace_events<span class="token punctuation">.</span><span class="token function">getEnabledCategories</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

t2<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Will only disable emission of the 'node.perf' category</span>

<span class="token comment">// Prints 'node,v8'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>trace_events<span class="token punctuation">.</span><span class="token function">getEnabledCategories</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="tracing-enable"><a href="#tracing-enable" class="header-anchor">#</a> <code>tracing.enable()</code></h4> <p>Enables this <code>Tracing</code> object for the set of categories covered by the
<code>Tracing</code> object.</p> <h4 id="tracing-enabled"><a href="#tracing-enabled" class="header-anchor">#</a> <code>tracing.enabled</code></h4> <ul><li>{boolean} <code>true</code> only if the <code>Tracing</code> object has been enabled.</li></ul> <h3 id="trace-events-createtracing-options"><a href="#trace-events-createtracing-options" class="header-anchor">#</a> <code>trace_events.createTracing(options)</code></h3> <ul><li><code>options</code> {Object}
<ul><li><code>categories</code> {string[]} An array of trace category names. Values included
in the array are coerced to a string when possible. An error will be
thrown if the value cannot be coerced.</li></ul></li> <li>Returns: {Tracing}.</li></ul> <p>Creates and returns a <code>Tracing</code> object for the given set of <code>categories</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> trace_events <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'trace_events'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> categories <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'node.perf'</span><span class="token punctuation">,</span> <span class="token string">'node.async_hooks'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> tracing <span class="token operator">=</span> trace_events<span class="token punctuation">.</span><span class="token function">createTracing</span><span class="token punctuation">(</span><span class="token punctuation">{</span> categories <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
tracing<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// do stuff</span>
tracing<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="trace-events-getenabledcategories"><a href="#trace-events-getenabledcategories" class="header-anchor">#</a> <code>trace_events.getEnabledCategories()</code></h3> <ul><li>Returns: {string}</li></ul> <p>Returns a comma-separated list of all currently-enabled trace event
categories. The current set of enabled trace event categories is determined
by the <em>union</em> of all currently-enabled <code>Tracing</code> objects and any categories
enabled using the <code>--trace-event-categories</code> flag.</p> <p>Given the file <code>test.js</code> below, the command
<code>node --trace-event-categories node.perf test.js</code> will print
<code>'node.async_hooks,node.perf'</code> to the console.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> trace_events <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'trace_events'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> t1 <span class="token operator">=</span> trace_events<span class="token punctuation">.</span><span class="token function">createTracing</span><span class="token punctuation">(</span><span class="token punctuation">{</span> categories<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'node.async_hooks'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> t2 <span class="token operator">=</span> trace_events<span class="token punctuation">.</span><span class="token function">createTracing</span><span class="token punctuation">(</span><span class="token punctuation">{</span> categories<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'node.perf'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> t3 <span class="token operator">=</span> trace_events<span class="token punctuation">.</span><span class="token function">createTracing</span><span class="token punctuation">(</span><span class="token punctuation">{</span> categories<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'v8'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

t1<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
t2<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>trace_events<span class="token punctuation">.</span><span class="token function">getEnabledCategories</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/public/blog/assets/js/app.e4ea57ce.js" defer></script><script src="/public/blog/assets/js/2.d1dd4e4d.js" defer></script><script src="/public/blog/assets/js/55.c466c411.js" defer></script><script src="/public/blog/assets/js/3.1f730cd9.js" defer></script>
  </body>
</html>
