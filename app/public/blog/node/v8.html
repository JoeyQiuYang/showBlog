<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>V8 | QLQ学习平台</title>
    <meta name="description" content="QLQ学习平台">
    <link rel="manifest" href="/public/blog/manifest.json">
    
    <link rel="preload" href="/public/blog/assets/css/0.styles.3ad33863.css" as="style"><link rel="preload" href="/public/blog/assets/js/app.793d18d6.js" as="script"><link rel="preload" href="/public/blog/assets/js/2.d1dd4e4d.js" as="script"><link rel="preload" href="/public/blog/assets/js/59.5ecba546.js" as="script"><link rel="preload" href="/public/blog/assets/js/3.1f730cd9.js" as="script"><link rel="prefetch" href="/public/blog/assets/js/10.7d4b1d4b.js"><link rel="prefetch" href="/public/blog/assets/js/11.c135c766.js"><link rel="prefetch" href="/public/blog/assets/js/12.17db24c5.js"><link rel="prefetch" href="/public/blog/assets/js/13.6e07cbcf.js"><link rel="prefetch" href="/public/blog/assets/js/14.ea2a0d07.js"><link rel="prefetch" href="/public/blog/assets/js/15.a6a7563b.js"><link rel="prefetch" href="/public/blog/assets/js/16.956a9122.js"><link rel="prefetch" href="/public/blog/assets/js/17.06ff4bf4.js"><link rel="prefetch" href="/public/blog/assets/js/18.a604e43f.js"><link rel="prefetch" href="/public/blog/assets/js/19.43fdc1b1.js"><link rel="prefetch" href="/public/blog/assets/js/20.faad6d2d.js"><link rel="prefetch" href="/public/blog/assets/js/21.554b2f54.js"><link rel="prefetch" href="/public/blog/assets/js/22.961d3c7f.js"><link rel="prefetch" href="/public/blog/assets/js/23.98032a48.js"><link rel="prefetch" href="/public/blog/assets/js/24.735ada0c.js"><link rel="prefetch" href="/public/blog/assets/js/25.151f485c.js"><link rel="prefetch" href="/public/blog/assets/js/26.f3d12769.js"><link rel="prefetch" href="/public/blog/assets/js/27.d91bf872.js"><link rel="prefetch" href="/public/blog/assets/js/28.2a36a68f.js"><link rel="prefetch" href="/public/blog/assets/js/29.78b1b45d.js"><link rel="prefetch" href="/public/blog/assets/js/30.7481d4c5.js"><link rel="prefetch" href="/public/blog/assets/js/31.16e7c775.js"><link rel="prefetch" href="/public/blog/assets/js/32.75fed837.js"><link rel="prefetch" href="/public/blog/assets/js/33.cf2e0b8f.js"><link rel="prefetch" href="/public/blog/assets/js/34.4221897d.js"><link rel="prefetch" href="/public/blog/assets/js/35.97e4fc88.js"><link rel="prefetch" href="/public/blog/assets/js/36.137598cd.js"><link rel="prefetch" href="/public/blog/assets/js/37.9b12e9de.js"><link rel="prefetch" href="/public/blog/assets/js/38.8d385bd4.js"><link rel="prefetch" href="/public/blog/assets/js/39.c2d2376a.js"><link rel="prefetch" href="/public/blog/assets/js/4.a6ed393e.js"><link rel="prefetch" href="/public/blog/assets/js/40.a2197e85.js"><link rel="prefetch" href="/public/blog/assets/js/41.6e6eb90b.js"><link rel="prefetch" href="/public/blog/assets/js/42.ba8fc1fa.js"><link rel="prefetch" href="/public/blog/assets/js/43.561011ab.js"><link rel="prefetch" href="/public/blog/assets/js/44.0e624559.js"><link rel="prefetch" href="/public/blog/assets/js/45.31eb2ed7.js"><link rel="prefetch" href="/public/blog/assets/js/46.33d8378f.js"><link rel="prefetch" href="/public/blog/assets/js/47.18b18711.js"><link rel="prefetch" href="/public/blog/assets/js/48.84db573a.js"><link rel="prefetch" href="/public/blog/assets/js/49.e007afae.js"><link rel="prefetch" href="/public/blog/assets/js/5.868620b4.js"><link rel="prefetch" href="/public/blog/assets/js/50.05e06075.js"><link rel="prefetch" href="/public/blog/assets/js/51.28689d1c.js"><link rel="prefetch" href="/public/blog/assets/js/52.84b0ef5c.js"><link rel="prefetch" href="/public/blog/assets/js/53.693b991f.js"><link rel="prefetch" href="/public/blog/assets/js/54.3ebbd2e5.js"><link rel="prefetch" href="/public/blog/assets/js/55.c466c411.js"><link rel="prefetch" href="/public/blog/assets/js/56.02fb13e9.js"><link rel="prefetch" href="/public/blog/assets/js/57.a0811a6e.js"><link rel="prefetch" href="/public/blog/assets/js/58.ef3c4301.js"><link rel="prefetch" href="/public/blog/assets/js/6.8e0ec0a1.js"><link rel="prefetch" href="/public/blog/assets/js/60.41e35580.js"><link rel="prefetch" href="/public/blog/assets/js/61.51154b06.js"><link rel="prefetch" href="/public/blog/assets/js/62.e557785e.js"><link rel="prefetch" href="/public/blog/assets/js/63.6ee35392.js"><link rel="prefetch" href="/public/blog/assets/js/64.5bb83569.js"><link rel="prefetch" href="/public/blog/assets/js/65.b26f077a.js"><link rel="prefetch" href="/public/blog/assets/js/7.287519a5.js"><link rel="prefetch" href="/public/blog/assets/js/8.ad4df861.js"><link rel="prefetch" href="/public/blog/assets/js/9.ef0461e8.js">
    <link rel="stylesheet" href="/public/blog/assets/css/0.styles.3ad33863.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/public/blog/" class="home-link router-link-active"><!----> <span class="site-name">QLQ学习平台</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/public/blog/js/regexp.html" class="nav-link">javaScript</a></div><div class="nav-item"><a href="/public/blog/css/bfc.html" class="nav-link">css</a></div><div class="nav-item"><a href="/public/blog/webpack/base-config.html" class="nav-link">webpack</a></div><div class="nav-item"><a href="/public/blog/node/nodemon.html" class="nav-link">node</a></div><div class="nav-item"><a href="/public/blog/fragment/angular.html" class="nav-link">js框架</a></div><div class="nav-item"><a href="/public/blog/pwa/PWA.html" class="nav-link">pwa</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/public/blog/js/regexp.html" class="nav-link">javaScript</a></div><div class="nav-item"><a href="/public/blog/css/bfc.html" class="nav-link">css</a></div><div class="nav-item"><a href="/public/blog/webpack/base-config.html" class="nav-link">webpack</a></div><div class="nav-item"><a href="/public/blog/node/nodemon.html" class="nav-link">node</a></div><div class="nav-item"><a href="/public/blog/fragment/angular.html" class="nav-link">js框架</a></div><div class="nav-item"><a href="/public/blog/pwa/PWA.html" class="nav-link">pwa</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>node</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/public/blog/node/buffer.html" class="sidebar-link">Buffer</a></li><li><a href="/public/blog/node/stream.html" class="sidebar-link">Stream</a></li><li><a href="/public/blog/node/nodemon.html" class="sidebar-link">nodemon：高效的nodejs开发环境</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="v8"><a href="#v8" class="header-anchor">#</a> V8</h1> <p>The <code>v8</code> module exposes APIs that are specific to the version of <a href="https://developers.google.com/v8/" target="_blank" rel="noopener noreferrer">V8<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
built into the Node.js binary. It can be accessed using:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> v8 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'v8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The APIs and implementation are subject to change at any time.</p> <h2 id="v8-cacheddataversiontag"><a href="#v8-cacheddataversiontag" class="header-anchor">#</a> v8.cachedDataVersionTag()</h2> <ul><li>Returns: {integer}</li></ul> <p>Returns an integer representing a &quot;version tag&quot; derived from the V8 version,
command line flags and detected CPU features. This is useful for determining
whether a <a href="/public/blog/node/vm.html#vm_constructor_new_vm_script_code_options"><code>vm.Script</code></a> <code>cachedData</code> buffer is compatible with this instance
of V8.</p> <h2 id="v8-getheapspacestatistics"><a href="#v8-getheapspacestatistics" class="header-anchor">#</a> v8.getHeapSpaceStatistics()</h2> <ul><li>Returns: {Object[]}</li></ul> <p>Returns statistics about the V8 heap spaces, i.e. the segments which make up
the V8 heap. Neither the ordering of heap spaces, nor the availability of a
heap space can be guaranteed as the statistics are provided via the V8
<a href="https://v8docs.nodesource.com/node-10.6/d5/dda/classv8_1_1_isolate.html#ac673576f24fdc7a33378f8f57e1d13a4" target="_blank" rel="noopener noreferrer"><code>GetHeapSpaceStatistics</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> function and may change from one V8 version to the
next.</p> <p>The value returned is an array of objects containing the following properties:</p> <ul><li><code>space_name</code> {string}</li> <li><code>space_size</code> {number}</li> <li><code>space_used_size</code> {number}</li> <li><code>space_available_size</code> {number}</li> <li><code>physical_space_size</code> {number}</li></ul> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;space_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;new_space&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;space_size&quot;</span><span class="token operator">:</span> <span class="token number">2063872</span><span class="token punctuation">,</span>
    <span class="token property">&quot;space_used_size&quot;</span><span class="token operator">:</span> <span class="token number">951112</span><span class="token punctuation">,</span>
    <span class="token property">&quot;space_available_size&quot;</span><span class="token operator">:</span> <span class="token number">80824</span><span class="token punctuation">,</span>
    <span class="token property">&quot;physical_space_size&quot;</span><span class="token operator">:</span> <span class="token number">2063872</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;space_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;old_space&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;space_size&quot;</span><span class="token operator">:</span> <span class="token number">3090560</span><span class="token punctuation">,</span>
    <span class="token property">&quot;space_used_size&quot;</span><span class="token operator">:</span> <span class="token number">2493792</span><span class="token punctuation">,</span>
    <span class="token property">&quot;space_available_size&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;physical_space_size&quot;</span><span class="token operator">:</span> <span class="token number">3090560</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;space_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;code_space&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;space_size&quot;</span><span class="token operator">:</span> <span class="token number">1260160</span><span class="token punctuation">,</span>
    <span class="token property">&quot;space_used_size&quot;</span><span class="token operator">:</span> <span class="token number">644256</span><span class="token punctuation">,</span>
    <span class="token property">&quot;space_available_size&quot;</span><span class="token operator">:</span> <span class="token number">960</span><span class="token punctuation">,</span>
    <span class="token property">&quot;physical_space_size&quot;</span><span class="token operator">:</span> <span class="token number">1260160</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;space_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;map_space&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;space_size&quot;</span><span class="token operator">:</span> <span class="token number">1094160</span><span class="token punctuation">,</span>
    <span class="token property">&quot;space_used_size&quot;</span><span class="token operator">:</span> <span class="token number">201608</span><span class="token punctuation">,</span>
    <span class="token property">&quot;space_available_size&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;physical_space_size&quot;</span><span class="token operator">:</span> <span class="token number">1094160</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;space_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;large_object_space&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;space_size&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;space_used_size&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;space_available_size&quot;</span><span class="token operator">:</span> <span class="token number">1490980608</span><span class="token punctuation">,</span>
    <span class="token property">&quot;physical_space_size&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><h2 id="v8-getheapsnapshot"><a href="#v8-getheapsnapshot" class="header-anchor">#</a> v8.getHeapSnapshot()</h2> <ul><li>Returns: {stream.Readable} A Readable Stream containing the V8 heap snapshot</li></ul> <p>Generates a snapshot of the current V8 heap and returns a Readable
Stream that may be used to read the JSON serialized representation.
This JSON stream format is intended to be used with tools such as
Chrome DevTools. The JSON schema is undocumented and specific to the
V8 engine, and may change from one version of V8 to the next.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> stream <span class="token operator">=</span> v8<span class="token punctuation">.</span><span class="token function">getHeapSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stream<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>stdout<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="v8-getheapstatistics"><a href="#v8-getheapstatistics" class="header-anchor">#</a> v8.getHeapStatistics()</h2> <ul><li>Returns: {Object}</li></ul> <p>Returns an object with the following properties:</p> <ul><li><code>total_heap_size</code> {number}</li> <li><code>total_heap_size_executable</code> {number}</li> <li><code>total_physical_size</code> {number}</li> <li><code>total_available_size</code> {number}</li> <li><code>used_heap_size</code> {number}</li> <li><code>heap_size_limit</code> {number}</li> <li><code>malloced_memory</code> {number}</li> <li><code>peak_malloced_memory</code> {number}</li> <li><code>does_zap_garbage</code> {number}</li> <li><code>number_of_native_contexts</code> {number}</li> <li><code>number_of_detached_contexts</code> {number}</li></ul> <p><code>does_zap_garbage</code> is a 0/1 boolean, which signifies whether the
<code>--zap_code_space</code> option is enabled or not. This makes V8 overwrite heap
garbage with a bit pattern. The RSS footprint (resident memory set) gets bigger
because it continuously touches all heap pages and that makes them less likely
to get swapped out by the operating system.</p> <p><code>number_of_native_contexts</code> The value of native_context is the number of the
top-level contexts currently active. Increase of this number over time indicates
a memory leak.</p> <p><code>number_of_detached_contexts</code> The value of detached_context is the number
of contexts that were detached and not yet garbage collected. This number
being non-zero indicates a potential memory leak.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  total_heap_size<span class="token punctuation">:</span> <span class="token number">7326976</span><span class="token punctuation">,</span>
  total_heap_size_executable<span class="token punctuation">:</span> <span class="token number">4194304</span><span class="token punctuation">,</span>
  total_physical_size<span class="token punctuation">:</span> <span class="token number">7326976</span><span class="token punctuation">,</span>
  total_available_size<span class="token punctuation">:</span> <span class="token number">1152656</span><span class="token punctuation">,</span>
  used_heap_size<span class="token punctuation">:</span> <span class="token number">3476208</span><span class="token punctuation">,</span>
  heap_size_limit<span class="token punctuation">:</span> <span class="token number">1535115264</span><span class="token punctuation">,</span>
  malloced_memory<span class="token punctuation">:</span> <span class="token number">16384</span><span class="token punctuation">,</span>
  peak_malloced_memory<span class="token punctuation">:</span> <span class="token number">1127496</span><span class="token punctuation">,</span>
  does_zap_garbage<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  number_of_native_contexts<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  number_of_detached_contexts<span class="token punctuation">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="v8-getheapcodestatistics"><a href="#v8-getheapcodestatistics" class="header-anchor">#</a> v8.getHeapCodeStatistics()</h2> <ul><li>Returns: {Object}</li></ul> <p>Returns an object with the following properties:</p> <ul><li><code>code_and_metadata_size</code> {number}</li> <li><code>bytecode_and_metadata_size</code> {number}</li> <li><code>external_script_source_size</code> {number}</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  code_and_metadata_size<span class="token punctuation">:</span> <span class="token number">212208</span><span class="token punctuation">,</span>
  bytecode_and_metadata_size<span class="token punctuation">:</span> <span class="token number">161368</span><span class="token punctuation">,</span>
  external_script_source_size<span class="token punctuation">:</span> <span class="token number">1410794</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="v8-setflagsfromstring-flags"><a href="#v8-setflagsfromstring-flags" class="header-anchor">#</a> v8.setFlagsFromString(flags)</h2> <ul><li><code>flags</code> {string}</li></ul> <p>The <code>v8.setFlagsFromString()</code> method can be used to programmatically set
V8 command line flags. This method should be used with care. Changing settings
after the VM has started may result in unpredictable behavior, including
crashes and data loss; or it may simply do nothing.</p> <p>The V8 options available for a version of Node.js may be determined by running
<code>node --v8-options</code>.</p> <p>Usage:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Print GC events to stdout for one minute.</span>
<span class="token keyword">const</span> v8 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'v8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
v8<span class="token punctuation">.</span><span class="token function">setFlagsFromString</span><span class="token punctuation">(</span><span class="token string">'--trace_gc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> v8<span class="token punctuation">.</span><span class="token function">setFlagsFromString</span><span class="token punctuation">(</span><span class="token string">'--notrace_gc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">60e3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="v8-writeheapsnapshot-filename"><a href="#v8-writeheapsnapshot-filename" class="header-anchor">#</a> v8.writeHeapSnapshot([filename])</h2> <ul><li><code>filename</code> {string} The file path where the V8 heap snapshot is to be
saved. If not specified, a file name with the pattern
<code>'Heap-${yyyymmdd}-${hhmmss}-${pid}-${thread_id}.heapsnapshot'</code> will be
generated, where <code>{pid}</code> will be the PID of the Node.js process,
<code>{thread_id}</code> will be <code>0</code> when <code>writeHeapSnapshot()</code> is called from
the main Node.js thread or the id of a worker thread.</li> <li>Returns: {string} The filename where the snapshot was saved.</li></ul> <p>Generates a snapshot of the current V8 heap and writes it to a JSON
file. This file is intended to be used with tools such as Chrome
DevTools. The JSON schema is undocumented and specific to the V8
engine, and may change from one version of V8 to the next.</p> <p>A heap snapshot is specific to a single V8 isolate. When using
<a href="/public/blog/node/worker_threads.html">Worker Threads</a>, a heap snapshot generated from the main thread will
not contain any information about the workers, and vice versa.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> writeHeapSnapshot <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'v8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>
  Worker<span class="token punctuation">,</span>
  isMainThread<span class="token punctuation">,</span>
  parentPort
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'worker_threads'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>isMainThread<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span><span class="token punctuation">;</span>

  worker<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">filename</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">worker heapdump: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Now get a heapdump for the main thread.</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">main thread heapdump: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">writeHeapSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Tell the worker to create a heapdump.</span>
  worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'heapdump'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  parentPort<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>message <span class="token operator">===</span> <span class="token string">'heapdump'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Generate a heapdump for the worker</span>
      <span class="token comment">// and return the filename to the parent.</span>
      parentPort<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token function">writeHeapSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="serialization-api"><a href="#serialization-api" class="header-anchor">#</a> Serialization API</h2> <p>The serialization API provides means of serializing JavaScript values in a way
that is compatible with the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm" target="_blank" rel="noopener noreferrer">HTML structured clone algorithm<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.
The format is backward-compatible (i.e. safe to store to disk).</p> <p>This API is under development, and changes (including incompatible
changes to the API or wire format) may occur until this warning is removed.</p> <h3 id="v8-serialize-value"><a href="#v8-serialize-value" class="header-anchor">#</a> v8.serialize(value)</h3> <ul><li><code>value</code> {any}</li> <li>Returns: {Buffer}</li></ul> <p>Uses a <a href="#v8_class_v8_defaultserializer"><code>DefaultSerializer</code></a> to serialize <code>value</code> into a buffer.</p> <h3 id="v8-deserialize-buffer"><a href="#v8-deserialize-buffer" class="header-anchor">#</a> v8.deserialize(buffer)</h3> <ul><li><code>buffer</code> {Buffer|TypedArray|DataView} A buffer returned by <a href="#v8_v8_serialize_value"><code>serialize()</code></a>.</li></ul> <p>Uses a <a href="#v8_class_v8_defaultdeserializer"><code>DefaultDeserializer</code></a> with default options to read a JS value
from a buffer.</p> <h3 id="class-v8-serializer"><a href="#class-v8-serializer" class="header-anchor">#</a> class: v8.Serializer</h3> <h4 id="new-serializer"><a href="#new-serializer" class="header-anchor">#</a> new Serializer()</h4> <p>Creates a new <code>Serializer</code> object.</p> <h4 id="serializer-writeheader"><a href="#serializer-writeheader" class="header-anchor">#</a> serializer.writeHeader()</h4> <p>Writes out a header, which includes the serialization format version.</p> <h4 id="serializer-writevalue-value"><a href="#serializer-writevalue-value" class="header-anchor">#</a> serializer.writeValue(value)</h4> <ul><li><code>value</code> {any}</li></ul> <p>Serializes a JavaScript value and adds the serialized representation to the
internal buffer.</p> <p>This throws an error if <code>value</code> cannot be serialized.</p> <h4 id="serializer-releasebuffer"><a href="#serializer-releasebuffer" class="header-anchor">#</a> serializer.releaseBuffer()</h4> <ul><li>Returns: {Buffer}</li></ul> <p>Returns the stored internal buffer. This serializer should not be used once
the buffer is released. Calling this method results in undefined behavior
if a previous write has failed.</p> <h4 id="serializer-transferarraybuffer-id-arraybuffer"><a href="#serializer-transferarraybuffer-id-arraybuffer" class="header-anchor">#</a> serializer.transferArrayBuffer(id, arrayBuffer)</h4> <ul><li><code>id</code> {integer} A 32-bit unsigned integer.</li> <li><code>arrayBuffer</code> {ArrayBuffer} An <code>ArrayBuffer</code> instance.</li></ul> <p>Marks an <code>ArrayBuffer</code> as having its contents transferred out of band.
Pass the corresponding <code>ArrayBuffer</code> in the deserializing context to
<a href="#v8_deserializer_transferarraybuffer_id_arraybuffer"><code>deserializer.transferArrayBuffer()</code></a>.</p> <h4 id="serializer-writeuint32-value"><a href="#serializer-writeuint32-value" class="header-anchor">#</a> serializer.writeUint32(value)</h4> <ul><li><code>value</code> {integer}</li></ul> <p>Write a raw 32-bit unsigned integer.
For use inside of a custom <a href="#v8_serializer_writehostobject_object"><code>serializer._writeHostObject()</code></a>.</p> <h4 id="serializer-writeuint64-hi-lo"><a href="#serializer-writeuint64-hi-lo" class="header-anchor">#</a> serializer.writeUint64(hi, lo)</h4> <ul><li><code>hi</code> {integer}</li> <li><code>lo</code> {integer}</li></ul> <p>Write a raw 64-bit unsigned integer, split into high and low 32-bit parts.
For use inside of a custom <a href="#v8_serializer_writehostobject_object"><code>serializer._writeHostObject()</code></a>.</p> <h4 id="serializer-writedouble-value"><a href="#serializer-writedouble-value" class="header-anchor">#</a> serializer.writeDouble(value)</h4> <ul><li><code>value</code> {number}</li></ul> <p>Write a JS <code>number</code> value.
For use inside of a custom <a href="#v8_serializer_writehostobject_object"><code>serializer._writeHostObject()</code></a>.</p> <h4 id="serializer-writerawbytes-buffer"><a href="#serializer-writerawbytes-buffer" class="header-anchor">#</a> serializer.writeRawBytes(buffer)</h4> <ul><li><code>buffer</code> {Buffer|TypedArray|DataView}</li></ul> <p>Write raw bytes into the serializer’s internal buffer. The deserializer
will require a way to compute the length of the buffer.
For use inside of a custom <a href="#v8_serializer_writehostobject_object"><code>serializer._writeHostObject()</code></a>.</p> <h4 id="serializer-writehostobject-object"><a href="#serializer-writehostobject-object" class="header-anchor">#</a> serializer._writeHostObject(object)</h4> <ul><li><code>object</code> {Object}</li></ul> <p>This method is called to write some kind of host object, i.e. an object created
by native C++ bindings. If it is not possible to serialize <code>object</code>, a suitable
exception should be thrown.</p> <p>This method is not present on the <code>Serializer</code> class itself but can be provided
by subclasses.</p> <h4 id="serializer-getdatacloneerror-message"><a href="#serializer-getdatacloneerror-message" class="header-anchor">#</a> serializer._getDataCloneError(message)</h4> <ul><li><code>message</code> {string}</li></ul> <p>This method is called to generate error objects that will be thrown when an
object can not be cloned.</p> <p>This method defaults to the <a href="/public/blog/node/errors.html#errors_class_error"><code>Error</code></a> constructor and can be overridden on
subclasses.</p> <h4 id="serializer-getsharedarraybufferid-sharedarraybuffer"><a href="#serializer-getsharedarraybufferid-sharedarraybuffer" class="header-anchor">#</a> serializer._getSharedArrayBufferId(sharedArrayBuffer)</h4> <ul><li><code>sharedArrayBuffer</code> {SharedArrayBuffer}</li></ul> <p>This method is called when the serializer is going to serialize a
<code>SharedArrayBuffer</code> object. It must return an unsigned 32-bit integer ID for
the object, using the same ID if this <code>SharedArrayBuffer</code> has already been
serialized. When deserializing, this ID will be passed to
<a href="#v8_deserializer_transferarraybuffer_id_arraybuffer"><code>deserializer.transferArrayBuffer()</code></a>.</p> <p>If the object cannot be serialized, an exception should be thrown.</p> <p>This method is not present on the <code>Serializer</code> class itself but can be provided
by subclasses.</p> <h4 id="serializer-settreatarraybufferviewsashostobjects-flag"><a href="#serializer-settreatarraybufferviewsashostobjects-flag" class="header-anchor">#</a> serializer._setTreatArrayBufferViewsAsHostObjects(flag)</h4> <ul><li><code>flag</code> {boolean} <strong>Default:</strong> <code>false</code></li></ul> <p>Indicate whether to treat <code>TypedArray</code> and <code>DataView</code> objects as
host objects, i.e. pass them to <a href="#v8_serializer_writehostobject_object"><code>serializer._writeHostObject()</code></a>.</p> <h3 id="class-v8-deserializer"><a href="#class-v8-deserializer" class="header-anchor">#</a> class: v8.Deserializer</h3> <h4 id="new-deserializer-buffer"><a href="#new-deserializer-buffer" class="header-anchor">#</a> new Deserializer(buffer)</h4> <ul><li><code>buffer</code> {Buffer|TypedArray|DataView} A buffer returned by
<a href="#v8_serializer_releasebuffer"><code>serializer.releaseBuffer()</code></a>.</li></ul> <p>Creates a new <code>Deserializer</code> object.</p> <h4 id="deserializer-readheader"><a href="#deserializer-readheader" class="header-anchor">#</a> deserializer.readHeader()</h4> <p>Reads and validates a header (including the format version).
May, for example, reject an invalid or unsupported wire format. In that case,
an <code>Error</code> is thrown.</p> <h4 id="deserializer-readvalue"><a href="#deserializer-readvalue" class="header-anchor">#</a> deserializer.readValue()</h4> <p>Deserializes a JavaScript value from the buffer and returns it.</p> <h4 id="deserializer-transferarraybuffer-id-arraybuffer"><a href="#deserializer-transferarraybuffer-id-arraybuffer" class="header-anchor">#</a> deserializer.transferArrayBuffer(id, arrayBuffer)</h4> <ul><li><code>id</code> {integer} A 32-bit unsigned integer.</li> <li><code>arrayBuffer</code> {ArrayBuffer|SharedArrayBuffer} An <code>ArrayBuffer</code> instance.</li></ul> <p>Marks an <code>ArrayBuffer</code> as having its contents transferred out of band.
Pass the corresponding <code>ArrayBuffer</code> in the serializing context to
<a href="#v8_serializer_transferarraybuffer_id_arraybuffer"><code>serializer.transferArrayBuffer()</code></a> (or return the <code>id</code> from
<a href="#v8_serializer_getsharedarraybufferid_sharedarraybuffer"><code>serializer._getSharedArrayBufferId()</code></a> in the case of <code>SharedArrayBuffer</code>s).</p> <h4 id="deserializer-getwireformatversion"><a href="#deserializer-getwireformatversion" class="header-anchor">#</a> deserializer.getWireFormatVersion()</h4> <ul><li>Returns: {integer}</li></ul> <p>Reads the underlying wire format version. Likely mostly to be useful to
legacy code reading old wire format versions. May not be called before
<code>.readHeader()</code>.</p> <h4 id="deserializer-readuint32"><a href="#deserializer-readuint32" class="header-anchor">#</a> deserializer.readUint32()</h4> <ul><li>Returns: {integer}</li></ul> <p>Read a raw 32-bit unsigned integer and return it.
For use inside of a custom <a href="#v8_deserializer_readhostobject"><code>deserializer._readHostObject()</code></a>.</p> <h4 id="deserializer-readuint64"><a href="#deserializer-readuint64" class="header-anchor">#</a> deserializer.readUint64()</h4> <ul><li>Returns: {integer[]}</li></ul> <p>Read a raw 64-bit unsigned integer and return it as an array <code>[hi, lo]</code>
with two 32-bit unsigned integer entries.
For use inside of a custom <a href="#v8_deserializer_readhostobject"><code>deserializer._readHostObject()</code></a>.</p> <h4 id="deserializer-readdouble"><a href="#deserializer-readdouble" class="header-anchor">#</a> deserializer.readDouble()</h4> <ul><li>Returns: {number}</li></ul> <p>Read a JS <code>number</code> value.
For use inside of a custom <a href="#v8_deserializer_readhostobject"><code>deserializer._readHostObject()</code></a>.</p> <h4 id="deserializer-readrawbytes-length"><a href="#deserializer-readrawbytes-length" class="header-anchor">#</a> deserializer.readRawBytes(length)</h4> <ul><li><code>length</code> {integer}</li> <li>Returns: {Buffer}</li></ul> <p>Read raw bytes from the deserializer’s internal buffer. The <code>length</code> parameter
must correspond to the length of the buffer that was passed to
<a href="#v8_serializer_writerawbytes_buffer"><code>serializer.writeRawBytes()</code></a>.
For use inside of a custom <a href="#v8_deserializer_readhostobject"><code>deserializer._readHostObject()</code></a>.</p> <h4 id="deserializer-readhostobject"><a href="#deserializer-readhostobject" class="header-anchor">#</a> deserializer._readHostObject()</h4> <p>This method is called to read some kind of host object, i.e. an object that is
created by native C++ bindings. If it is not possible to deserialize the data,
a suitable exception should be thrown.</p> <p>This method is not present on the <code>Deserializer</code> class itself but can be
provided by subclasses.</p> <h3 id="class-v8-defaultserializer"><a href="#class-v8-defaultserializer" class="header-anchor">#</a> class: v8.DefaultSerializer</h3> <p>A subclass of <a href="#v8_class_v8_serializer"><code>Serializer</code></a> that serializes <code>TypedArray</code>
(in particular <a href="/public/blog/node/buffer.html"><code>Buffer</code></a>) and <code>DataView</code> objects as host objects, and only
stores the part of their underlying <code>ArrayBuffer</code>s that they are referring to.</p> <h3 id="class-v8-defaultdeserializer"><a href="#class-v8-defaultdeserializer" class="header-anchor">#</a> class: v8.DefaultDeserializer</h3> <p>A subclass of <a href="#v8_class_v8_deserializer"><code>Deserializer</code></a> corresponding to the format written by
<a href="#v8_class_v8_defaultserializer"><code>DefaultSerializer</code></a>.</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/public/blog/assets/js/app.793d18d6.js" defer></script><script src="/public/blog/assets/js/2.d1dd4e4d.js" defer></script><script src="/public/blog/assets/js/59.5ecba546.js" defer></script><script src="/public/blog/assets/js/3.1f730cd9.js" defer></script>
  </body>
</html>
