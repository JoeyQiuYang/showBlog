<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>REPL | QLQ学习平台</title>
    <meta name="description" content="QLQ学习平台">
    <link rel="manifest" href="/public/blog/manifest.json">
    
    <link rel="preload" href="/public/blog/assets/css/0.styles.3ad33863.css" as="style"><link rel="preload" href="/public/blog/assets/js/app.793d18d6.js" as="script"><link rel="preload" href="/public/blog/assets/js/2.d1dd4e4d.js" as="script"><link rel="preload" href="/public/blog/assets/js/48.84db573a.js" as="script"><link rel="preload" href="/public/blog/assets/js/3.1f730cd9.js" as="script"><link rel="prefetch" href="/public/blog/assets/js/10.7d4b1d4b.js"><link rel="prefetch" href="/public/blog/assets/js/11.c135c766.js"><link rel="prefetch" href="/public/blog/assets/js/12.17db24c5.js"><link rel="prefetch" href="/public/blog/assets/js/13.6e07cbcf.js"><link rel="prefetch" href="/public/blog/assets/js/14.ea2a0d07.js"><link rel="prefetch" href="/public/blog/assets/js/15.a6a7563b.js"><link rel="prefetch" href="/public/blog/assets/js/16.956a9122.js"><link rel="prefetch" href="/public/blog/assets/js/17.06ff4bf4.js"><link rel="prefetch" href="/public/blog/assets/js/18.a604e43f.js"><link rel="prefetch" href="/public/blog/assets/js/19.43fdc1b1.js"><link rel="prefetch" href="/public/blog/assets/js/20.faad6d2d.js"><link rel="prefetch" href="/public/blog/assets/js/21.554b2f54.js"><link rel="prefetch" href="/public/blog/assets/js/22.961d3c7f.js"><link rel="prefetch" href="/public/blog/assets/js/23.98032a48.js"><link rel="prefetch" href="/public/blog/assets/js/24.735ada0c.js"><link rel="prefetch" href="/public/blog/assets/js/25.151f485c.js"><link rel="prefetch" href="/public/blog/assets/js/26.f3d12769.js"><link rel="prefetch" href="/public/blog/assets/js/27.d91bf872.js"><link rel="prefetch" href="/public/blog/assets/js/28.2a36a68f.js"><link rel="prefetch" href="/public/blog/assets/js/29.78b1b45d.js"><link rel="prefetch" href="/public/blog/assets/js/30.7481d4c5.js"><link rel="prefetch" href="/public/blog/assets/js/31.16e7c775.js"><link rel="prefetch" href="/public/blog/assets/js/32.75fed837.js"><link rel="prefetch" href="/public/blog/assets/js/33.cf2e0b8f.js"><link rel="prefetch" href="/public/blog/assets/js/34.4221897d.js"><link rel="prefetch" href="/public/blog/assets/js/35.97e4fc88.js"><link rel="prefetch" href="/public/blog/assets/js/36.137598cd.js"><link rel="prefetch" href="/public/blog/assets/js/37.9b12e9de.js"><link rel="prefetch" href="/public/blog/assets/js/38.8d385bd4.js"><link rel="prefetch" href="/public/blog/assets/js/39.c2d2376a.js"><link rel="prefetch" href="/public/blog/assets/js/4.a6ed393e.js"><link rel="prefetch" href="/public/blog/assets/js/40.a2197e85.js"><link rel="prefetch" href="/public/blog/assets/js/41.6e6eb90b.js"><link rel="prefetch" href="/public/blog/assets/js/42.ba8fc1fa.js"><link rel="prefetch" href="/public/blog/assets/js/43.561011ab.js"><link rel="prefetch" href="/public/blog/assets/js/44.0e624559.js"><link rel="prefetch" href="/public/blog/assets/js/45.31eb2ed7.js"><link rel="prefetch" href="/public/blog/assets/js/46.33d8378f.js"><link rel="prefetch" href="/public/blog/assets/js/47.18b18711.js"><link rel="prefetch" href="/public/blog/assets/js/49.e007afae.js"><link rel="prefetch" href="/public/blog/assets/js/5.868620b4.js"><link rel="prefetch" href="/public/blog/assets/js/50.05e06075.js"><link rel="prefetch" href="/public/blog/assets/js/51.28689d1c.js"><link rel="prefetch" href="/public/blog/assets/js/52.84b0ef5c.js"><link rel="prefetch" href="/public/blog/assets/js/53.693b991f.js"><link rel="prefetch" href="/public/blog/assets/js/54.3ebbd2e5.js"><link rel="prefetch" href="/public/blog/assets/js/55.c466c411.js"><link rel="prefetch" href="/public/blog/assets/js/56.02fb13e9.js"><link rel="prefetch" href="/public/blog/assets/js/57.a0811a6e.js"><link rel="prefetch" href="/public/blog/assets/js/58.ef3c4301.js"><link rel="prefetch" href="/public/blog/assets/js/59.5ecba546.js"><link rel="prefetch" href="/public/blog/assets/js/6.8e0ec0a1.js"><link rel="prefetch" href="/public/blog/assets/js/60.41e35580.js"><link rel="prefetch" href="/public/blog/assets/js/61.51154b06.js"><link rel="prefetch" href="/public/blog/assets/js/62.e557785e.js"><link rel="prefetch" href="/public/blog/assets/js/63.6ee35392.js"><link rel="prefetch" href="/public/blog/assets/js/64.5bb83569.js"><link rel="prefetch" href="/public/blog/assets/js/65.b26f077a.js"><link rel="prefetch" href="/public/blog/assets/js/7.287519a5.js"><link rel="prefetch" href="/public/blog/assets/js/8.ad4df861.js"><link rel="prefetch" href="/public/blog/assets/js/9.ef0461e8.js">
    <link rel="stylesheet" href="/public/blog/assets/css/0.styles.3ad33863.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/public/blog/" class="home-link router-link-active"><!----> <span class="site-name">QLQ学习平台</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/public/blog/js/regexp.html" class="nav-link">javaScript</a></div><div class="nav-item"><a href="/public/blog/css/bfc.html" class="nav-link">css</a></div><div class="nav-item"><a href="/public/blog/webpack/base-config.html" class="nav-link">webpack</a></div><div class="nav-item"><a href="/public/blog/node/nodemon.html" class="nav-link">node</a></div><div class="nav-item"><a href="/public/blog/fragment/angular.html" class="nav-link">js框架</a></div><div class="nav-item"><a href="/public/blog/pwa/PWA.html" class="nav-link">pwa</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/public/blog/js/regexp.html" class="nav-link">javaScript</a></div><div class="nav-item"><a href="/public/blog/css/bfc.html" class="nav-link">css</a></div><div class="nav-item"><a href="/public/blog/webpack/base-config.html" class="nav-link">webpack</a></div><div class="nav-item"><a href="/public/blog/node/nodemon.html" class="nav-link">node</a></div><div class="nav-item"><a href="/public/blog/fragment/angular.html" class="nav-link">js框架</a></div><div class="nav-item"><a href="/public/blog/pwa/PWA.html" class="nav-link">pwa</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>node</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/public/blog/node/buffer.html" class="sidebar-link">Buffer</a></li><li><a href="/public/blog/node/stream.html" class="sidebar-link">Stream</a></li><li><a href="/public/blog/node/nodemon.html" class="sidebar-link">nodemon：高效的nodejs开发环境</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="repl"><a href="#repl" class="header-anchor">#</a> REPL</h1> <blockquote><p>Stability: 2 - Stable</p></blockquote> <p>The <code>repl</code> module provides a Read-Eval-Print-Loop (REPL) implementation that
is available both as a standalone program or includible in other applications.
It can be accessed using:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> repl <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'repl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="design-and-features"><a href="#design-and-features" class="header-anchor">#</a> Design and Features</h2> <p>The <code>repl</code> module exports the <a href="#repl_class_replserver"><code>repl.REPLServer</code></a> class. While running,
instances of <a href="#repl_class_replserver"><code>repl.REPLServer</code></a> will accept individual lines of user input,
evaluate those according to a user-defined evaluation function, then output the
result. Input and output may be from <code>stdin</code> and <code>stdout</code>, respectively, or may
be connected to any Node.js <a href="/public/blog/node/stream.html">stream</a>.</p> <p>Instances of <a href="#repl_class_replserver"><code>repl.REPLServer</code></a> support automatic completion of inputs,
simplistic Emacs-style line editing, multi-line inputs, ANSI-styled output,
saving and restoring current REPL session state, error recovery, and
customizable evaluation functions.</p> <h3 id="commands-and-special-keys"><a href="#commands-and-special-keys" class="header-anchor">#</a> Commands and Special Keys</h3> <p>The following special commands are supported by all REPL instances:</p> <ul><li><code>.break</code>: When in the process of inputting a multi-line expression, entering
the <code>.break</code> command (or pressing the <code>&lt;ctrl&gt;-C</code> key combination) will abort
further input or processing of that expression.</li> <li><code>.clear</code>: Resets the REPL <code>context</code> to an empty object and clears any
multi-line expression currently being input.</li> <li><code>.exit</code>: Close the I/O stream, causing the REPL to exit.</li> <li><code>.help</code>: Show this list of special commands.</li> <li><code>.save</code>: Save the current REPL session to a file:
<code>&gt; .save ./file/to/save.js</code></li> <li><code>.load</code>: Load a file into the current REPL session.
<code>&gt; .load ./file/to/load.js</code></li> <li><code>.editor</code>: Enter editor mode (<code>&lt;ctrl&gt;-D</code> to finish, <code>&lt;ctrl&gt;-C</code> to cancel).</li></ul> <div class="language-console extra-class"><pre class="language-text"><code>&gt; .editor
// Entering editor mode (^D to finish, ^C to cancel)
function welcome(name) {
  return `Hello ${name}!`;
}

welcome('Node.js User');

// ^D
'Hello Node.js User!'
&gt;
</code></pre></div><p>The following key combinations in the REPL have these special effects:</p> <ul><li><code>&lt;ctrl&gt;-C</code>: When pressed once, has the same effect as the <code>.break</code> command.
When pressed twice on a blank line, has the same effect as the <code>.exit</code>
command.</li> <li><code>&lt;ctrl&gt;-D</code>: Has the same effect as the <code>.exit</code> command.</li> <li><code>&lt;tab&gt;</code>: When pressed on a blank line, displays global and local (scope)
variables. When pressed while entering other input, displays relevant
autocompletion options.</li></ul> <h3 id="default-evaluation"><a href="#default-evaluation" class="header-anchor">#</a> Default Evaluation</h3> <p>By default, all instances of <a href="#repl_class_replserver"><code>repl.REPLServer</code></a> use an evaluation function
that evaluates JavaScript expressions and provides access to Node.js' built-in
modules. This default behavior can be overridden by passing in an alternative
evaluation function when the <a href="#repl_class_replserver"><code>repl.REPLServer</code></a> instance is created.</p> <h4 id="javascript-expressions"><a href="#javascript-expressions" class="header-anchor">#</a> JavaScript Expressions</h4> <p>The default evaluator supports direct evaluation of JavaScript expressions:</p> <div class="language-console extra-class"><pre class="language-text"><code>&gt; 1 + 1
2
&gt; const m = 2
undefined
&gt; m + 1
3
</code></pre></div><p>Unless otherwise scoped within blocks or functions, variables declared
either implicitly or using the <code>const</code>, <code>let</code>, or <code>var</code> keywords
are declared at the global scope.</p> <h4 id="global-and-local-scope"><a href="#global-and-local-scope" class="header-anchor">#</a> Global and Local Scope</h4> <p>The default evaluator provides access to any variables that exist in the global
scope. It is possible to expose a variable to the REPL explicitly by assigning
it to the <code>context</code> object associated with each <code>REPLServer</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> repl <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'repl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token string">'message'</span><span class="token punctuation">;</span>

repl<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">'&gt; '</span><span class="token punctuation">)</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>m <span class="token operator">=</span> msg<span class="token punctuation">;</span>
</code></pre></div><p>Properties in the <code>context</code> object appear as local within the REPL:</p> <div class="language-console extra-class"><pre class="language-text"><code>$ node repl_test.js
&gt; m
'message'
</code></pre></div><p>Context properties are not read-only by default. To specify read-only globals,
context properties must be defined using <code>Object.defineProperty()</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> repl <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'repl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token string">'message'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> r <span class="token operator">=</span> repl<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">'&gt; '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>context<span class="token punctuation">,</span> <span class="token string">'m'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  configurable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  enumerable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  value<span class="token punctuation">:</span> msg
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="accessing-core-node-js-modules"><a href="#accessing-core-node-js-modules" class="header-anchor">#</a> Accessing Core Node.js Modules</h4> <p>The default evaluator will automatically load Node.js core modules into the
REPL environment when used. For instance, unless otherwise declared as a
global or scoped variable, the input <code>fs</code> will be evaluated on-demand as
<code>global.fs = require('fs')</code>.</p> <div class="language-console extra-class"><pre class="language-text"><code>&gt; fs.createReadStream('./some/file');
</code></pre></div><h4 id="global-uncaught-exceptions"><a href="#global-uncaught-exceptions" class="header-anchor">#</a> Global Uncaught Exceptions</h4> <p>The REPL uses the <a href="/public/blog/node/domain.html"><code>domain</code></a> module to catch all uncaught exceptions for that
REPL session.</p> <p>This use of the <a href="/public/blog/node/domain.html"><code>domain</code></a> module in the REPL has these side effects:</p> <ul><li>Uncaught exceptions only emit the <a href="/public/blog/node/process.html#process_event_uncaughtexception"><code>'uncaughtException'</code></a> event if the
<code>repl</code> is used as standalone program. If the <code>repl</code> is included anywhere in
another application, adding a listener for this event will throw an
<a href="/public/blog/node/errors.html#errors_err_invalid_repl_input"><code>ERR_INVALID_REPL_INPUT</code></a> exception.</li> <li>Trying to use <a href="/public/blog/node/process.html#process_process_setuncaughtexceptioncapturecallback_fn"><code>process.setUncaughtExceptionCaptureCallback()</code></a> throws
an <a href="/public/blog/node/errors.html#errors_err_domain_cannot_set_uncaught_exception_capture"><code>ERR_DOMAIN_CANNOT_SET_UNCAUGHT_EXCEPTION_CAPTURE</code></a> error.</li></ul> <p>As standalone program:</p> <div class="language-js extra-class"><pre class="language-js"><code>process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'uncaughtException'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Uncaught'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'foobar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Uncaught</span>
</code></pre></div><p>When used in another application:</p> <div class="language-js extra-class"><pre class="language-js"><code>process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'uncaughtException'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Uncaught'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// TypeError [ERR_INVALID_REPL_INPUT]: Listeners for `uncaughtException`</span>
<span class="token comment">// cannot be used in the REPL</span>

<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'foobar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Thrown:</span>
<span class="token comment">// Error: foobar</span>
</code></pre></div><h4 id="assignment-of-the-underscore-variable"><a href="#assignment-of-the-underscore-variable" class="header-anchor">#</a> Assignment of the <code>_</code> (underscore) variable</h4> <p>The default evaluator will, by default, assign the result of the most recently
evaluated expression to the special variable <code>_</code> (underscore).
Explicitly setting <code>_</code> to a value will disable this behavior.</p> <div class="language-console extra-class"><pre class="language-text"><code>&gt; [ 'a', 'b', 'c' ]
[ 'a', 'b', 'c' ]
&gt; _.length
3
&gt; _ += 1
Expression assignment to _ now disabled.
4
&gt; 1 + 1
2
&gt; _
4
</code></pre></div><p>Similarly, <code>_error</code> will refer to the last seen error, if there was any.
Explicitly setting <code>_error</code> to a value will disable this behavior.</p> <div class="language-console extra-class"><pre class="language-text"><code>&gt; throw new Error('foo');
Error: foo
&gt; _error.message
'foo'
</code></pre></div><h4 id="await-keyword"><a href="#await-keyword" class="header-anchor">#</a> <code>await</code> keyword</h4> <p>With the <a href="/public/blog/node/cli.html#cli_experimental_repl_await"><code>--experimental-repl-await</code></a> command line option specified,
experimental support for the <code>await</code> keyword is enabled.</p> <div class="language-console extra-class"><pre class="language-text"><code>&gt; await Promise.resolve(123)
123
&gt; await Promise.reject(new Error('REPL await'))
Error: REPL await
    at repl:1:45
&gt; const timeout = util.promisify(setTimeout);
undefined
&gt; const old = Date.now(); await timeout(1000); console.log(Date.now() - old);
1002
undefined
</code></pre></div><h3 id="custom-evaluation-functions"><a href="#custom-evaluation-functions" class="header-anchor">#</a> Custom Evaluation Functions</h3> <p>When a new <a href="#repl_class_replserver"><code>repl.REPLServer</code></a> is created, a custom evaluation function may be
provided. This can be used, for instance, to implement fully customized REPL
applications.</p> <p>The following illustrates a hypothetical example of a REPL that performs
translation of text from one language to another:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> repl <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'repl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Translator <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'translator'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> myTranslator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Translator</span><span class="token punctuation">(</span><span class="token string">'en'</span><span class="token punctuation">,</span> <span class="token string">'fr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">myEval</span><span class="token punctuation">(</span><span class="token parameter">cmd<span class="token punctuation">,</span> context<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> myTranslator<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

repl<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span> prompt<span class="token punctuation">:</span> <span class="token string">'&gt; '</span><span class="token punctuation">,</span> eval<span class="token punctuation">:</span> myEval <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="recoverable-errors"><a href="#recoverable-errors" class="header-anchor">#</a> Recoverable Errors</h4> <p>As a user is typing input into the REPL prompt, pressing the <code>&lt;enter&gt;</code> key will
send the current line of input to the <code>eval</code> function. In order to support
multi-line input, the eval function can return an instance of <code>repl.Recoverable</code>
to the provided callback function:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">myEval</span><span class="token punctuation">(</span><span class="token parameter">cmd<span class="token punctuation">,</span> context<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> result<span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    result <span class="token operator">=</span> vm<span class="token punctuation">.</span><span class="token function">runInThisContext</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isRecoverableError</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">repl<span class="token punctuation">.</span>Recoverable</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">isRecoverableError</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'SyntaxError'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">/</span><span class="token operator">^</span><span class="token punctuation">(</span>Unexpected end <span class="token keyword">of</span> input<span class="token operator">|</span>Unexpected token<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="customizing-repl-output"><a href="#customizing-repl-output" class="header-anchor">#</a> Customizing REPL Output</h3> <p>By default, <a href="#repl_class_replserver"><code>repl.REPLServer</code></a> instances format output using the
<a href="/public/blog/node/util.html#util_util_inspect_object_options"><code>util.inspect()</code></a> method before writing the output to the provided <code>Writable</code>
stream (<code>process.stdout</code> by default). The <code>showProxy</code> inspection option is set
to true by default and the <code>colors</code> option is set to true depending on the
REPL's <code>useColors</code> option.</p> <p>The <code>useColors</code> boolean option can be specified at construction to instruct the
default writer to use ANSI style codes to colorize the output from the
<code>util.inspect()</code> method.</p> <p>If the REPL is run as standalone program, it is also possible to change the
REPL's <a href="/public/blog/node/util.html#util_util_inspect_object_options">inspection defaults</a> from inside the REPL by using the
<code>inspect.replDefaults</code> property which mirrors the <code>defaultOptions</code> from
<a href="/public/blog/node/util.html#util_util_inspect_object_options"><code>util.inspect()</code></a>.</p> <div class="language-console extra-class"><pre class="language-text"><code>&gt; util.inspect.replDefaults.compact = false;
false
&gt; [1]
[
  1
]
&gt;
</code></pre></div><p>To fully customize the output of a <a href="#repl_class_replserver"><code>repl.REPLServer</code></a> instance pass in a new
function for the <code>writer</code> option on construction. The following example, for
instance, simply converts any input text to upper case:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> repl <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'repl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> r <span class="token operator">=</span> repl<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span> prompt<span class="token punctuation">:</span> <span class="token string">'&gt; '</span><span class="token punctuation">,</span> eval<span class="token punctuation">:</span> myEval<span class="token punctuation">,</span> writer<span class="token punctuation">:</span> myWriter <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">myEval</span><span class="token punctuation">(</span><span class="token parameter">cmd<span class="token punctuation">,</span> context<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> cmd<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">myWriter</span><span class="token punctuation">(</span><span class="token parameter">output</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> output<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="class-replserver"><a href="#class-replserver" class="header-anchor">#</a> Class: REPLServer</h2> <ul><li>Extends: {readline.Interface}</li></ul> <p>Instances of <code>repl.REPLServer</code> are created using the <code>repl.start()</code> method and
<em>should not</em> be created directly using the JavaScript <code>new</code> keyword.</p> <h3 id="event-exit"><a href="#event-exit" class="header-anchor">#</a> Event: 'exit'</h3> <p>The <code>'exit'</code> event is emitted when the REPL is exited either by receiving the
<code>.exit</code> command as input, the user pressing <code>&lt;ctrl&gt;-C</code> twice to signal <code>SIGINT</code>,
or by pressing <code>&lt;ctrl&gt;-D</code> to signal <code>'end'</code> on the input stream. The listener
callback is invoked without any arguments.</p> <div class="language-js extra-class"><pre class="language-js"><code>replServer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'exit'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Received &quot;exit&quot; event from repl!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="event-reset"><a href="#event-reset" class="header-anchor">#</a> Event: 'reset'</h3> <p>The <code>'reset'</code> event is emitted when the REPL's context is reset. This occurs
whenever the <code>.clear</code> command is received as input <em>unless</em> the REPL is using
the default evaluator and the <code>repl.REPLServer</code> instance was created with the
<code>useGlobal</code> option set to <code>true</code>. The listener callback will be called with a
reference to the <code>context</code> object as the only argument.</p> <p>This can be used primarily to re-initialize REPL context to some pre-defined
state:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> repl <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'repl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">initializeContext</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  context<span class="token punctuation">.</span>m <span class="token operator">=</span> <span class="token string">'test'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> r <span class="token operator">=</span> repl<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span> prompt<span class="token punctuation">:</span> <span class="token string">'&gt; '</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">initializeContext</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>

r<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'reset'</span><span class="token punctuation">,</span> initializeContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>When this code is executed, the global <code>'m'</code> variable can be modified but then
reset to its initial value using the <code>.clear</code> command:</p> <div class="language-console extra-class"><pre class="language-text"><code>$ ./node example.js
&gt; m
'test'
&gt; m = 1
1
&gt; m
1
&gt; .clear
Clearing context...
&gt; m
'test'
&gt;
</code></pre></div><h3 id="replserver-definecommand-keyword-cmd"><a href="#replserver-definecommand-keyword-cmd" class="header-anchor">#</a> replServer.defineCommand(keyword, cmd)</h3> <ul><li><code>keyword</code> {string} The command keyword (<em>without</em> a leading <code>.</code> character).</li> <li><code>cmd</code> {Object|Function} The function to invoke when the command is processed.</li></ul> <p>The <code>replServer.defineCommand()</code> method is used to add new <code>.</code>-prefixed commands
to the REPL instance. Such commands are invoked by typing a <code>.</code> followed by the
<code>keyword</code>. The <code>cmd</code> is either a <code>Function</code> or an <code>Object</code> with the following
properties:</p> <ul><li><code>help</code> {string} Help text to be displayed when <code>.help</code> is entered (Optional).</li> <li><code>action</code> {Function} The function to execute, optionally accepting a single
string argument.</li></ul> <p>The following example shows two new commands added to the REPL instance:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> repl <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'repl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> replServer <span class="token operator">=</span> repl<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span> prompt<span class="token punctuation">:</span> <span class="token string">'&gt; '</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
replServer<span class="token punctuation">.</span><span class="token function">defineCommand</span><span class="token punctuation">(</span><span class="token string">'sayhello'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  help<span class="token punctuation">:</span> <span class="token string">'Say hello'</span><span class="token punctuation">,</span>
  <span class="token function">action</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clearBufferedCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">displayPrompt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
replServer<span class="token punctuation">.</span><span class="token function">defineCommand</span><span class="token punctuation">(</span><span class="token string">'saybye'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">saybye</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Goodbye!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The new commands can then be used from within the REPL instance:</p> <div class="language-console extra-class"><pre class="language-text"><code>&gt; .sayhello Node.js User
Hello, Node.js User!
&gt; .saybye
Goodbye!
</code></pre></div><h3 id="replserver-displayprompt-preservecursor"><a href="#replserver-displayprompt-preservecursor" class="header-anchor">#</a> replServer.displayPrompt([preserveCursor])</h3> <ul><li><code>preserveCursor</code> {boolean}</li></ul> <p>The <code>replServer.displayPrompt()</code> method readies the REPL instance for input
from the user, printing the configured <code>prompt</code> to a new line in the <code>output</code>
and resuming the <code>input</code> to accept new input.</p> <p>When multi-line input is being entered, an ellipsis is printed rather than the
'prompt'.</p> <p>When <code>preserveCursor</code> is <code>true</code>, the cursor placement will not be reset to <code>0</code>.</p> <p>The <code>replServer.displayPrompt</code> method is primarily intended to be called from
within the action function for commands registered using the
<code>replServer.defineCommand()</code> method.</p> <h3 id="replserver-clearbufferedcommand"><a href="#replserver-clearbufferedcommand" class="header-anchor">#</a> replServer.clearBufferedCommand()</h3> <p>The <code>replServer.clearBufferedCommand()</code> method clears any command that has been
buffered but not yet executed. This method is primarily intended to be
called from within the action function for commands registered using the
<code>replServer.defineCommand()</code> method.</p> <h3 id="replserver-parsereplkeyword-keyword-rest"><a href="#replserver-parsereplkeyword-keyword-rest" class="header-anchor">#</a> replServer.parseREPLKeyword(keyword[, rest])</h3> <blockquote><p>Stability: 0 - Deprecated.</p></blockquote> <ul><li><code>keyword</code> {string} the potential keyword to parse and execute</li> <li><code>rest</code> {any} any parameters to the keyword command</li> <li>Returns: {boolean}</li></ul> <p>An internal method used to parse and execute <code>REPLServer</code> keywords.
Returns <code>true</code> if <code>keyword</code> is a valid keyword, otherwise <code>false</code>.</p> <h3 id="replserver-setuphistory-historypath-callback"><a href="#replserver-setuphistory-historypath-callback" class="header-anchor">#</a> replServer.setupHistory(historyPath, callback)</h3> <ul><li><code>historyPath</code> {string} the path to the history file</li> <li><code>callback</code> {Function} called when history writes are ready or upon error
<ul><li><code>err</code> {Error}</li> <li><code>repl</code> {repl.REPLServer}</li></ul></li></ul> <p>Initializes a history log file for the REPL instance. When executing the
Node.js binary and using the command line REPL, a history file is initialized
by default. However, this is not the case when creating a REPL
programmatically. Use this method to initialize a history log file when working
with REPL instances programmatically.</p> <h2 id="repl-start-options"><a href="#repl-start-options" class="header-anchor">#</a> repl.start([options])</h2> <ul><li><code>options</code> {Object|string}
<ul><li><code>prompt</code> {string} The input prompt to display. <strong>Default:</strong> <code>'&gt; '</code>
(with a trailing space).</li> <li><code>input</code> {stream.Readable} The <code>Readable</code> stream from which REPL input will
be read. <strong>Default:</strong> <code>process.stdin</code>.</li> <li><code>output</code> {stream.Writable} The <code>Writable</code> stream to which REPL output will
be written. <strong>Default:</strong> <code>process.stdout</code>.</li> <li><code>terminal</code> {boolean} If <code>true</code>, specifies that the <code>output</code> should be
treated as a TTY terminal.
<strong>Default:</strong> checking the value of the <code>isTTY</code> property on the <code>output</code>
stream upon instantiation.</li> <li><code>eval</code> {Function} The function to be used when evaluating each given line
of input. <strong>Default:</strong> an async wrapper for the JavaScript <code>eval()</code>
function. An <code>eval</code> function can error with <code>repl.Recoverable</code> to indicate
the input was incomplete and prompt for additional lines.</li> <li><code>useColors</code> {boolean} If <code>true</code>, specifies that the default <code>writer</code>
function should include ANSI color styling to REPL output. If a custom
<code>writer</code> function is provided then this has no effect. <strong>Default:</strong> checking
color support on the <code>output</code> stream if the REPL instance's <code>terminal</code> value
is <code>true</code>.</li> <li><code>useGlobal</code> {boolean} If <code>true</code>, specifies that the default evaluation
function will use the JavaScript <code>global</code> as the context as opposed to
creating a new separate context for the REPL instance. The node CLI REPL
sets this value to <code>true</code>. <strong>Default:</strong> <code>false</code>.</li> <li><code>ignoreUndefined</code> {boolean} If <code>true</code>, specifies that the default writer
will not output the return value of a command if it evaluates to
<code>undefined</code>. <strong>Default:</strong> <code>false</code>.</li> <li><code>writer</code> {Function} The function to invoke to format the output of each
command before writing to <code>output</code>. <strong>Default:</strong> <a href="/public/blog/node/util.html#util_util_inspect_object_options"><code>util.inspect()</code></a>.</li> <li><code>completer</code> {Function} An optional function used for custom Tab auto
completion. See <a href="/public/blog/node/readline.html#readline_use_of_the_completer_function"><code>readline.InterfaceCompleter</code></a> for an example.</li> <li><code>replMode</code> {symbol} A flag that specifies whether the default evaluator
executes all JavaScript commands in strict mode or default (sloppy) mode.
Acceptable values are:
<ul><li><code>repl.REPL_MODE_SLOPPY</code> to evaluate expressions in sloppy mode.</li> <li><code>repl.REPL_MODE_STRICT</code> to evaluate expressions in strict mode. This is
equivalent to prefacing every repl statement with <code>'use strict'</code>.</li></ul></li> <li><code>breakEvalOnSigint</code> {boolean} Stop evaluating the current piece of code when
<code>SIGINT</code> is received, such as when <code>Ctrl+C</code> is pressed. This cannot be used
together with a custom <code>eval</code> function. <strong>Default:</strong> <code>false</code>.</li></ul></li> <li>Returns: {repl.REPLServer}</li></ul> <p>The <code>repl.start()</code> method creates and starts a <a href="#repl_class_replserver"><code>repl.REPLServer</code></a> instance.</p> <p>If <code>options</code> is a string, then it specifies the input prompt:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> repl <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'repl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// a Unix style prompt</span>
repl<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">'$ '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="the-node-js-repl"><a href="#the-node-js-repl" class="header-anchor">#</a> The Node.js REPL</h2> <p>Node.js itself uses the <code>repl</code> module to provide its own interactive interface
for executing JavaScript. This can be used by executing the Node.js binary
without passing any arguments (or by passing the <code>-i</code> argument):</p> <div class="language-console extra-class"><pre class="language-text"><code>$ node
&gt; const a = [1, 2, 3];
undefined
&gt; a
[ 1, 2, 3 ]
&gt; a.forEach((v) =&gt; {
...   console.log(v);
...   });
1
2
3
</code></pre></div><h3 id="environment-variable-options"><a href="#environment-variable-options" class="header-anchor">#</a> Environment Variable Options</h3> <p>Various behaviors of the Node.js REPL can be customized using the following
environment variables:</p> <ul><li><code>NODE_REPL_HISTORY</code>: When a valid path is given, persistent REPL history
will be saved to the specified file rather than <code>.node_repl_history</code> in the
user's home directory. Setting this value to <code>''</code> (an empty string) will
disable persistent REPL history. Whitespace will be trimmed from the value.
On Windows platforms environment variables with empty values are invalid so
set this variable to one or more spaces to disable persistent REPL history.</li> <li><code>NODE_REPL_HISTORY_SIZE</code>: Controls how many lines of history will be
persisted if history is available. Must be a positive number.
<strong>Default:</strong> <code>1000</code>.</li> <li><code>NODE_REPL_MODE</code>: May be either <code>'sloppy'</code> or <code>'strict'</code>. <strong>Default:</strong> <code>'sloppy'</code>, which will allow non-strict mode code to be run.</li></ul> <h3 id="persistent-history"><a href="#persistent-history" class="header-anchor">#</a> Persistent History</h3> <p>By default, the Node.js REPL will persist history between <code>node</code> REPL sessions
by saving inputs to a <code>.node_repl_history</code> file located in the user's home
directory. This can be disabled by setting the environment variable
<code>NODE_REPL_HISTORY=''</code>.</p> <h3 id="using-the-node-js-repl-with-advanced-line-editors"><a href="#using-the-node-js-repl-with-advanced-line-editors" class="header-anchor">#</a> Using the Node.js REPL with advanced line-editors</h3> <p>For advanced line-editors, start Node.js with the environment variable
<code>NODE_NO_READLINE=1</code>. This will start the main and debugger REPL in canonical
terminal settings, which will allow use with <code>rlwrap</code>.</p> <p>For example, the following can be added to a <code>.bashrc</code> file:</p> <div class="language-text extra-class"><pre class="language-text"><code>alias node=&quot;env NODE_NO_READLINE=1 rlwrap node&quot;
</code></pre></div><h3 id="starting-multiple-repl-instances-against-a-single-running-instance"><a href="#starting-multiple-repl-instances-against-a-single-running-instance" class="header-anchor">#</a> Starting multiple REPL instances against a single running instance</h3> <p>It is possible to create and run multiple REPL instances against a single
running instance of Node.js that share a single <code>global</code> object but have
separate I/O interfaces.</p> <p>The following example, for instance, provides separate REPLs on <code>stdin</code>, a Unix
socket, and a TCP socket:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> net <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'net'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> repl <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'repl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> connections <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

repl<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  prompt<span class="token punctuation">:</span> <span class="token string">'Node.js via stdin&gt; '</span><span class="token punctuation">,</span>
  input<span class="token punctuation">:</span> process<span class="token punctuation">.</span>stdin<span class="token punctuation">,</span>
  output<span class="token punctuation">:</span> process<span class="token punctuation">.</span>stdout
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

net<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  connections <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  repl<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    prompt<span class="token punctuation">:</span> <span class="token string">'Node.js via Unix socket&gt; '</span><span class="token punctuation">,</span>
    input<span class="token punctuation">:</span> socket<span class="token punctuation">,</span>
    output<span class="token punctuation">:</span> socket
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'exit'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    socket<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'/tmp/node-repl-sock'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

net<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  connections <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  repl<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    prompt<span class="token punctuation">:</span> <span class="token string">'Node.js via TCP socket&gt; '</span><span class="token punctuation">,</span>
    input<span class="token punctuation">:</span> socket<span class="token punctuation">,</span>
    output<span class="token punctuation">:</span> socket
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'exit'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    socket<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">5001</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Running this application from the command line will start a REPL on stdin.
Other REPL clients may connect through the Unix socket or TCP socket. <code>telnet</code>,
for instance, is useful for connecting to TCP sockets, while <code>socat</code> can be used
to connect to both Unix and TCP sockets.</p> <p>By starting a REPL from a Unix socket-based server instead of stdin, it is
possible to connect to a long-running Node.js process without restarting it.</p> <p>For an example of running a &quot;full-featured&quot; (<code>terminal</code>) REPL over
a <code>net.Server</code> and <code>net.Socket</code> instance, see:
<a href="https://gist.github.com/TooTallNate/2209310" target="_blank" rel="noopener noreferrer">https://gist.github.com/TooTallNate/2209310<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>For an example of running a REPL instance over <a href="https://curl.haxx.se/docs/manpage.html" target="_blank" rel="noopener noreferrer">curl(1)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, see:
<a href="https://gist.github.com/TooTallNate/2053342" target="_blank" rel="noopener noreferrer">https://gist.github.com/TooTallNate/2053342<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/public/blog/assets/js/app.793d18d6.js" defer></script><script src="/public/blog/assets/js/2.d1dd4e4d.js" defer></script><script src="/public/blog/assets/js/48.84db573a.js" defer></script><script src="/public/blog/assets/js/3.1f730cd9.js" defer></script>
  </body>
</html>
